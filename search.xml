<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>前端总结【常用命令】</title>
    <url>/cnblogs.github.io/p/56205.html</url>
    <content><![CDATA[<h4 id="前端命令"><a href="#前端命令" class="headerlink" title="前端命令"></a>前端命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">在项目开发过程中，使用到vue框架技术，需要安装node下载项目依赖，但经常会遇到node版本不匹配而导致无法正常下载，重新安装node却又很麻烦。为解决以上问题，nvm：一款node的版本管理工具，能够管理node的安装和使用，使用简单，可下载指定node版本和切换使用不同版本，方便了node的使用。</span><br><span class="line"></span><br><span class="line">nvm ls-remote # 列出所有远程服务器的版本（官方node version list）</span><br><span class="line">nvm list # (可简化为nvm ls) 列出所有已安装的 node 版本</span><br><span class="line">nvm list available # 显示所有可下载的版本</span><br><span class="line">nvm install stable # 安装最新版 node</span><br><span class="line">nvm install [node版本号] # 安装指定版本 node</span><br><span class="line">nvm uninstall [node版本号] # 删除已安装的指定版本</span><br><span class="line">nvm use [node版本号] # 切换到指定版本 node</span><br><span class="line">nvm current ：当前 node 版本 nvm alias [别名] [node版本号] # 给不同的版本号添加别名</span><br><span class="line">nvm unalias [别名] ：删除已定义的别名 nvm alias default [node版本号] # 设置默认版本</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/coreybutler/nvm-windows/releases">NVM下载</a></p>
]]></content>
      <categories>
        <category>前端总结</category>
      </categories>
      <tags>
        <tag>前端总结</tag>
      </tags>
  </entry>
  <entry>
    <title>DeepSeek总结一【精选指令】</title>
    <url>/cnblogs.github.io/p/9b8a.html</url>
    <content><![CDATA[<ol>
<li>思维导图 ：为……主题制作一份结构清晰的思维导图。</li>
<li>竞品分析 ：深度分析……产品的主要竞争对手，包括优劣势对比。</li>
<li>创意脑暴 ：围绕……话题进行创意头脑风暴，提供10个不同方向的想法。</li>
<li>效率提升 ：分析我的……工作流程，提出3-5个提升效率的具体建议。</li>
<li>风险评估 ：识别……项目可能面临的风险，并制定应对策略。</li>
<li>学习路径 ：为想要掌握……的初学者设计一条循序渐进的学习路径。</li>
<li>话术优化 ：优化以下……场景的沟通话术，让表达更有说服力。</li>
<li>时间管理 ：制定一套适合……人群的时间管理方案。</li>
<li>品牌定位 ：为……产品&#x2F;服务制定清晰的品牌定位策略。</li>
<li>内容策划 ：策划一个月的……平台内容日历，包括主题和发布节奏。</li>
<li>故障排除 ：诊断……问题的根本原因，并提供系统性解决方案。</li>
<li>数据洞察 ：从以下……数据中挖掘3个关键洞察和商业机会。</li>
<li>用户画像 ：基于……信息构建详细的目标用户画像。</li>
<li>流程优化 ：梳理并优化……业务流程，减少冗余环节。</li>
<li>趋势预测 ：基于当前情况预测……领域未来6个月的发展趋势。</li>
<li>方案对比 ：对比……的几种解决方案，分析各自适用场景。</li>
<li>知识框架 ：构建……领域的完整知识框架体系。</li>
<li>场景演练 ：模拟……情况下的应对话术和行为策略。</li>
<li>成本分析 ：分析……项目的成本构成，找出节约空间。</li>
<li>转化优化 ：优化……环节的转化率，提供具体改进建议。</li>
<li>情绪管理 ：提供……情况下的情绪调节技巧和心理建设方法。</li>
<li>技能迁移 ：分析如何将我的……技能应用到……新领域。</li>
<li>复盘反思 ：对……经历进行复盘，总结经验教训和改进方向。</li>
<li>目标拆解 ：将……大目标分解为可执行的阶段性小目标。</li>
<li>资源整合 ：整合……方面的优质资源，建立个人资源库。</li>
<li>沟通策略 ：制定与……类型人群的有效沟通策略。</li>
<li>创新思维 ：运用……创新方法论重新审视……问题。</li>
<li>价值提炼 ：从……经历中提炼出可复制的价值和方法论。</li>
<li>场景化应用 ：将……理论知识转化为具体可操作的实践方案。</li>
<li>差异化定位 ：在……竞争激烈的市场中找到差异化定位点。</li>
<li>习惯养成 ：设计一套……天的习惯养成计划，包括激励机制。</li>
<li>决策框架 ：建立……类型决策的标准化框架和评判标准。</li>
<li>协作机制 ：设计……团队的高效协作机制和沟通规范。</li>
<li>知识变现 ：将我在……领域的专业知识转化为收入来源。</li>
<li>压力测试 ：对……方案进行压力测试，识别潜在脆弱点。</li>
<li>用户体验 ：从用户体验角度优化……产品&#x2F;服务的关键触点。</li>
<li>议题设定 ：为……会议&#x2F;讨论设定高效的议题和议程安排。</li>
<li>反馈机制 ：建立……工作的反馈收集和改进机制。</li>
<li>学习笔记 ：将……复杂内容整理成结构化的学习笔记。</li>
<li>应急预案 ：制定……突发情况的应急预案和处理流程。</li>
<li>绩效指标 ：为……工作设计合理的绩效评估指标体系。</li>
<li>自我包装 ：优化我在……领域的个人品牌包装和形象定位。</li>
<li>资源配置 ：合理配置……项目的人力、时间和预算资源。</li>
<li>市场调研 ：设计……市场的调研方案，包括调研方法和问题设计。</li>
<li>知识体系 ：构建……专业领域的系统性知识体系图谱。</li>
<li>执行清单 ：制定……项目的详细执行清单和检查节点。</li>
<li>影响力建设 ：提升我在……领域的影响力和话语权的策略。</li>
<li>生态思维 ：用生态系统思维分析……行业的价值链和合作机会。</li>
<li>迭代优化 ：建立……产品&#x2F;服务的快速迭代和持续优化机制。</li>
<li>护城河构建 ：为……业务构建可持续的竞争护城河和壁垒。</li>
</ol>
]]></content>
      <categories>
        <category>DeepSeek</category>
      </categories>
      <tags>
        <tag>DeepSeek</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能一【Redis实现分布式锁】</title>
    <url>/cnblogs.github.io/p/33393.html</url>
    <content><![CDATA[<p><strong>添加依赖</strong><br>在 Spring Boot 项目的 pom.xml 文件中，添加 Spring Data Redis 依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>配置 Redis 连接</strong><br>在 application.yml 文件中，配置 Redis 的连接信息，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line">    password: </span><br><span class="line">    database: 0</span><br></pre></td></tr></table></figure>
<p><strong>创建 Redis 配置类</strong><br>创建一个 Redis 配置类，用于配置 Redis 连接工厂等相关信息：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置key的序列化方式</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">// 设置value的序列化方式</span></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>创建 RedisLock 类</strong><br>创建一个 RedisLock 类，用于实现获取锁和释放锁的逻辑：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOCK_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_IF_NOT_EXIST</span> <span class="operator">=</span> <span class="string">&quot;NX&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_WITH_EXPIRE_TIME</span> <span class="operator">=</span> <span class="string">&quot;EX&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RELEASE_SUCCESS</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String RELEASE_LUA;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(<span class="string">&quot;if redis.call(\&quot;get\&quot;,KEYS[1]) == ARGV[1] &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;then &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;    return redis.call(\&quot;del\&quot;,KEYS[1]) &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;else &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;    return 0 &quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;end &quot;</span>);</span><br><span class="line">        RELEASE_LUA = sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String clientId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.clientId = UUID.randomUUID().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(String key, <span class="type">long</span> timeout, TimeUnit unit)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.opsForValue().set(key, clientId, timeout, unit, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME);</span><br><span class="line">        <span class="keyword">return</span> LOCK_SUCCESS.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 释放锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">releaseLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(</span><br><span class="line">                (connection) -&gt; connection.eval(</span><br><span class="line">                        RELEASE_LUA.getBytes(),</span><br><span class="line">                        org.springframework.data.redis.connection.RedisStringCommands.LuaScript.KEEP_SCRIPT,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        key.getBytes(),</span><br><span class="line">                        clientId.getBytes()</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> RELEASE_SUCCESS.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用 RedisLock</strong><br>在业务代码中，使用 RedisLock 来获取锁和释放锁：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisLock redisLock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOCK_KEY</span> <span class="operator">=</span> <span class="string">&quot;test_lock&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">locked</span> <span class="operator">=</span> redisLock.tryLock(LOCK_KEY, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 执行业务逻辑</span></span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;业务逻辑执行完成，锁已释放&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                redisLock.releaseLock(LOCK_KEY);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;获取锁失败，请稍后重试&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;操作异常&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能七【文件上传之秒传、断点续传、分片上传】</title>
    <url>/cnblogs.github.io/p/2b2b.html</url>
    <content><![CDATA[<h2 id="一-秒传、断点上传与分片上传"><a href="#一-秒传、断点上传与分片上传" class="headerlink" title="一 秒传、断点上传与分片上传"></a>一 秒传、断点上传与分片上传</h2><h3 id="秒传"><a href="#秒传" class="headerlink" title="秒传"></a>秒传</h3><p>秒传，顾名思义，就是几乎瞬间完成文件上传的过程。其实现原理是通过计算文件的哈希值（如 MD5 或 SHA-1），然后将这个唯一的标识符发送给服务器。如果服务器上已经存在相同的文件，则直接返回成功信息，避免了重复上传。这种方式不仅节省了带宽，也大大提高了用户体验。</p>
<h3 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h3><p>断点续传是指在网络不稳定或者用户主动中断上传后，能够从上次中断的地方继续上传，而不需要重新开始整个过程。这对于大文件上传尤为重要，因为它可以有效防止因网络问题导致的上传失败，同时也能节约用户的流量和时间。</p>
<h3 id="分片上传"><a href="#分片上传" class="headerlink" title="分片上传"></a>分片上传</h3><p>分片上传则是将一个大文件分割成多个小块分别上传，最后再由服务器合并成完整的文件。这种做法的好处是可以并行处理多个小文件，提高上传效率；同时，如果某一部分上传失败，只需要重传这一部分，不影响其他部分。</p>
<h2 id="二-秒传实战"><a href="#二-秒传实战" class="headerlink" title="二 秒传实战"></a>二 秒传实战</h2><h3 id="后端实现"><a href="#后端实现" class="headerlink" title="后端实现"></a>后端实现</h3><p>在 SpringBoot 项目中，我们可以使用 MessageDigest 类来计算文件的 MD5 值，然后检查数据库中是否存在该文件。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    FileService fileService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">secondUpload</span><span class="params">(<span class="meta">@RequestParam(value = &quot;file&quot;,required = false)</span> MultipartFile file,<span class="meta">@RequestParam(required = false,value = &quot;md5&quot;)</span> String md5)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 检查数据库中是否已存在该文件</span></span><br><span class="line">            <span class="keyword">if</span> (fileService.existsByMd5(md5)) &#123;</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;文件已存在&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 保存文件到服务器</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/path/to/save/&quot;</span> + file.getOriginalFilename()));</span><br><span class="line">            <span class="comment">// 保存文件信息到数据库</span></span><br><span class="line">            fileService.save(<span class="keyword">new</span> <span class="title class_">FileInfo</span>(file.getOriginalFilename(), DigestUtils.md5DigestAsHex(file.getInputStream())));</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="前端调用"><a href="#前端调用" class="headerlink" title="前端调用"></a>前端调用</h3><p>前端可以通过 JavaScript 的 FileReader API 读取文件内容，通过 spark-md5 计算 MD5 值，然后发送给后端进行校验。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>秒传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;spark-md5.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;startUpload()&quot;</span>&gt;</span>开始上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">startUpload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!file) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;请选择文件&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> md5 = <span class="keyword">await</span> <span class="title function_">calculateMd5</span>(file);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">        formData.<span class="title function_">append</span>(<span class="string">&#x27;md5&#x27;</span>, md5);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/file/upload1&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: formData</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (result != <span class="string">&quot;文件已存在&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 开始上传文件</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;上传失败: &quot;</span> + result);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">calculateMd5</span>(<span class="params">file</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span></span><br><span class="line"><span class="language-javascript">            reader.<span class="property">onloadend</span> = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> spark = <span class="keyword">new</span> <span class="title class_">SparkMD5</span>.<span class="title class_">ArrayBuffer</span>();</span></span><br><span class="line"><span class="language-javascript">                spark.<span class="title function_">append</span>(reader.<span class="property">result</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">resolve</span>(spark.<span class="title function_">end</span>());</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">            reader.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(reader.<span class="property">error</span>);</span></span><br><span class="line"><span class="language-javascript">            reader.<span class="title function_">readAsArrayBuffer</span>(file);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>前端分为两个步骤：</p>
<ul>
<li>计算文件的 MD5 值，计算之后发送给服务端确定文件是否存在。</li>
<li>如果文件已经存在，则不需要继续上传文件；如果文件不存在，则开始上传文件，上传文件和 MD5 校验请求类似，上面的案例代码中我就没有重复演示了，松哥在书里和之前的课程里都多次讲过文件上传，这里不再啰嗦。</li>
</ul>
<h2 id="三-分片上传实战"><a href="#三-分片上传实战" class="headerlink" title="三 分片上传实战"></a>三 分片上传实战</h2><p>分片上传关键是在前端对文件切片，比如一个 10MB 的文件切为 10 份，每份 1MB。每次上传的时候，需要多一个参数记录当前上传的文件切片的起始位置。<br>比如一个 10MB 的文件，切为 10 份，每份 1MB，那么：</p>
<ul>
<li>第 0 片，从 0 开始，一共是 1024*1024 个字节。</li>
<li>第 1 片，从 1024<em>1024 开始，一共是 1024</em>1024 个字节。</li>
<li>第 2 片…</li>
</ul>
<p>把这个搞懂，后面的代码就好理解了。</p>
<h3 id="后端实现-1"><a href="#后端实现-1" class="headerlink" title="后端实现"></a>后端实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">UPLOAD_DIR</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.home&quot;</span>) + <span class="string">&quot;/uploads/&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件到指定位置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file 上传的文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> start 文件开始上传的位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ResponseEntity&lt;String&gt; 上传结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/upload2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">resumeUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, <span class="meta">@RequestParam(&quot;start&quot;)</span> <span class="type">long</span> start,<span class="meta">@RequestParam(&quot;fileName&quot;)</span> String fileName)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">directory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(UPLOAD_DIR);</span><br><span class="line">        <span class="keyword">if</span> (!directory.exists()) &#123;</span><br><span class="line">            directory.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">File</span> <span class="variable">targetFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(UPLOAD_DIR + fileName);</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">randomAccessFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(targetFile, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> randomAccessFile.getChannel();</span><br><span class="line">        channel.position(start);</span><br><span class="line">        channel.transferFrom(file.getResource().readableChannel(), start, file.getSize());</span><br><span class="line">        channel.close();</span><br><span class="line">        randomAccessFile.close();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;上传失败: &quot;</span>+e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>).body(<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后端每次处理的时候，需要先设置文件的起始位置。</p>
<h3 id="前端调用-1"><a href="#前端调用-1" class="headerlink" title="前端调用"></a>前端调用</h3><p>前端需要将文件切分成多个小块，然后依次上传。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>分片示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;startUpload()&quot;</span>&gt;</span>开始上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">startUpload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!file) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(<span class="string">&quot;请选择文件&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> filename = file.<span class="property">name</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">let</span> start = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">uploadFile</span>(file, start);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params">file, start</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> chunkSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 每个分片1MB</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> total = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(file.<span class="property">size</span> / chunkSize);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> chunkStart = start + i * chunkSize;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> chunkEnd = <span class="title class_">Math</span>.<span class="title function_">min</span>(chunkStart + chunkSize, file.<span class="property">size</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> chunk = file.<span class="title function_">slice</span>(chunkStart, chunkEnd);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, chunk);</span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;start&#x27;</span>, chunkStart);</span></span><br><span class="line"><span class="language-javascript">                formData.<span class="title function_">append</span>(<span class="string">&#x27;fileName&#x27;</span>, file.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/file/upload2&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: formData</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`分片 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;total&#125;</span> 上传成功`</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`分片 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;total&#125;</span> 上传失败: <span class="subst">$&#123;result&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="四-断点续传实战"><a href="#四-断点续传实战" class="headerlink" title="四 断点续传实战"></a>四 断点续传实战</h2><p>断点续传的技术原理类似于分片上传。当文件已经上传了一部分之后，断了需要重新开始上传。<br>那么我们的思路是这样的：</p>
<ul>
<li>前端先发送一个请求，检查要上传的文件在服务端是否已经存在，如果存在，目前大小是多少。</li>
<li>前端根据已经存在的大小，继续上传文件即可。</li>
</ul>
<p>后端案例<br>先来看后端检查的接口，如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/check&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Long&gt; <span class="title function_">checkFile</span><span class="params">(<span class="meta">@RequestParam(&quot;filename&quot;)</span> String filename)</span> &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(UPLOAD_DIR + filename);</span><br><span class="line">    <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(file.length());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果文件存在，则返回已经存在的文件大小。如果文件不存在，则返回 0，表示前端从头开始上传该文件。</p>
<h3 id="前端调用-2"><a href="#前端调用-2" class="headerlink" title="前端调用"></a>前端调用</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>断点续传示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;startUpload()&quot;</span>&gt;</span>开始上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">startUpload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!file) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&quot;请选择文件&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> filename = file.<span class="property">name</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> start = <span class="keyword">await</span> <span class="title function_">checkFile</span>(filename);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">uploadFile</span>(file, start);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params">filename</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/file/check?filename=<span class="subst">$&#123;filename&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> start = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> start;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params">file, start</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> chunkSize = <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 每个分片1MB</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> total = <span class="title class_">Math</span>.<span class="title function_">ceil</span>((file.<span class="property">size</span> - start) / chunkSize);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; total; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> chunkStart = start + i * chunkSize;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> chunkEnd = <span class="title class_">Math</span>.<span class="title function_">min</span>(chunkStart + chunkSize, file.<span class="property">size</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> chunk = file.<span class="title function_">slice</span>(chunkStart, chunkEnd);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">            formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, chunk);</span></span><br><span class="line"><span class="language-javascript">            formData.<span class="title function_">append</span>(<span class="string">&#x27;start&#x27;</span>, chunkStart);</span></span><br><span class="line"><span class="language-javascript">            formData.<span class="title function_">append</span>(<span class="string">&#x27;fileName&#x27;</span>, file.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/file/upload2&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: formData</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`分片 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;total&#125;</span> 上传成功`</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`分片 <span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>/<span class="subst">$&#123;total&#125;</span> 上传失败: <span class="subst">$&#123;result&#125;</span>`</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>本文完整案例：<a href="https://github.com/lenve/springboot3-samples/tree/main/file_upload">https://github.com/lenve/springboot3-samples/tree/main/file_upload</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能三【自动封禁恶意访问IP】</title>
    <url>/cnblogs.github.io/p/61459.html</url>
    <content><![CDATA[<p><strong>解决方案</strong><br><strong>自定义过滤器实现</strong><br>首先，我们可以创建一个自定义过滤器来检查请求的 IP 地址。实现一个IpFilter类，继承OncePerRequestFilter ，在doFilterInternal方法中，通过HttpServletRequest对象的getRemoteAddr()方法获取请求的 IP 地址（需要注意，如果应用部署在反向代理后，可能要从X-Forwarded-For头中获取真实 IP）。</p>
<p>我们可以维护一个ConcurrentHashMap来存储每个 IP 的访问次数和初次访问时间。在过滤器中，每次请求时判断该 IP 的访问次数是否超过设定阈值（比如一分钟内访问超过 50 次），如果超过且距离初次访问时间在一定范围内，就将该 IP 加入到封禁列表中。封禁列表同样可以用ConcurrentHashMap存储，key 为 IP 地址，value 为封禁截止时间。当有请求到来时，先检查该 IP 是否在封禁列表中，如果在且当前时间未超过封禁截止时间，则直接返回错误信息，阻止访问。</p>
<p>这种方法的优点是灵活性高，开发者可以根据业务需求自由定制封禁规则，适用于对 IP 封禁逻辑有特殊要求的场景。但缺点也很明显，由于需要自行维护数据结构和逻辑判断，代码复杂度较高，且在高并发场景下，频繁对ConcurrentHashMap进行读写操作可能会带来性能损耗。</p>
<p>同时，还需要创建一个监听器IpListener来初始化这个 IP 存储器，并在 Spring Boot 启动类添加扫描过滤器和监听器的配置。具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletListenerRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletListenerRegistrationBean&lt;IpListener&gt; <span class="title function_">ipListenerRegistrationBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">IpListener</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        sce.getServletContext().setAttribute(<span class="string">&quot;ipMap&quot;</span>, <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class="line">        sce.getServletContext().setAttribute(<span class="string">&quot;blockedIpMap&quot;</span>, <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;</span><br><span class="line">        <span class="comment">// 可添加清理逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_REQUESTS_PER_MINUTE</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BLOCK_DURATION</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 封禁1分钟</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">        Map&lt;String, Integer&gt; ipMap = (Map&lt;String, Integer&gt;) request.getServletContext().getAttribute(<span class="string">&quot;ipMap&quot;</span>);</span><br><span class="line">        Map&lt;String, Date&gt; blockedIpMap = (Map&lt;String, Date&gt;) request.getServletContext().getAttribute(<span class="string">&quot;blockedIpMap&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (blockedIpMap.containsKey(ip) &amp;&amp; <span class="keyword">new</span> <span class="title class_">Date</span>().before(blockedIpMap.get(ip))) &#123;</span><br><span class="line">            response.sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">&quot;Your IP is blocked due to excessive requests.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ipMap.put(ip, ipMap.getOrDefault(ip, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (ipMap.get(ip) &gt; MAX_REQUESTS_PER_MINUTE) &#123;</span><br><span class="line">            blockedIpMap.put(ip, <span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + BLOCK_DURATION));</span><br><span class="line">            response.sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">&quot;Your IP is blocked due to excessive requests.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>结合 Spring Security 实现</strong><br>在 Spring Security 的配置类中，我们可以重写configure(HttpSecurity http)方法，结合自定义的逻辑来实现 IP 封禁。首先，定义一个IpAddressService接口及其实现类，用于判断 IP 是否为恶意 IP。在configure方法中，使用http.authorizeRequests()方法来对请求进行授权判断。</p>
<p>Spring Security 是一个功能强大且高度可定制的身份验证和访问控制框架，结合它实现 IP 封禁，优势在于能够与系统的权限管理体系无缝集成，适用于已经使用 Spring Security 进行安全管理的项目。但缺点是配置相对复杂，对于不熟悉 Spring Security 的开发者来说，学习成本较高。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.access.AccessDeniedHandler;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IpAddressService ipAddressService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecurityConfig</span><span class="params">(IpAddressService ipAddressService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ipAddressService = ipAddressService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">           .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/**&quot;</span>).access(ipAddressService::isIpAllowed)</span><br><span class="line">                .and()</span><br><span class="line">           .exceptionHandling()</span><br><span class="line">                .accessDeniedHandler(accessDeniedHandler())</span><br><span class="line">                .and()</span><br><span class="line">           .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccessDeniedHandler <span class="title function_">accessDeniedHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (request, response, accessDeniedException) -&gt; &#123;</span><br><span class="line">            response.sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">&quot;Your IP is not allowed to access this resource.&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IpAddressService</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isIpAllowed</span><span class="params">(String ipAddress)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpAddressServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IpAddressService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Long&gt; requestCounts = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_REQUESTS_PER_MINUTE</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">BLOCK_DURATION</span> <span class="operator">=</span> <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// 封禁1分钟</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Long&gt; blockedIps = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isIpAllowed</span><span class="params">(String ipAddress)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (blockedIps.containsKey(ipAddress) &amp;&amp; System.currentTimeMillis() &lt; blockedIps.get(ipAddress)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> requestCounts.getOrDefault(ipAddress, <span class="number">0L</span>);</span><br><span class="line">        <span class="keyword">if</span> (count &gt;= MAX_REQUESTS_PER_MINUTE) &#123;</span><br><span class="line">            blockedIps.put(ipAddress, System.currentTimeMillis() + BLOCK_DURATION);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        requestCounts.put(ipAddress, count + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，通过 Spring Security 的强大功能，结合自定义的 IP 判断逻辑，就能实现对恶意 IP 的封禁。</p>
<p>此外，还有一些需要额外注意的点。在获取 IP 地址时，从X-Forwarded-For头获取真实 IP 存在安全风险，因为该头信息可以被伪造，建议结合其他方式（如通过负载均衡器配置可靠的 IP 透传策略）进行验证。同时，对于封禁的 IP 列表，要考虑数据持久化问题，避免应用重启后封禁规则丢失；在集群环境下，还需要解决各节点之间封禁列表的同步问题，可借助分布式缓存（如 Redis）来实现。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能二【自定义配置文件】</title>
    <url>/cnblogs.github.io/p/9663.html</url>
    <content><![CDATA[<p><strong>在默认配置文件中自定义属性</strong><br>Spring Boot 3 默认会读取 application.properties 或 application.yml 这两个配置文件。其中，application.yml 因其简洁易读的格式，近年来越来越受开发者青睐。我们先来看在 application.ym 中自定义属性的方法。假设我们要定义一组与用户相关的自定义属性，可以这样编写：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">自定义用户名</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">example@example.com</span></span><br></pre></td></tr></table></figure>
<p>在上述代码中，我们通过层级结构定义了 my.user 下的多个属性。那么，如何在代码中读取这些属性呢？有两种常见方式。</p>
<p><strong>使用@Value注解</strong><br>如果只是简单地读取单个属性值，我们可以在需要使用属性值的变量上添加 @Value(“${属性名}”) 注解。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.user.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String myUserName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.user.age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> myUserAge;</span><br><span class="line">    <span class="comment">// 相应的 get 和 set 方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMyUserName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myUserName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMyUserName</span><span class="params">(String myUserName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.myUserName = myUserName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getMyUserAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myUserAge;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMyUserAge</span><span class="params">(<span class="type">int</span> myUserAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.myUserAge = myUserAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，在 MyComponent 类中，我们就成功将配置文件中的属性值注入到了对应的变量中。不过，@Value 注解在处理多个相关属性时，代码可能会显得比较繁琐，此时我们可以采用另一种方式。</p>
<p><strong>使用@ConfigurationProperties注解</strong><br>这种方式更适合将一组相关的配置属性赋值给一个实体类。我们继续以上述 my.user 的配置为例，创建一个对应的实体类 UserConfig：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">// 生成对应的 get 和 set 方法</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个类中，我们通过 @ConfigurationProperties(prefix &#x3D; “my.user”) 注解，告诉 Spring Boot 将配置文件中 my.user 前缀下的属性值绑定到这个类的对应属性上。同时，加上 @Component 注解，使 Spring Boot 启动时将该类作为 Bean 注入 IoC 容器。<br>之后，在需要使用这些属性的地方，比如 Controller 类中，我们还需要加上 @EnableConfigurationProperties 注解并指明该 bean 类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(UserConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserConfig userConfig;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/userConfig&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Name: &quot;</span> + userConfig.getName() + <span class="string">&quot;, Age: &quot;</span> + userConfig.getAge() + <span class="string">&quot;, Email: &quot;</span> + userConfig.getEmail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，当访问 &#x2F;userConfig 接口时，就能获取到配置文件中自定义的用户属性信息了。这种方式对于管理一组相关的配置属性非常方便，代码结构也更加清晰。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能五【多种生产打包方式】</title>
    <url>/cnblogs.github.io/p/7186.html</url>
    <content><![CDATA[<h3 id="方法一-插件spring-boot-maven-plugin"><a href="#方法一-插件spring-boot-maven-plugin" class="headerlink" title="方法一 插件spring-boot-maven-plugin"></a>方法一 插件spring-boot-maven-plugin</h3><ul>
<li>项目应用的配置文件排除 统一打包到config目录下<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--filerting设置为true,则打包过程中会对这些文件进行过滤处理--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--指定目标路径为config--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>$&#123;project.build.directory&#125;/config<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--使用通配符--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">include</span>&gt;</span>mapper/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 这里可以根据你实际想要包含的配置文件类型来添加更多的include配置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>把我们写代码打包可执行jar，并排除依赖jar包<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--项目的启动类,如果有多个main就必须指定，没有可以缺失</span></span><br><span class="line"><span class="comment">     &lt;mainClass&gt;XXXXX.TwinWebApplication&lt;/mainClass&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--解决windows命令行窗口中文乱码--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">jvmArguments</span>&gt;</span>-Dfile.encoding=UTF-8<span class="tag">&lt;/<span class="name">jvmArguments</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--配置需要打包进项目的jar--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--填写需要打包所需要的依赖 。没有匹配上任何jar包机排除依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>no-exists-jar<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>non-exists-jar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 表示当运行mavn package打包时，使用Springboot插件打包 --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置依赖的jar包 统一打包lib目录<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--此插件用于将依赖包抽出--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">excludeTransitive</span>&gt;</span>false<span class="tag">&lt;/<span class="name">excludeTransitive</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">stripVersion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">stripVersion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="方法二-使用maven-jar-plugin插件实现"><a href="#方法二-使用maven-jar-plugin插件实现" class="headerlink" title="方法二 使用maven-jar-plugin插件实现"></a>方法二 使用maven-jar-plugin插件实现</h3><ul>
<li>使用插件maven-resources-plugin处理配置文件打包到config目录<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置文件打包成config目录下 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/twin-web/config<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>使用maven-jar-plugin 打包可执行jar 并排除依赖<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--输入打包可执行的jar到twin-web\libs\下--&gt;</span></span><br><span class="line">          $&#123;project.build.directory&#125;/twin-web/</span><br><span class="line">       <span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">addMavenDescriptor</span>&gt;</span>false<span class="tag">&lt;/<span class="name">addMavenDescriptor</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 增加执行启动jar的依赖jar包目录前缀--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>./libs/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 指定启动类--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.keqing.twinweb.TwinWebApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">manifestEntries</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 增加配置文件的classpath--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">Class-Path</span>&gt;</span>./config/<span class="tag">&lt;/<span class="name">Class-Path</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">manifestEntries</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 排除配置文件--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>*.yml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>mapper/**<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>*.xml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>使用maven-dependency-plugin 打包libs目录下<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/twin-web/libs<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">excludeTransitive</span>&gt;</span>false<span class="tag">&lt;/<span class="name">excludeTransitive</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">stripVersion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">stripVersion</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="方式三-使用maven-assembly-plugin打包"><a href="#方式三-使用maven-assembly-plugin打包" class="headerlink" title="方式三 使用maven-assembly-plugin打包"></a>方式三 使用maven-assembly-plugin打包</h3><ul>
<li>项目应用的配置文件排除<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--filerting设置为true,则打包过程中会对这些文件进行过滤处理--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--使用通配符--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span>&gt;</span>mapper/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这里可以根据你实际想要包含的配置文件类型来添加更多的include配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置spring-boot-maven-plugin<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--项目的启动类,如果有多个main就必须指定，没有可以缺失</span></span><br><span class="line"><span class="comment">         &lt;mainClass&gt;XXXXX.TwinWebApplication&lt;/mainClass&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--解决windows命令行窗口中文乱码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jvmArguments</span>&gt;</span>-Dfile.encoding=UTF-8<span class="tag">&lt;/<span class="name">jvmArguments</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--配置需要打包进项目的jar--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--填写需要打包所需要的依赖 。没有匹配上任何jar包机排除依赖--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>no-exists-jar<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>non-exists-jar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                 <span class="comment">&lt;!-- 表示当运行mavn package打包时，使用Springboot插件打包 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>引入springboot里约定maven-assembly-plugin<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 打包文件名字不包含 assembly.xml 中 id --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">appendAssemblyId</span>&gt;</span>false<span class="tag">&lt;/<span class="name">appendAssemblyId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">descriptors</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--项目所在目录配置文件的 assembly.xml文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">descriptor</span>&gt;</span>assembly.xml<span class="tag">&lt;/<span class="name">descriptor</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">descriptors</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
配置assembly.xml文件<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">assembly</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 打包文件名的标识符，用来做后缀--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 打包的类型，如果有N个，将会打N个类型的包 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">formats</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">format</span>&gt;</span>tar.gz<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">format</span>&gt;</span>zip<span class="tag">&lt;/<span class="name">format</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">formats</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 压缩包下是否生成和项目名相同的根目录 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">includeBaseDirectory</span>&gt;</span>true<span class="tag">&lt;/<span class="name">includeBaseDirectory</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 用来设置一组文件在打包时的属性。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fileSets</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 0755-&gt;即用户具有读/写/执行权限，组用户和其它用户具有读写权限；--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 0644-&gt;即用户具有读写权限，组用户和其它用户具有只读权限；--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将src/bin目录下的jar启动脚本输出到打包后的目录中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--lineEnding选项可用于控制给定的行结束文件 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">lineEnding</span>&gt;</span>unix<span class="tag">&lt;/<span class="name">lineEnding</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/bin<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;file.separator&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">fileMode</span>&gt;</span>0755<span class="tag">&lt;/<span class="name">fileMode</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>**.sh<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>**.bat<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 把项目的配置文件，打包进压缩文件的config目录 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>config<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">fileMode</span>&gt;</span>0644<span class="tag">&lt;/<span class="name">fileMode</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>mapper/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 把项目自己编译出来的jar文件，打包进zip文件的根目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fileSet</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;file.separator&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">include</span>&gt;</span>*.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">fileSet</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">fileSets</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 依赖包的拷贝--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencySets</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">unpack</span>&gt;</span>false<span class="tag">&lt;/<span class="name">unpack</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">useProjectArtifact</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useProjectArtifact</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">unpack</span>&gt;</span>false<span class="tag">&lt;/<span class="name">unpack</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">useProjectArtifact</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useProjectArtifact</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencySet</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">unpack</span>&gt;</span>false<span class="tag">&lt;/<span class="name">unpack</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">useProjectArtifact</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useProjectArtifact</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencySet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencySets</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">assembly</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能六【XSS防御】</title>
    <url>/cnblogs.github.io/p/89f0.html</url>
    <content><![CDATA[<h2 id="使用注解进行XSS防御"><a href="#使用注解进行XSS防御" class="headerlink" title="使用注解进行XSS防御"></a>使用注解进行XSS防御</h2><p>注解是一种轻量级的防御手段，它可以在方法或字段级别对输入进行校验，从而防止XSS攻击。</p>
<h3 id="1-1-引入相关依赖"><a href="#1-1-引入相关依赖" class="headerlink" title="1.1 引入相关依赖"></a>1.1 引入相关依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--JSR-303/JSR-380用于验证的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-使用-XSS注解进行参数校验"><a href="#1-2-使用-XSS注解进行参数校验" class="headerlink" title="1.2 使用@XSS注解进行参数校验"></a>1.2 使用@XSS注解进行参数校验</h3><p>我们可以自定义一个@XSS注解，用于标记那些需要校验的参数。这里是一个简单的@XSS注解定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(value = &#123; ElementType.METHOD, ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.PARAMETER &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = XssValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Xss &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;非法输入, 检测到潜在的XSS&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-实现自定义注解处理器"><a href="#1-3-实现自定义注解处理器" class="headerlink" title="1.3 实现自定义注解处理器"></a>1.3 实现自定义注解处理器</h3><p>接下来，我们需要实现XSSValidator类，该类将负责检查输入是否包含潜在的XSS攻击脚本：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;Xss, String&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用自带的 basicWithImages 白名单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Safelist</span> <span class="variable">WHITE_LIST</span> <span class="operator">=</span> Safelist.relaxed();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义输出设置，关闭prettyPrint（prettyPrint=false），目的是避免在清理过程中对代码进行格式化</span></span><br><span class="line"><span class="comment">     * 从而保持输入和输出内容的一致性。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Document.<span class="type">OutputSettings</span> <span class="variable">OUTPUT_SETTINGS</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>.OutputSettings().prettyPrint(<span class="literal">false</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证输入值是否有效，即是否包含潜在的XSS攻击脚本。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 输入值，需要进行XSS攻击脚本清理。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context 上下文对象，提供关于验证环境的信息，如验证失败时的错误消息定制。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果清理后的值与原始值相同，则返回true，表示输入值有效；否则返回false，表示输入值无效。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用Jsoup库对输入值进行清理，以移除潜在的XSS攻击脚本。</span></span><br><span class="line">        <span class="comment">// 使用预定义的白名单和输出设置来确保只保留安全的HTML元素和属性。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cleanedValue</span> <span class="operator">=</span> Jsoup.clean(value, <span class="string">&quot;&quot;</span>, WHITE_LIST, OUTPUT_SETTINGS);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 比较清理后的值与原始值是否相同，用于判断输入值是否有效。</span></span><br><span class="line">        <span class="keyword">return</span> cleanedValue.equals(value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-使用注解"><a href="#1-4-使用注解" class="headerlink" title="1.4 使用注解"></a>1.4 使用注解</h3><p>在要进行XSS防御的属性上添加注解：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;用户&quot;,description = &quot;用户登录类&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginDTO</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Xss</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;账号不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Schema(name = &quot;用户账号&quot;,type = &quot;String&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userAccount;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Xss</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 18, message = &quot;用户密码长度需在6-18位&quot;)</span></span><br><span class="line">    <span class="meta">@Schema(name = &quot;用户密码&quot;,type = &quot;String&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Xss</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱验证码内容不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Schema(name = &quot;邮箱验证码&quot;,type = &quot;String&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String emailCaptcha;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Controller中的接口添加@Validated注解：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/test2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span>  <span class="meta">@Validated</span> UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用过滤器进行XSS防御"><a href="#使用过滤器进行XSS防御" class="headerlink" title="使用过滤器进行XSS防御"></a>使用过滤器进行XSS防御</h2><h3 id="2-1-引入相关依赖"><a href="#2-1-引入相关依赖" class="headerlink" title="2.1 引入相关依赖"></a>2.1 引入相关依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Jsoup依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.17.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-编写配置类"><a href="#2-2-编写配置类" class="headerlink" title="2.2 编写配置类"></a>2.2 编写配置类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跨站脚本（XSS）过滤配置类。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;xss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否启用XSS过滤。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String enabled;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要排除的URL模式，这些URL不会进行XSS过滤。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String excludes;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要应用XSS过滤的URL模式。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String urlPatterns;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册XSS过滤器。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FilterRegistrationBean 用于注册过滤器的bean。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">xssFilterRegistration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        <span class="comment">// 设置过滤器的分发类型为请求类型</span></span><br><span class="line">        registrationBean.setDispatcherTypes(DispatcherType.REQUEST);</span><br><span class="line">        <span class="comment">// 创建XssFilter的实例</span></span><br><span class="line">        registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">XssFilter</span>());</span><br><span class="line">        <span class="comment">// 添加过滤器需要拦截的URL模式，这些模式从配置文件中的&quot;urlPatterns&quot;属性读取</span></span><br><span class="line">        registrationBean.addUrlPatterns(StringUtils.split(urlPatterns, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">        <span class="comment">// 设置过滤器的名称</span></span><br><span class="line">        registrationBean.setName(<span class="string">&quot;XssFilter&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置过滤器的执行顺序，数值越小，优先级越高</span></span><br><span class="line">        registrationBean.setOrder(<span class="number">9999</span>);</span><br><span class="line">        <span class="comment">// 创建一个Map，用于存储过滤器的初始化参数</span></span><br><span class="line">        Map&lt;String, String&gt; initParameters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 将配置文件中的&quot;excludes&quot;属性设置到过滤器的初始化参数中</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;excludes&quot;</span>, excludes);</span><br><span class="line">        <span class="comment">// 将配置文件中的&quot;enabled&quot;属性设置到过滤器的初始化参数中</span></span><br><span class="line">        initParameters.put(<span class="string">&quot;enabled&quot;</span>, enabled);</span><br><span class="line">        <span class="comment">// 将初始化参数设置到FilterRegistrationBean中</span></span><br><span class="line">        registrationBean.setInitParameters(initParameters);</span><br><span class="line">        <span class="comment">// 返回FilterRegistrationBean，包含了XssFilter的配置信息</span></span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-修改配置文件"><a href="#2-3-修改配置文件" class="headerlink" title="2.3 修改配置文件"></a>2.3 修改配置文件</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">xss:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">excludes:</span></span><br><span class="line">  <span class="attr">url-patterns:</span> <span class="string">/*</span></span><br></pre></td></tr></table></figure>
<h3 id="2-4-创建XSSFilter类"><a href="#2-4-创建XSSFilter类" class="headerlink" title="2.4 创建XSSFilter类"></a>2.4 创建XSSFilter类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储需要排除XSS过滤的URL模式列表。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; excludes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否启用XSS过滤的标志。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enabled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化过滤器，从过滤器配置中读取排除列表和启用状态。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filterConfig 过滤器配置对象。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果初始化过程中出现错误。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strExcludes</span> <span class="operator">=</span> filterConfig.getInitParameter(<span class="string">&quot;excludes&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strEnabled</span> <span class="operator">=</span> filterConfig.getInitParameter(<span class="string">&quot;enabled&quot;</span>);</span><br><span class="line">        <span class="comment">//将不需要xss过滤的接口添加到列表中</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(strExcludes)) &#123;</span><br><span class="line">            String[] urls = strExcludes.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">                excludes.add(url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(strEnabled)) &#123;</span><br><span class="line">            enabled = Boolean.valueOf(strEnabled);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行过滤逻辑，如果当前请求不在排除列表中，则通过XSS过滤器包装请求。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HTTP请求对象。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HTTP响应对象。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain    过滤器链对象，用于继续或中断请求处理。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException      如果处理过程中出现I/O错误。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException 如果处理过程中出现Servlet相关错误。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        <span class="comment">//如果该访问接口在排除列表里面则不拦截</span></span><br><span class="line">        <span class="keyword">if</span> (isExcludeUrl(req.getServletPath())) &#123;</span><br><span class="line">            chain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        log.info(<span class="string">&quot;uri:&#123;&#125;&quot;</span>, req.getRequestURI());</span><br><span class="line">        <span class="comment">// xss 过滤</span></span><br><span class="line">        chain.doFilter(<span class="keyword">new</span> <span class="title class_">XssWrapper</span>(req), resp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销毁过滤器，释放资源。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 无需额外的销毁逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断当前请求的URL是否应该被排除在XSS过滤之外。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urlPath 请求的URL路径。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果请求应该被排除，则返回true；否则返回false。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isExcludeUrl</span><span class="params">(String urlPath)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!enabled) &#123;</span><br><span class="line">            <span class="comment">//如果xss开关关闭了，则所有url都不拦截</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (excludes == <span class="literal">null</span> || excludes.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> urlPath;</span><br><span class="line">        <span class="keyword">for</span> (String pattern : excludes) &#123;</span><br><span class="line">            <span class="type">Pattern</span> <span class="variable">p</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^&quot;</span> + pattern);</span><br><span class="line">            <span class="type">Matcher</span> <span class="variable">m</span> <span class="operator">=</span> p.matcher(url);</span><br><span class="line">            <span class="keyword">if</span> (m.find()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-5-编写过滤工具类"><a href="#2-5-编写过滤工具类" class="headerlink" title="2.5 编写过滤工具类"></a>2.5 编写过滤工具类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * XSS过滤工具类，使用Jsoup库对输入的字符串进行XSS攻击防护</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssUtil</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用自带的 basicWithImages 白名单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Safelist</span> <span class="variable">WHITE_LIST</span> <span class="operator">=</span> Safelist.relaxed();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义输出设置，关闭prettyPrint（prettyPrint=false），目的是避免在清理过程中对代码进行格式化</span></span><br><span class="line"><span class="comment">     * 从而保持输入和输出内容的一致性。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Document.<span class="type">OutputSettings</span> <span class="variable">OUTPUT_SETTINGS</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>.OutputSettings().prettyPrint(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      初始化白名单策略，允许所有标签拥有style属性。</span></span><br><span class="line"><span class="comment">      这是因为在富文本编辑中，样式通常通过style属性来定义，需要确保这些样式能够被保留。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 富文本编辑时一些样式是使用 style 来进行实现的</span></span><br><span class="line">        <span class="comment">// 比如红色字体 style=&quot;color:red;&quot;</span></span><br><span class="line">        <span class="comment">// 所以需要给所有标签添加 style 属性</span></span><br><span class="line">        WHITE_LIST.addAttributes(<span class="string">&quot;:all&quot;</span>, <span class="string">&quot;style&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清理输入的字符串，移除潜在的XSS攻击代码。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 待清理的字符串，通常是用户输入的HTML内容。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 清理后的字符串，保证不包含XSS攻击代码。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">clean</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用定义好的白名单策略和输出设置清理输入的字符串</span></span><br><span class="line">        <span class="keyword">return</span> Jsoup.clean(content, <span class="string">&quot;&quot;</span>, WHITE_LIST, OUTPUT_SETTINGS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-编写XSSRequestWrapper类清理脚本"><a href="#2-6-编写XSSRequestWrapper类清理脚本" class="headerlink" title="2.6 编写XSSRequestWrapper类清理脚本"></a>2.6 编写XSSRequestWrapper类清理脚本</h3><p>在XSSFilter类中，我们创建了一个新的XSSRequestWrapper类，该类继承自HttpServletRequestWrapper。在这个包装类中，我们将重写getParameter等方法，以清理请求参数中的潜在XSS脚本。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssWrapper</span> <span class="keyword">extends</span> <span class="title class_">HttpServletRequestWrapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a request object wrapping the given request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request The request to wrap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the request is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">XssWrapper</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(request);</span><br><span class="line">        log.info(<span class="string">&quot;XssWrapper&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对数组参数进行特殊字符过滤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] getParameterValues(String name) &#123;</span><br><span class="line">        String[] values = <span class="built_in">super</span>.getParameterValues(name);</span><br><span class="line">        <span class="keyword">if</span> (values == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> values.length;</span><br><span class="line">        String[] encodedValues = <span class="keyword">new</span> <span class="title class_">String</span>[count];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            encodedValues[i] = cleanXSS(values[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> encodedValues;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对参数中特殊字符进行过滤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getParameter</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">super</span>.getParameter(name);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cleanXSS(value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取attribute,特殊字符过滤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getAttribute</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">super</span>.getAttribute(name);</span><br><span class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> String &amp;&amp; StrUtil.isNotBlank((String) value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> cleanXSS((String) value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对请求头部进行特殊字符过滤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHeader</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">super</span>.getHeader(name);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cleanXSS(value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清理输入的字符串以防止XSS攻击</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 待清理的字符串，通常为用户输入或来自不可信源的数据。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 清理后的字符串，移除了可能的XSS攻击代码。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">cleanXSS</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> XssUtil.clean(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-7-自定义json消息解析器"><a href="#2-7-自定义json消息解析器" class="headerlink" title="2.7 自定义json消息解析器"></a>2.7 自定义json消息解析器</h3><p>在使用springboot中，类似于普通的参数parameter，attribute，header一类的，可以直接使用过滤器来过滤。而前端发送回来的json字符串就没那么方便过滤了。可以考虑用自定义json消息解析器来过滤前端传递的json。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在读取和写入JSON数据时特殊字符避免xss攻击的消息解析器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XSSMappingJackson2HttpMessageConverter</span> <span class="keyword">extends</span> <span class="title class_">MappingJackson2HttpMessageConverter</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从HTTP输入消息中读取对象，同时应用XSS防护。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type        类型令牌，表示要读取的对象类型。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contextClass    上下文类，提供类型解析的上下文信息。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputMessage HTTP输入消息，包含要读取的JSON数据。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 从输入消息中解析出的对象，经过XSS防护处理。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 如果发生I/O错误。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> HttpMessageNotReadableException 如果消息无法读取。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">read</span><span class="params">(Type type, Class contextClass,</span></span><br><span class="line"><span class="params">                       HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException,</span><br><span class="line">            HttpMessageNotReadableException &#123;</span><br><span class="line">        <span class="type">JavaType</span> <span class="variable">javaType</span> <span class="operator">=</span> getJavaType(type, contextClass);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> readJavaType(javaType, inputMessage);</span><br><span class="line">        <span class="comment">//得到请求json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="built_in">super</span>.getObjectMapper().writeValueAsString(obj);</span><br><span class="line">        <span class="comment">//过滤特殊字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> XssUtil.clean(json);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">resultObj</span> <span class="operator">=</span> <span class="built_in">super</span>.getObjectMapper().readValue(result, javaType);</span><br><span class="line">        <span class="keyword">return</span> resultObj;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从HTTP输入消息中读取指定Java类型的对象，内部使用。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> javaType    要读取的对象的Java类型。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputMessage HTTP输入消息，包含要读取的JSON数据。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 从输入消息中解析出的对象。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 如果发生I/O错误。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> HttpMessageNotReadableException 如果消息无法读取。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readJavaType</span><span class="params">(JavaType javaType, HttpInputMessage inputMessage)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.getObjectMapper().readValue(inputMessage.getBody(), javaType);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">HttpMessageNotReadableException</span>(<span class="string">&quot;Could not read JSON: &quot;</span> + ex.getMessage(), ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将对象写入HTTP输出消息，同时应用XSS防护。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> object 要写入的对象。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputMessage HTTP输出消息，对象将被序列化为JSON并写入此消息。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 如果发生I/O错误。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> HttpMessageNotWritableException 如果消息无法写入。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeInternal</span><span class="params">(Object object, HttpOutputMessage outputMessage)</span></span><br><span class="line">            <span class="keyword">throws</span> IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">        <span class="comment">//得到要输出的json</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="built_in">super</span>.getObjectMapper().writeValueAsString(object);</span><br><span class="line">        <span class="comment">//过滤特殊字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> XssUtil.clean(json);</span><br><span class="line">        <span class="comment">// 输出</span></span><br><span class="line">        outputMessage.getBody().write(result.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在启动类添加：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HttpMessageConverters <span class="title function_">xssHttpMessageConverters</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">XSSMappingJackson2HttpMessageConverter</span> <span class="variable">xssMappingJackson2HttpMessageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSMappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    <span class="type">HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> xssMappingJackson2HttpMessageConverter;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpMessageConverters</span>(converter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot功能四【内置常用工具类】</title>
    <url>/cnblogs.github.io/p/32944.html</url>
    <content><![CDATA[<h3 id="字符串处理工具类"><a href="#字符串处理工具类" class="headerlink" title="字符串处理工具类"></a>字符串处理工具类</h3><h4 id="StringUtils"><a href="#StringUtils" class="headerlink" title="StringUtils"></a>StringUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查字符串是否为空</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty</span> <span class="operator">=</span> StringUtils.isEmpty(<span class="literal">null</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty2</span> <span class="operator">=</span> StringUtils.isEmpty(<span class="string">&quot;&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 检查字符串是否有文本内容</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">hasText</span> <span class="operator">=</span> StringUtils.hasText(<span class="string">&quot; &quot;</span>); <span class="comment">// false</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">hasText2</span> <span class="operator">=</span> StringUtils.hasText(<span class="string">&quot;hello&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 分割字符串</span></span><br><span class="line">String[] parts = StringUtils.tokenizeToStringArray(<span class="string">&quot;a,b,c&quot;</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="comment">// 清除首尾空白</span></span><br><span class="line"><span class="type">String</span> <span class="variable">trimmed</span> <span class="operator">=</span> StringUtils.trimWhitespace(<span class="string">&quot; hello &quot;</span>); <span class="comment">// &quot;hello&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="AntPathMatcher"><a href="#AntPathMatcher" class="headerlink" title="AntPathMatcher"></a>AntPathMatcher</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.AntPathMatcher;</span><br><span class="line"></span><br><span class="line"><span class="type">AntPathMatcher</span> <span class="variable">matcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">match1</span> <span class="operator">=</span> matcher.match(<span class="string">&quot;/users/*&quot;</span>, <span class="string">&quot;/users/123&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">match2</span> <span class="operator">=</span> matcher.match(<span class="string">&quot;/users/**&quot;</span>, <span class="string">&quot;/users/123/orders&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">match3</span> <span class="operator">=</span> matcher.match(<span class="string">&quot;/user?&quot;</span>, <span class="string">&quot;/user1&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 提取路径变量</span></span><br><span class="line">Map&lt;String, String&gt; vars = matcher.extractUriTemplateVariables(<span class="string">&quot;/users/&#123;id&#125;&quot;</span>, <span class="string">&quot;/users/42&quot;</span>); <span class="comment">// &#123;id=42&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="PatternMatchUtils"><a href="#PatternMatchUtils" class="headerlink" title="PatternMatchUtils"></a>PatternMatchUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.PatternMatchUtils;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">matches1</span> <span class="operator">=</span> PatternMatchUtils.simpleMatch(<span class="string">&quot;user*&quot;</span>, <span class="string">&quot;username&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">matches2</span> <span class="operator">=</span> PatternMatchUtils.simpleMatch(<span class="string">&quot;user?&quot;</span>, <span class="string">&quot;user1&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">matches3</span> <span class="operator">=</span> PatternMatchUtils.simpleMatch(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;user*&quot;</span>, <span class="string">&quot;admin*&quot;</span>&#125;, <span class="string">&quot;username&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="集合和数组工具类"><a href="#集合和数组工具类" class="headerlink" title="集合和数组工具类"></a>集合和数组工具类</h3><h4 id="CollectionUtils"><a href="#CollectionUtils" class="headerlink" title="CollectionUtils"></a>CollectionUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查集合是否为空</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty</span> <span class="operator">=</span> CollectionUtils.isEmpty(<span class="literal">null</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty2</span> <span class="operator">=</span> CollectionUtils.isEmpty(Collections.emptyList()); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 集合操作</span></span><br><span class="line">List&lt;String&gt; list1 = Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">List&lt;String&gt; list2 = Arrays.asList(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>);</span><br><span class="line">Collection&lt;String&gt; intersection = CollectionUtils.intersection(list1, list2); <span class="comment">// [b, c]</span></span><br><span class="line"><span class="comment">// 合并集合</span></span><br><span class="line">List&lt;String&gt; target = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">CollectionUtils.mergeArrayIntoCollection(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>&#125;, target);</span><br></pre></td></tr></table></figure>
<h4 id="MultiValueMap"><a href="#MultiValueMap" class="headerlink" title="MultiValueMap"></a>MultiValueMap</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.LinkedMultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"></span><br><span class="line">MultiValueMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">map.add(<span class="string">&quot;colors&quot;</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line">map.add(<span class="string">&quot;colors&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br><span class="line">map.add(<span class="string">&quot;sizes&quot;</span>, <span class="string">&quot;large&quot;</span>);</span><br><span class="line">List&lt;String&gt; colors = map.get(<span class="string">&quot;colors&quot;</span>); <span class="comment">// [red, blue]</span></span><br></pre></td></tr></table></figure>
<h4 id="ConcurrentReferenceHashMap"><a href="#ConcurrentReferenceHashMap" class="headerlink" title="ConcurrentReferenceHashMap"></a>ConcurrentReferenceHashMap</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ConcurrentReferenceHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建高并发场景下的引用Map (类似WeakHashMap但线程安全)</span></span><br><span class="line">Map&lt;String, Object&gt; cache = <span class="keyword">new</span> <span class="title class_">ConcurrentReferenceHashMap</span>&lt;&gt;();</span><br><span class="line">cache.put(<span class="string">&quot;key1&quot;</span>, <span class="keyword">new</span> <span class="title class_">LargeObject</span>());</span><br></pre></td></tr></table></figure>
<h3 id="反射和类处理工具"><a href="#反射和类处理工具" class="headerlink" title="反射和类处理工具"></a>反射和类处理工具</h3><h4 id="ReflectionUtils"><a href="#ReflectionUtils" class="headerlink" title="ReflectionUtils"></a>ReflectionUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类的字段</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectionUtils.findField(Person.class, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">ReflectionUtils.makeAccessible(field);</span><br><span class="line">ReflectionUtils.setField(field, person, <span class="string">&quot;John&quot;</span>);</span><br><span class="line"><span class="comment">// 调用方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(Person.class, <span class="string">&quot;setAge&quot;</span>, <span class="type">int</span>.class);</span><br><span class="line">ReflectionUtils.makeAccessible(method);</span><br><span class="line">ReflectionUtils.invokeMethod(method, person, <span class="number">30</span>);</span><br><span class="line"><span class="comment">// 字段回调</span></span><br><span class="line">ReflectionUtils.doWithFields(Person.class, field -&gt; &#123;</span><br><span class="line">   System.out.println(field.getName());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="ClassUtils"><a href="#ClassUtils" class="headerlink" title="ClassUtils"></a>ClassUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ClassUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取类名</span></span><br><span class="line"><span class="type">String</span> <span class="variable">shortName</span> <span class="operator">=</span> ClassUtils.getShortName(<span class="string">&quot;org.example.MyClass&quot;</span>); <span class="comment">// &quot;MyClass&quot;</span></span><br><span class="line"><span class="comment">// 检查类是否存在</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> ClassUtils.isPresent(<span class="string">&quot;java.util.List&quot;</span>, <span class="literal">null</span>); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// 获取所有接口</span></span><br><span class="line">Class&lt;?&gt;[] interfaces = ClassUtils.getAllInterfaces(ArrayList.class);</span><br><span class="line"><span class="comment">// 获取用户定义的类加载器</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassUtils.getDefaultClassLoader();</span><br></pre></td></tr></table></figure>
<h4 id="BeanUtils"><a href="#BeanUtils" class="headerlink" title="BeanUtils"></a>BeanUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制属性</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">30</span>);</span><br><span class="line"><span class="type">Person</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">BeanUtils.copyProperties(source, target);</span><br><span class="line"><span class="comment">// 实例化类</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">newPerson</span> <span class="operator">=</span> BeanUtils.instantiateClass(Person.class);</span><br><span class="line"><span class="comment">// 查找方法</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> BeanUtils.findMethod(Person.class, <span class="string">&quot;setName&quot;</span>, String.class);</span><br></pre></td></tr></table></figure>
<h3 id="I-O和资源工具"><a href="#I-O和资源工具" class="headerlink" title="I&#x2F;O和资源工具"></a>I&#x2F;O和资源工具</h3><h4 id="FileCopyUtils"><a href="#FileCopyUtils" class="headerlink" title="FileCopyUtils"></a>FileCopyUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.FileCopyUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制文件内容</span></span><br><span class="line"><span class="type">byte</span>[] bytes = FileCopyUtils.copyToByteArray(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;input.txt&quot;</span>));</span><br><span class="line">FileCopyUtils.copy(bytes, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;output.txt&quot;</span>));</span><br><span class="line"><span class="comment">// 读取文本</span></span><br><span class="line"><span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> FileCopyUtils.copyToString(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;input.txt&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"><span class="comment">// 流复制</span></span><br><span class="line">FileCopyUtils.copy(inputStream, outputStream);</span><br></pre></td></tr></table></figure>
<h3 id="Web相关工具类"><a href="#Web相关工具类" class="headerlink" title="Web相关工具类"></a>Web相关工具类</h3><h4 id="WebUtils"><a href="#WebUtils" class="headerlink" title="WebUtils"></a>WebUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.util.WebUtils;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取Cookie</span></span><br><span class="line"><span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> WebUtils.getCookie(request, <span class="string">&quot;sessionId&quot;</span>);</span><br><span class="line"><span class="comment">// 获取请求路径</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> WebUtils.getLookupPathForRequest(request);</span><br><span class="line"><span class="comment">// 从请求中获取参数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> WebUtils.getIntParameter(request, <span class="string">&quot;pageSize&quot;</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h4 id="UriUtils"><a href="#UriUtils" class="headerlink" title="UriUtils"></a>UriUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.util.UriUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编解码URI组件</span></span><br><span class="line"><span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> UriUtils.encodePathSegment(<span class="string">&quot;path with spaces&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">decoded</span> <span class="operator">=</span> UriUtils.decode(encoded, <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="验证和断言工具"><a href="#验证和断言工具" class="headerlink" title="验证和断言工具"></a>验证和断言工具</h3><h4 id="Assert"><a href="#Assert" class="headerlink" title="Assert"></a>Assert</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.Assert;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常用断言</span></span><br><span class="line">Assert.notNull(object, <span class="string">&quot;Object must not be null&quot;</span>);</span><br><span class="line">Assert.hasText(name, <span class="string">&quot;Name must not be empty&quot;</span>);</span><br><span class="line">Assert.isTrue(amount &gt; <span class="number">0</span>, <span class="string">&quot;Amount must be positive&quot;</span>);</span><br><span class="line">Assert.notEmpty(items, <span class="string">&quot;Items must not be empty&quot;</span>);</span><br><span class="line">Assert.state(isInitialized, <span class="string">&quot;Service is not initialized&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="ObjectUtils"><a href="#ObjectUtils" class="headerlink" title="ObjectUtils"></a>ObjectUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.ObjectUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象工具</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty</span> <span class="operator">=</span> ObjectUtils.isEmpty(<span class="literal">null</span>); <span class="comment">// true</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isEmpty2</span> <span class="operator">=</span> ObjectUtils.isEmpty(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]); <span class="comment">// true</span></span><br><span class="line"><span class="type">String</span> <span class="variable">nullSafe</span> <span class="operator">=</span> ObjectUtils.nullSafeToString(<span class="literal">null</span>); <span class="comment">// &quot;null&quot;</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">equals</span> <span class="operator">=</span> ObjectUtils.nullSafeEquals(obj1, obj2);</span><br><span class="line"><span class="comment">// 默认值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> ObjectUtils.getOrDefault(<span class="literal">null</span>, <span class="string">&quot;default&quot;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="NumberUtils"><a href="#NumberUtils" class="headerlink" title="NumberUtils"></a>NumberUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.NumberUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字转换</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">parsed</span> <span class="operator">=</span> NumberUtils.parseNumber(<span class="string">&quot;42&quot;</span>, Integer.class);</span><br><span class="line"><span class="type">Double</span> <span class="variable">converted</span> <span class="operator">=</span> NumberUtils.convertNumberToTargetClass(<span class="number">42</span>, Double.class);</span><br></pre></td></tr></table></figure>
<h3 id="日期和时间工具"><a href="#日期和时间工具" class="headerlink" title="日期和时间工具"></a>日期和时间工具</h3><h4 id="DateTimeUtils"><a href="#DateTimeUtils" class="headerlink" title="DateTimeUtils"></a>DateTimeUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.format.datetime.DateTimeFormatUtils;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化日期</span></span><br><span class="line"><span class="type">String</span> <span class="variable">formatted</span> <span class="operator">=</span> DateTimeFormatUtils.getDateTimeInstance().format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br></pre></td></tr></table></figure>
<h4 id="StopWatch"><a href="#StopWatch" class="headerlink" title="StopWatch"></a>StopWatch</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.StopWatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计时工具</span></span><br><span class="line"><span class="type">StopWatch</span> <span class="variable">watch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>(<span class="string">&quot;TaskName&quot;</span>);</span><br><span class="line">watch.start(<span class="string">&quot;phase1&quot;</span>);</span><br><span class="line"><span class="comment">// 执行任务1</span></span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line">watch.stop();</span><br><span class="line">watch.start(<span class="string">&quot;phase2&quot;</span>);</span><br><span class="line"><span class="comment">// 执行任务2</span></span><br><span class="line">Thread.sleep(<span class="number">200</span>);</span><br><span class="line">watch.stop();</span><br><span class="line"><span class="comment">// 输出报告</span></span><br><span class="line">System.out.println(watch.prettyPrint());</span><br><span class="line">System.out.println(<span class="string">&quot;Total time: &quot;</span> + watch.getTotalTimeMillis() + <span class="string">&quot;ms&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="安全相关工具"><a href="#安全相关工具" class="headerlink" title="安全相关工具"></a>安全相关工具</h3><h4 id="Base64Utils"><a href="#Base64Utils" class="headerlink" title="Base64Utils"></a>Base64Utils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.util.Base64Utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64编解码</span></span><br><span class="line"><span class="type">byte</span>[] data = <span class="string">&quot;Hello World&quot;</span>.getBytes();</span><br><span class="line"><span class="type">String</span> <span class="variable">encoded</span> <span class="operator">=</span> Base64Utils.encodeToString(data);</span><br><span class="line"><span class="type">byte</span>[] decoded = Base64Utils.decodeFromString(encoded);</span><br></pre></td></tr></table></figure>
<h3 id="JSON和数据转换工具"><a href="#JSON和数据转换工具" class="headerlink" title="JSON和数据转换工具"></a>JSON和数据转换工具</h3><h4 id="JsonUtils"><a href="#JsonUtils" class="headerlink" title="JsonUtils"></a>JsonUtils</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.json.JsonParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.json.JsonParserFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JSON解析</span></span><br><span class="line"><span class="type">JsonParser</span> <span class="variable">parser</span> <span class="operator">=</span> JsonParserFactory.getJsonParser();</span><br><span class="line">Map&lt;String, Object&gt; parsed = parser.parseMap(<span class="string">&quot;&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>John<span class="string">&quot;, &quot;</span>age<span class="string">&quot;:30&#125;&quot;</span>);</span><br><span class="line">List&lt;Object&gt; parsedList = parser.parseList(<span class="string">&quot;[1, 2, 3]&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="请求数据全链路追踪"><a href="#请求数据全链路追踪" class="headerlink" title="请求数据全链路追踪"></a>请求数据全链路追踪</h3><h4 id="CommonsRequestLoggingFilter"><a href="#CommonsRequestLoggingFilter" class="headerlink" title="CommonsRequestLoggingFilter"></a>CommonsRequestLoggingFilter</h4><p>在调试和监控阶段，记录请求的完整信息是定位问题的关键。Spring Boot 提供的 CommonsRequestLoggingFilter 可轻松实现请求数据的详细日志记录。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestLoggingConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommonsRequestLoggingFilter <span class="title function_">logFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CommonsRequestLoggingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonsRequestLoggingFilter</span>();</span><br><span class="line">        filter.setIncludeQueryString(<span class="literal">true</span>); <span class="comment">// 包含查询参数</span></span><br><span class="line">        filter.setIncludePayload(<span class="literal">true</span>);     <span class="comment">// 包含请求体</span></span><br><span class="line">        filter.setMaxPayloadLength(<span class="number">1024</span>);   <span class="comment">// 限制请求体日志长度（避免大字段溢出）</span></span><br><span class="line">        filter.setAfterMessagePrefix(<span class="string">&quot;[REQUEST DATA] &quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>在 application.properties 中开启 DEBUG 级日志 中开启 DEBUG 级日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=DEBUG</span><br></pre></td></tr></table></figure>
<h3 id="请求响应灵活操控"><a href="#请求响应灵活操控" class="headerlink" title="请求响应灵活操控"></a>请求响应灵活操控</h3><h4 id="内容缓存包装器"><a href="#内容缓存包装器" class="headerlink" title="内容缓存包装器"></a>内容缓存包装器</h4><p>原生 HttpServletRequest 和 HttpServletResponse 的输入输出流仅支持单次读取，这在需要多次处理数据（如日志记录与业务逻辑分离）时存在局限。Spring 提供的 ContentCachingRequestWrapper 和 ContentCachingResponseWrapper 完美解决了这一问题</p>
<ul>
<li>请求包装器（ContentCachingRequestWrapper） ： 缓存请求体字节数据，允许多次读取。典型场景：记录请求日志后，控制器仍能正常解析请求体。</li>
<li>响应包装器（ContentCachingResponseWrapper） ： 缓存响应输出流，支持在响应提交前修改内容（如添加签名、动态拼接数据）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 请求包装器过滤器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">publicclass RequestLogFilter <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 包装请求，缓存输入流</span></span><br><span class="line">        <span class="type">ContentCachingRequestWrapper</span> <span class="variable">wrappedRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentCachingRequestWrapper</span>(request);</span><br><span class="line">        <span class="type">byte</span>[] requestBody = wrappedRequest.getContentAsByteArray();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 记录请求日志（可在此处添加自定义逻辑）</span></span><br><span class="line">        log.debug(<span class="string">&quot;Received request body: &#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(requestBody));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 传递包装后的请求，确保后续组件能重复读取</span></span><br><span class="line">        filterChain.doFilter(wrappedRequest, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应包装器过滤器</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">publicclass ResponseSignFilter <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 包装响应，缓存输出流</span></span><br><span class="line">        <span class="type">ContentCachingResponseWrapper</span> <span class="variable">wrappedResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentCachingResponseWrapper</span>(response);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行后续处理（控制器逻辑）</span></span><br><span class="line">        filterChain.doFilter(request, wrappedResponse);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 响应后处理：添加签名</span></span><br><span class="line">        <span class="type">byte</span>[] responseBody = wrappedResponse.getContentAsByteArray();</span><br><span class="line">        <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> generateSignature(responseBody);</span><br><span class="line">        wrappedResponse.setHeader(<span class="string">&quot;X-Response-Signature&quot;</span>, signature);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 必须调用此方法将缓存内容写入原始响应</span></span><br><span class="line">        wrappedResponse.copyBodyToResponse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">generateSignature</span><span class="params">(<span class="type">byte</span>[] body)</span> &#123;</span><br><span class="line">        <span class="comment">// 自定义签名逻辑</span></span><br><span class="line">        <span class="keyword">return</span> Base64.getEncoder().encodeToString(body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AOP-开发助力"><a href="#AOP-开发助力" class="headerlink" title="AOP 开发助力"></a>AOP 开发助力</h3><h4 id="AopContext：代理对象访问器"><a href="#AopContext：代理对象访问器" class="headerlink" title="AopContext：代理对象访问器"></a>AopContext：代理对象访问器</h4><p>当同一类中方法调用导致注解（如 @Transactional）失效时，AopContext.currentProxy() 可获取当前代理对象，确保切面逻辑正确触发：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceImpl</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">innerMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 正常事务逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">outerMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 直接调用 innerMethod 会跳过代理，导致事务失效</span></span><br><span class="line">        <span class="comment">// 正确方式：通过代理对象调用</span></span><br><span class="line">        ((ServiceImpl) AopContext.currentProxy()).innerMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AopUtils：代理类型判断工具"><a href="#AopUtils：代理类型判断工具" class="headerlink" title="AopUtils：代理类型判断工具"></a>AopUtils：代理类型判断工具</h4><p>提供静态方法快速识别代理类型，便于动态处理不同代理逻辑：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (AopUtils.isJdkDynamicProxy(proxyObject)) &#123;</span><br><span class="line">    <span class="comment">// 处理 JDK 动态代理</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (AopUtils.isCglibProxy(proxyObject)) &#123;</span><br><span class="line">    <span class="comment">// 处理 CGLIB 代理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成一【Disruptor框架】</title>
    <url>/cnblogs.github.io/p/9240.html</url>
    <content><![CDATA[<p>在高并发系统中，传统的队列或锁机制往往无法满足极限情况下的性能需求。Disruptor 是由 LMAX 交易所开发的一种高性能并发框架，设计初衷就是为了解决高频金融交易中的并发处理问题。与传统的队列机制不同，Disruptor 采用环形缓冲区（RingBuffer）和无锁算法（Lock-Free Algorithm），最大程度地减少了线程上下文切换和内存屏障的开销，从而能够在高并发场景下提供极低的延迟和极高的吞吐量。</p>
<p><strong>Disruptor 的核心特性包括：</strong></p>
<ul>
<li>无锁设计：通过使用无锁算法，Disruptor 避免了传统锁机制的竞争问题，从而大幅提升了系统的吞吐量。</li>
<li>低延迟：Disruptor 可以在纳秒级别处理事件，确保系统在高并发场景下的极低延迟。</li>
<li>高吞吐量：由于无锁设计和高效的缓存使用，Disruptor 能够轻松处理每秒数百万级别的事件。</li>
<li>环形缓冲区：通过环形缓冲区，Disruptor 能够高效利用内存，并且避免了垃圾回收机制带来的性能损耗。</li>
</ul>
<h3 id="项目环境配置"><a href="#项目环境配置" class="headerlink" title="项目环境配置"></a>项目环境配置</h3><p>Maven 配置 (pom.xml)<br>首先，我们需要在 pom.xml 中引入必要的依赖项，包括 Spring Boot 和 Disruptor：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot 相关依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- Disruptor 依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.lmax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>disruptor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 其他依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Yaml 配置 (application.yml)<br>在 application.yml 中，我们可以进行一些常规的 Spring Boot 配置，例如端口号设置等：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">cache:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br></pre></td></tr></table></figure>

<h3 id="Disruptor-的核心实现"><a href="#Disruptor-的核心实现" class="headerlink" title="Disruptor 的核心实现"></a>Disruptor 的核心实现</h3><p>定义订单事件（OrderEvent）<br>首先，我们定义一个简单的订单事件类 OrderEvent，它将存储订单的基本信息：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义事件工厂（OrderEventFactory）事件工厂用于生成 OrderEvent 对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.EventFactory;</span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.entity.OrderEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventFactory</span> <span class="keyword">implements</span> <span class="title class_">EventFactory</span>&lt;OrderEvent&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> OrderEvent <span class="title function_">newInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderEvent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义事件处理器（OrderEventHandler）事件处理器是实际处理事件的地方。在这里，我们模拟订单处理的逻辑：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.entity.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.EventHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventHandler</span> <span class="keyword">implements</span> <span class="title class_">EventHandler</span>&lt;OrderEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onEvent</span><span class="params">(OrderEvent event, <span class="type">long</span> sequence, <span class="type">boolean</span> endOfBatch)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理订单的具体业务逻辑</span></span><br><span class="line">        processOrder(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(OrderEvent orderEvent)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟订单支付逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;处理订单: &quot;</span> + orderEvent.getOrderId() + <span class="string">&quot;, 用户: &quot;</span> + orderEvent.getUserId() + <span class="string">&quot;, 金额: &quot;</span> + orderEvent.getPrice());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 假设订单处理通过后更新订单状态</span></span><br><span class="line">        orderEvent.setStatus(<span class="string">&quot;已支付&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟库存扣减逻辑</span></span><br><span class="line">        reduceInventory(orderEvent);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;订单处理完成: &quot;</span> + orderEvent.getOrderId() + <span class="string">&quot; 状态: &quot;</span> + orderEvent.getStatus());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reduceInventory</span><span class="params">(OrderEvent orderEvent)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟库存扣减逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;扣减库存: 订单 &quot;</span> + orderEvent.getOrderId());</span><br><span class="line">        <span class="comment">// 假设库存扣减成功</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义生产者（OrderEventProducer）生产者负责将订单事件发布到 Disruptor 的 RingBuffer 中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.producer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.entity.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.RingBuffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventProducer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RingBuffer&lt;OrderEvent&gt; ringBuffer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderEventProducer</span><span class="params">(RingBuffer&lt;OrderEvent&gt; ringBuffer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ringBuffer = ringBuffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onData</span><span class="params">(String userId, <span class="type">double</span> price)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sequence</span> <span class="operator">=</span> ringBuffer.next();  <span class="comment">// 获取下一个序列号</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">OrderEvent</span> <span class="variable">orderEvent</span> <span class="operator">=</span> ringBuffer.get(sequence); <span class="comment">// 获取事件对象</span></span><br><span class="line">            orderEvent.setOrderId(UUID.randomUUID().toString());</span><br><span class="line">            orderEvent.setUserId(userId);</span><br><span class="line">            orderEvent.setPrice(price);</span><br><span class="line">            orderEvent.setStatus(<span class="string">&quot;未支付&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ringBuffer.publish(sequence);  <span class="comment">// 发布事件</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置 Disruptor 在 Spring Boot 中配置 Disruptor 并启动它：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lmax.disruptor.dsl.Disruptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.entity.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.factory.OrderEventFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DisruptorConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Disruptor&lt;OrderEvent&gt; <span class="title function_">disruptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">OrderEventFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderEventFactory</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">bufferSize</span> <span class="operator">=</span> <span class="number">1024</span>; <span class="comment">// RingBuffer 大小</span></span><br><span class="line"></span><br><span class="line">        Disruptor&lt;OrderEvent&gt; disruptor = <span class="keyword">new</span> <span class="title class_">Disruptor</span>&lt;&gt;(factory, bufferSize, Executors.defaultThreadFactory());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定事件处理器</span></span><br><span class="line">        disruptor.handleEventsWith(<span class="keyword">new</span> <span class="title class_">OrderEventHandler</span>());</span><br><span class="line">        disruptor.start();</span><br><span class="line">        <span class="keyword">return</span> disruptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OrderEventProducer <span class="title function_">orderEventProducer</span><span class="params">(Disruptor&lt;OrderEvent&gt; disruptor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderEventProducer</span>(disruptor.getRingBuffer());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生产订单事件,通过 REST API 接收订单请求，并将订单事件发布到 Disruptor：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.icoderoad.disruptor.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.icoderoad.disruptor.producer.OrderEventProducer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderEventProducer orderEventProducer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/create&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> OrderRequest orderRequest)</span> &#123;</span><br><span class="line">        orderEventProducer.onData(orderRequest.getUserId(), orderRequest.getPrice());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;订单创建成功，正在处理！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(<span class="type">double</span> price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="前端页面展示"><a href="#前端页面展示" class="headerlink" title="前端页面展示"></a>前端页面展示</h3><p>为了更直观地展示订单的创建，我们使用 Thymeleaf 模板引擎，配合 Bootstrap 构建一个简单的订单创建页面。<br>Thymeleaf 模板 (order.html)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>创建订单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>创建订单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;orderForm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;price&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-label&quot;</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">id</span>=<span class="string">&quot;price&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;orderForm&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> price = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;price&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;/orders/create&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">price</span>: price&#125;),</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title function_">alert</span>(data))</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>运行流程说明</strong></p>
<ul>
<li>当用户通过前端页面提交订单请求时，OrderController 接收到请求并调用 OrderEventProducer 发布订单事件。</li>
<li>订单事件发布到 Disruptor 的 RingBuffer 中，并自动触发 OrderEventHandler 的消费逻辑。</li>
<li>OrderEventHandler 处理订单的业务逻辑，包括支付处理、库存扣减等操作，并更新订单状态。</li>
<li>订单处理完成后，控制台输出相关处理信息。</li>
</ul>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成七【Redis框架】</title>
    <url>/cnblogs.github.io/p/5e10.html</url>
    <content><![CDATA[<p><strong>依赖配置</strong><br>在 Spring Boot3 项目中，需要引入spring-boot-starter-data-redis依赖，这是使用 Redis 功能的基础。如果您使用的是 Maven 项目，在pom.xml文件中添加以下代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>连接配置</strong><br>完成依赖引入后，接下来就是连接配置。在application.yml文件中，Spring Boot3 的 Redis 配置前缀变为spring.data.redis 。最基本的配置，就是设置 Redis 服务器的主机地址和端口号：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
<p>为了让连接性能更优，我们还可以对连接池进行配置。例如，设置最大活跃连接数、最大空闲连接数、最小空闲连接数、连接等待时间等参数：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">lettuce:</span></span><br><span class="line">        <span class="attr">pool:</span></span><br><span class="line">          <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">          <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">          <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">max-wait:</span> <span class="string">10000ms</span></span><br></pre></td></tr></table></figure>
<p><strong>序列化配置</strong><br>在实际使用中，存入 Redis 的数据如果不进行正确的序列化配置，很容易出现乱码问题。这时，我们可以通过自定义配置类，对RedisTemplate进行配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">// 设置key的序列化方式</span></span><br><span class="line">        template.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">// 设置hash的key的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">// 设置value的序列化方式</span></span><br><span class="line">        template.setValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line">        <span class="comment">// 设置hash的value的序列化方式</span></span><br><span class="line">        template.setHashValueSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成三【Knife4j增强框架】</title>
    <url>/cnblogs.github.io/p/4b15.html</url>
    <content><![CDATA[<p>Knife4j是基于Swagger的API文档增强工具，为Java开发者提供了一套更强大、更美观的API文档解决方案。它就像是API文档界的”瑞士军刀”，不仅保留了Swagger的所有功能，还增加了许多实用特性。</p>
<h2 id="Spring-Boot基础集成Knife4j"><a href="#Spring-Boot基础集成Knife4j" class="headerlink" title="Spring Boot基础集成Knife4j"></a>Spring Boot基础集成Knife4j</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1 环境准备"></a>1 环境准备</h3><ul>
<li>创建Spring Boot项目（2.3.x以上版本）</li>
<li>确保项目已包含Spring MVC依赖</li>
</ul>
<h3 id="2-添加Maven依赖"><a href="#2-添加Maven依赖" class="headerlink" title="2 添加Maven依赖"></a>2 添加Maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Knife4j核心依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Springfox Swagger依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-基础配置类"><a href="#3-基础配置类" class="headerlink" title="3 基础配置类"></a>3 基础配置类</h3><p>创建Swagger配置类SwaggerConfig.java：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2WebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                <span class="comment">// 指定API的基本信息</span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                <span class="comment">// 选择哪些接口暴露给Swagger</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">// 扫描所有有注解的api</span></span><br><span class="line">                .apis(RequestHandlerSelectors.withMethodAnnotation(ApiOperation.class))</span><br><span class="line">                <span class="comment">// 扫描指定包中的类</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.controller&quot;</span>))</span><br><span class="line">                <span class="comment">// 扫描所有</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;电商系统API文档&quot;</span>)  <span class="comment">// 文档标题</span></span><br><span class="line">                .description(<span class="string">&quot;电商系统接口文档说明&quot;</span>)  <span class="comment">// 文档描述</span></span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;开发者&quot;</span>, <span class="string">&quot;https://example.com&quot;</span>, <span class="string">&quot;dev@example.com&quot;</span>))  <span class="comment">// 联系人信息</span></span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)  <span class="comment">// 版本号</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-添加Controller示例"><a href="#4-添加Controller示例" class="headerlink" title="4 添加Controller示例"></a>4 添加Controller示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户管理接口&quot;)</span>  <span class="comment">// Swagger注解，指定模块名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据ID获取用户&quot;, notes = &quot;传入用户ID，返回用户详细信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> <span class="meta">@ApiParam(value = &quot;用户ID&quot;, example = &quot;1&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟数据</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(id, <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;zhangsan@example.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;创建用户&quot;, notes = &quot;传入用户信息，创建新用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> <span class="meta">@Valid</span> <span class="meta">@ApiParam(value = &quot;用户信息&quot;, required = true)</span> User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟保存操作</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;用户实体&quot;)</span>  <span class="comment">// Swagger注解，描述模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户ID&quot;, example = &quot;1&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;用户名&quot;, example = &quot;张三&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;邮箱&quot;, example = &quot;user@example.com&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造方法、getter/setter省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-访问Knife4j文档"><a href="#5-访问Knife4j文档" class="headerlink" title="5 访问Knife4j文档"></a>5 访问Knife4j文档</h3><p>启动应用后，访问以下URL：</p>
<ul>
<li>默认Swagger文档：<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></li>
<li>Knife4j增强文档：<a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></li>
</ul>
<h2 id="Knife4j高级配置与功能"><a href="#Knife4j高级配置与功能" class="headerlink" title="Knife4j高级配置与功能"></a>Knife4j高级配置与功能</h2><h3 id="1-分组功能配置"><a href="#1-分组功能配置" class="headerlink" title="1 分组功能配置"></a>1 分组功能配置</h3><p>在实际开发中，我们可能需要将API按模块分组展示：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">userApi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">            .groupName(<span class="string">&quot;用户模块&quot;</span>)  <span class="comment">// 分组名称</span></span><br><span class="line">            .apiInfo(apiInfo())</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.controller.user&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">orderApi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">            .groupName(<span class="string">&quot;订单模块&quot;</span>)</span><br><span class="line">            .apiInfo(apiInfo())</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.controller.order&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-接口权限控制"><a href="#2-接口权限控制" class="headerlink" title="2 接口权限控制"></a>2 接口权限控制</h3><p>Knife4j支持对文档进行权限控制，保护敏感接口：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application.yml配置</span></span><br><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">production:</span> <span class="literal">false</span>  <span class="comment"># 生产环境设为true会禁用文档</span></span><br><span class="line">  <span class="attr">basic:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span>     <span class="comment"># 开启基础认证</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span>  <span class="comment"># 登录用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span> <span class="comment"># 登录密码</span></span><br></pre></td></tr></table></figure>
<h3 id="3-全局参数配置"><a href="#3-全局参数配置" class="headerlink" title="3 全局参数配置"></a>3 全局参数配置</h3><p>配置全局Header参数，如token认证：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">            .apiInfo(apiInfo())</span><br><span class="line">            .globalRequestParameters(</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">RequestParameterBuilder</span>()</span><br><span class="line">                        .name(<span class="string">&quot;Authorization&quot;</span>)  <span class="comment">// 参数名</span></span><br><span class="line">                        .description(<span class="string">&quot;认证token&quot;</span>)  <span class="comment">// 描述</span></span><br><span class="line">                        .in(ParameterType.HEADER)  <span class="comment">// 参数位置</span></span><br><span class="line">                        .required(<span class="literal">true</span>)  <span class="comment">// 是否必须</span></span><br><span class="line">                        .build()</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            .select()</span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.controller&quot;</span>))</span><br><span class="line">            .paths(PathSelectors.any())</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Knife4j进阶功能"><a href="#Knife4j进阶功能" class="headerlink" title="Knife4j进阶功能"></a>Knife4j进阶功能</h2><h3 id="1-接口排序功能"><a href="#1-接口排序功能" class="headerlink" title="1 接口排序功能"></a>1 接口排序功能</h3><p>通过@ApiOperationSupport注解实现接口排序：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;获取用户列表&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperationSupport(order = 1)</span>  <span class="comment">// 数字越小越靠前</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;List&lt;User&gt;&gt; <span class="title function_">getUserList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 实现逻辑</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;创建用户&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperationSupport(order = 2)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">    <span class="comment">// 实现逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-接口缓存设置"><a href="#2-接口缓存设置" class="headerlink" title="2 接口缓存设置"></a>2 接口缓存设置</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;获取用户详情&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperationSupport(</span></span><br><span class="line"><span class="meta">    author = &quot;developer&quot;,</span></span><br><span class="line"><span class="meta">    params = @DynamicParameters(</span></span><br><span class="line"><span class="meta">        properties = &#123;</span></span><br><span class="line"><span class="meta">            @DynamicParameter(name = &quot;id&quot;, value = &quot;用户ID&quot;, example = &quot;1&quot;)</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">    ),</span></span><br><span class="line"><span class="meta">    responses = @DynamicResponseParameters(</span></span><br><span class="line"><span class="meta">        properties = &#123;</span></span><br><span class="line"><span class="meta">            @DynamicParameter(name = &quot;code&quot;, value = &quot;状态码&quot;, example = &quot;200&quot;),</span></span><br><span class="line"><span class="meta">            @DynamicParameter(name = &quot;data&quot;, value = &quot;用户数据&quot;)</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">    ),</span></span><br><span class="line"><span class="meta">    cache = @ApiOperationCache(time = 60)  // 缓存60秒</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 实现逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-离线文档生成"><a href="#3-离线文档生成" class="headerlink" title="3 离线文档生成"></a>3 离线文档生成</h3><p>通过代码生成离线文档：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OpenApiResource openApiResource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/generate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateOfflineDocument</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 获取OpenAPI对象</span></span><br><span class="line">    <span class="type">OpenAPI</span> <span class="variable">openAPI</span> <span class="operator">=</span> openApiResource.getOpenApi();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用Knife4j提供的工具类生成文档</span></span><br><span class="line">    <span class="type">byte</span>[] markdownBytes = Knife4jDocUtil.openApiToMarkdown(openAPI);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置响应头</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=api-doc.md&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 输出文档</span></span><br><span class="line">    response.getOutputStream().write(markdownBytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实际案例：电商系统API文档"><a href="#实际案例：电商系统API文档" class="headerlink" title="实际案例：电商系统API文档"></a>实际案例：电商系统API文档</h2><h3 id="1-商品模块示例"><a href="#1-商品模块示例" class="headerlink" title="1 商品模块示例"></a>1 商品模块示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/product&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;商品管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;分页查询商品&quot;, notes = &quot;支持分页和条件查询&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">        @ApiImplicitParam(name = &quot;page&quot;, value = &quot;页码&quot;, defaultValue = &quot;1&quot;),</span></span><br><span class="line"><span class="meta">        @ApiImplicitParam(name = &quot;size&quot;, value = &quot;每页数量&quot;, defaultValue = &quot;10&quot;),</span></span><br><span class="line"><span class="meta">        @ApiImplicitParam(name = &quot;name&quot;, value = &quot;商品名称&quot;, required = false)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Page&lt;Product&gt;&gt; <span class="title function_">getProducts</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> <span class="type">int</span> page,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(required = false)</span> String name)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;/stock&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;调整库存&quot;, notes = &quot;增加或减少商品库存&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperationSupport(order = 3)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">adjustStock</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> Long id,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> <span class="meta">@Valid</span> StockAdjustment adjustment)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel(&quot;库存调整DTO&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StockAdjustment</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;调整数量&quot;, example = &quot;10&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> quantity;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;操作类型&quot;, example = &quot;INCREASE&quot;, allowableValues = &quot;INCREASE,DECREASE&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> OperationType type;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;备注&quot;, example = &quot;补货入库&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">OperationType</span> &#123;</span><br><span class="line">    INCREASE, DECREASE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-订单模块示例"><a href="#2-订单模块示例" class="headerlink" title="2 订单模块示例"></a>2 订单模块示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/order&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;创建订单&quot;, notes = &quot;根据购物车信息创建订单&quot;)</span></span><br><span class="line">    <span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 400, message = &quot;参数校验失败&quot;),</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 403, message = &quot;权限不足&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Order&gt; <span class="title function_">createOrder</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> <span class="meta">@Valid</span> CreateOrderRequest request,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;orderNo&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询订单详情&quot;, notes = &quot;根据订单号查询订单详情&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperationSupport(order = 1)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Order&gt; <span class="title function_">getOrder</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@PathVariable</span> <span class="meta">@ApiParam(value = &quot;订单号&quot;, example = &quot;ORD20230001&quot;)</span> String orderNo)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel(&quot;创建订单请求&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateOrderRequest</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品项列表&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;收货地址ID&quot;, example = &quot;1&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> Long addressId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;备注&quot;, example = &quot;请尽快发货&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel(&quot;订单商品项&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderItem</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;商品ID&quot;, example = &quot;1&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> Long productId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;购买数量&quot;, example = &quot;2&quot;, required = true)</span></span><br><span class="line">    <span class="keyword">private</span> Integer quantity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成二【Jasypt框架】</title>
    <url>/cnblogs.github.io/p/7542.html</url>
    <content><![CDATA[<h2 id="配置文件明文加密"><a href="#配置文件明文加密" class="headerlink" title="配置文件明文加密"></a>配置文件明文加密</h2><h3 id="1-引入依赖（XTHS：第一步）"><a href="#1-引入依赖（XTHS：第一步）" class="headerlink" title="1 引入依赖（XTHS：第一步）"></a>1 引入依赖（XTHS：第一步）</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jasypt<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-编写加密工具（XTHS：第二步）"><a href="#2-编写加密工具（XTHS：第二步）" class="headerlink" title="2 编写加密工具（XTHS：第二步）"></a>2 编写加密工具（XTHS：第二步）</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zd.channel.cs.utils;</span><br><span class="line"><span class="keyword">import</span> org.jasypt.encryption.pbe.StandardPBEStringEncryptor;</span><br><span class="line"><span class="keyword">import</span> org.jasypt.encryption.pbe.config.EnvironmentStringPBEConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * alibaba druid加解密规则：</span></span><br><span class="line"><span class="comment"> * 明文密码+私钥(privateKey)加密=加密密码</span></span><br><span class="line"><span class="comment"> * 加密密码+公钥(publicKey)解密=明文密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">JasyptUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密算法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PBEWITHMD5ANDDES</span> <span class="operator">=</span> <span class="string">&quot;PBEWithMD5AndDES&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text  待加密原文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> crack 盐值（密钥）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密后的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: Jasypt加密（PBEWithMD5AndDES）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptWithMD5</span><span class="params">(String text, String crack)</span> &#123;</span><br><span class="line">        <span class="comment">//1.创建加解密工具实例</span></span><br><span class="line">        <span class="type">StandardPBEStringEncryptor</span> <span class="variable">encryptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardPBEStringEncryptor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.加解密配置</span></span><br><span class="line">        <span class="type">EnvironmentStringPBEConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnvironmentStringPBEConfig</span>();</span><br><span class="line">        config.setAlgorithm(PBEWITHMD5ANDDES);</span><br><span class="line">        config.setPassword(crack);</span><br><span class="line">        encryptor.setConfig(config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.加密</span></span><br><span class="line">        <span class="keyword">return</span> encryptor.encrypt(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text  待解密原文</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> crack 盐值（密钥）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 解密后的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: Jasypt解密（PBEWithMD5AndDES）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decryptWithMD5</span><span class="params">(String text, String crack)</span> &#123;</span><br><span class="line">        <span class="type">StandardPBEStringEncryptor</span> <span class="variable">encryptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardPBEStringEncryptor</span>();</span><br><span class="line">        <span class="type">EnvironmentStringPBEConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnvironmentStringPBEConfig</span>();</span><br><span class="line">        config.setAlgorithm(PBEWITHMD5ANDDES);</span><br><span class="line">        config.setPassword(crack);</span><br><span class="line">        encryptor.setConfig(config);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> encryptor.decrypt(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// String s = encryptWithMD5(&quot;明文&quot;, &quot;密钥&quot;);</span></span><br><span class="line">        <span class="comment">// System.out.println(s);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">channelcs1</span> <span class="operator">=</span> decryptWithMD5(<span class="string">&quot;密文&quot;</span>, <span class="string">&quot;密钥&quot;</span>);</span><br><span class="line">        System.out.println(channelcs1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-加密配置类（XTHS：第三步）"><a href="#3-加密配置类（XTHS：第三步）" class="headerlink" title="3 加密配置类（XTHS：第三步）"></a>3 加密配置类（XTHS：第三步）</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jasypt.encryption.StringEncryptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomEncryptorConfig</span> <span class="keyword">implements</span> <span class="title class_">StringEncryptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密解密的 密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">crack</span> <span class="operator">=</span> <span class="string">&quot;密钥&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JasyptUtils.encryptWithMD5(s,crack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decrypt</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> JasyptUtils.decryptWithMD5(s,crack);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-配置文件（XTHS：第四步）"><a href="#4-配置文件（XTHS：第四步）" class="headerlink" title="4 配置文件（XTHS：第四步）"></a>4 配置文件（XTHS：第四步）</h3><p>需要加密的内容使用：ENC(密码)格式书写。ENC 是一个特殊的前缀，用于标识被加密过的字符串。当你在配置文件中使用 ENC 前缀时，Jasypt 会自动识别这是一个被加密的属性，然后在应用启动时解密它并将解密后的值应用于相应的配置属性。这允许你在配置文件中以加密的方式存储敏感信息（如密码），同时在应用中解密并使用这些值。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">dynamic:</span></span><br><span class="line">      <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">master:</span></span><br><span class="line">          <span class="comment">#type: com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">……</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">ENC(3hoLALpSHwctWRbBFJGy1x40gMv78JEG)</span></span><br><span class="line">        <span class="attr">slave:</span></span><br><span class="line">          <span class="comment">#type: com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">          <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">          <span class="attr">url:</span> <span class="string">……</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">ENC(3hoLALpSHwctWRbBFJGy1x40gMv78JEG)</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">60</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">600000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">1800000</span></span><br></pre></td></tr></table></figure>
<h3 id="5-更安全一些"><a href="#5-更安全一些" class="headerlink" title="5 更安全一些"></a>5 更安全一些</h3><p>上面我们是把密钥写在了代码中，这样做也是有些不太安全的。我们可以使用命令行的方式将密钥传入。在配置文件中加上如下的配置，用于接收启动项目时传入的配置参数：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">encrypted:</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;jasypt.encryptor.password&#125;</span></span><br></pre></td></tr></table></figure>
<p>生成密文时，我们也可以不适用工具类，而是使用命令，步骤如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar your-application.jar -Djasypt.encryptor.password=你的密钥</span><br></pre></td></tr></table></figure>
<ul>
<li>加密：java -cp jasypt-1.9.2.jar org.jasypt.intf.cli.JasyptPBEStringEncryptionCLI input&#x3D;”要加密的值” password&#x3D;”加密密码” algorithm&#x3D;”加密算法”</li>
<li>解密：java -cp jasypt-1.9.2.jar org.jasypt.intf.cli.JasyptPBEStringDecryptionCLI input&#x3D;”加密后的值” password&#x3D;”加密密码” algorithm&#x3D;”加密算法”</li>
</ul>
<h2 id="数据库字段自动加密解密"><a href="#数据库字段自动加密解密" class="headerlink" title="数据库字段自动加密解密"></a>数据库字段自动加密解密</h2><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Database Configuration</span></span><br><span class="line"><span class="string">spring.datasource.url=jdbc:mysql://localhost:3306/mytestdb?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="string">spring.datasource.username=root</span></span><br><span class="line"><span class="string">spring.datasource.password=password</span></span><br><span class="line"><span class="string">spring.jpa.hibernate.ddl-auto=update</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jasypt Configuration</span></span><br><span class="line"><span class="string">jasypt.encryptor.password=yourSecretKey</span></span><br></pre></td></tr></table></figure>
<h3 id="实体类中标记需要加密的字段"><a href="#实体类中标记需要加密的字段" class="headerlink" title="实体类中标记需要加密的字段"></a>实体类中标记需要加密的字段</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jasypt.annotation.Encryptable;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Encryptable</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Encryptable</span></span><br><span class="line">    <span class="keyword">private</span> String email; <span class="comment">// 邮箱字段，需要加密</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标准的JPA操作，不需要额外的配置来支持加密功能。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="控制层"><a href="#控制层" class="headerlink" title="控制层"></a>控制层</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成五【ApacheSpark框架】</title>
    <url>/cnblogs.github.io/p/f789.html</url>
    <content><![CDATA[<p>随着互联网行业的飞速发展，企业对数据的依赖程度越来越高。在互联网大厂的业务场景中，每天都会产生海量的业务数据，这些数据蕴含着巨大的商业价值。Spring Boot 作为一款流行的 Java 微服务框架，因其快速开发、易于部署等特点，被广泛应用于后端服务开发。而 Apache Spark 作为一个快速、通用的大数据处理引擎，能够高效地处理大规模数据。MySQL 则是最常用的关系型数据库之一，存储着企业的核心业务数据。将 Spring Boot、Apache Spark 和 MySQL 三者整合起来，实现高效的数据处理，成为了众多后端开发人员迫切需要解决的问题。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>首先要确保本地已经安装好 JDK 。JDK 的版本选择至关重要，Spring Boot 2.x 版本推荐使用 JDK 8 及以上版本，而 Apache Spark 3.x 则要求 JDK 1.8 或更高版本 。如果版本不匹配，可能会出现各种兼容性问题，导致项目无法正常运行。<br>完成 JDK 安装后，打开你的 Spring Boot 项目，找到项目的 pom.xml 文件。在 <dependencies> 标签内，添加 Apache Spark 和 MySQL 的依赖。对于 Apache Spark，除了添加 spark-core、spark-sql 核心依赖外，由于我们要通过 JDBC 连接 MySQL，还需要添加 spark-jdbc 依赖。具体代码如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-jdbc_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的版本号可以根据实际情况进行调整，但要注意不同版本之间可能存在的差异，比如某些新特性在旧版本中不支持，或者旧版本的语法在新版本中会报错。</p>
<h2 id="配置-Spark-和-MySQL-连接信息"><a href="#配置-Spark-和-MySQL-连接信息" class="headerlink" title="配置 Spark 和 MySQL 连接信息"></a>配置 Spark 和 MySQL 连接信息</h2><p>配置环节需要在 Spring Boot 的配置文件中进行操作，你可以选择 application.properties 或 application.yml ，这里以 application.yml 为例进行说明。<br>在 application.yml 中，首先配置 Spring Boot 的数据源信息。url 字段填写 MySQL 数据库的连接地址，其中 localhost 是数据库服务器地址，如果数据库部署在远程服务器，需要替换为对应的 IP 地址；3306 是 MySQL 的默认端口号，若端口有修改需对应调整；your_database 替换为实际的数据库名称；useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8 用于设置字符编码，保证中文等特殊字符正常显示；serverTimezone&#x3D;Asia&#x2F;Shanghai 用于设置时区，避免时间显示错误。username 和 password 分别填写数据库的用户名和密码。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/your_database?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">your_username</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">your_password</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p>接着配置 Spark 的相关信息。master 字段设置 Spark 的运行模式，local[<em>] 表示在本地以多线程模式运行，</em> 代表使用本地所有可用的 CPU 核心，适合本地开发和测试。如果是在集群环境中运行，需要填写集群的 Master 地址。app.name 用于设置 Spark 应用的名称，方便在监控和日志中识别。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spark:</span></span><br><span class="line">  <span class="attr">master:</span> <span class="string">local[*]</span></span><br><span class="line">  <span class="attr">app.name:</span> <span class="string">SpringBootSparkMySQL</span></span><br></pre></td></tr></table></figure>
<h2 id="编写数据读取代码"><a href="#编写数据读取代码" class="headerlink" title="编写数据读取代码"></a>编写数据读取代码</h2><p>在 Spring Boot 的服务类中编写数据读取逻辑。首先创建一个新的 Java 类，比如 DataProcessingService 。在类中，通过 Spark 的 SparkSession 来创建与 MySQL 数据库的连接，并读取数据。<br>SparkSession 是 Spark 2.0 引入的新的入口点，它融合了 SparkContext、SQLContext 等功能，使用起来更加方便。通过 builder() 方法构建 SparkSession 实例，设置应用名称和运行模式，然后调用 getOrCreate() 方法获取或创建一个 SparkSession 。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.Dataset;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.Row;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataProcessingService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Dataset&lt;Row&gt; <span class="title function_">readDataFromMySQL</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SparkSession</span> <span class="variable">spark</span> <span class="operator">=</span> SparkSession.builder()</span><br><span class="line">               .appName(<span class="string">&quot;ReadFromMySQL&quot;</span>)</span><br><span class="line">               .master(<span class="string">&quot;local[*]&quot;</span>)</span><br><span class="line">               .getOrCreate();</span><br><span class="line">        Dataset&lt;Row&gt; data = spark.read()</span><br><span class="line">               .format(<span class="string">&quot;jdbc&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;jdbc:mysql://localhost:3306/your_database?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;dbtable&quot;</span>, <span class="string">&quot;your_table&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;your_username&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;your_password&quot;</span>)</span><br><span class="line">               .load();</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码中，format(“jdbc”) 表示使用 JDBC 方式读取数据；option(“dbtable”, “your_table”) 中的 your_table 要替换为实际需要读取数据的表名。读取到的数据会以 Dataset<Row> 的形式返回，后续可以对其进行各种操作。</p>
<h2 id="数据处理：释放-Apache-Spark-的强大能力"><a href="#数据处理：释放-Apache-Spark-的强大能力" class="headerlink" title="数据处理：释放 Apache Spark 的强大能力"></a>数据处理：释放 Apache Spark 的强大能力</h2><p>得到数据后，就可以利用 Apache Spark 强大的数据处理能力对数据进行清洗、转换、分析等操作。<br>比如数据清洗环节，如果数据中存在空值，可以使用 na() 方法进行处理。想要删除包含空值的行，可以调用 drop() 方法；如果想用指定的值填充空值，则调用 fill() 方法。以下是删除包含空值行的示例代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Dataset&lt;Row&gt; cleanedData = data.na().drop();</span><br></pre></td></tr></table></figure>
<p>数据转换方面，假设数据库表中有一个 timestamp 类型的字段，需要将其转换为日期格式。可以使用 withColumn() 方法和日期函数来实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types.DataTypes;</span><br><span class="line"></span><br><span class="line">Dataset&lt;Row&gt; transformedData = data.withColumn(<span class="string">&quot;date&quot;</span>, functions.to_date(data.col(<span class="string">&quot;timestamp&quot;</span>), <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>在数据分析查询时，Spark SQL 提供了强大的功能。例如，要统计某个表中不同用户的订单数量，可以使用以下代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Dataset&lt;Row&gt; result = data.groupBy(<span class="string">&quot;user_id&quot;</span>).count();</span><br></pre></td></tr></table></figure>
<h2 id="数据写入：将处理结果存回数据库"><a href="#数据写入：将处理结果存回数据库" class="headerlink" title="数据写入：将处理结果存回数据库"></a>数据写入：将处理结果存回数据库</h2><p>最后，将处理后的数据写回到 MySQL 数据库或者以其他形式进行展示。这里重点讲解写回 MySQL 数据库的操作。同样在 DataProcessingService 类中添加数据写入方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.Dataset;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.Row;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataProcessingService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeDataToMySQL</span><span class="params">(Dataset&lt;Row&gt; processedData)</span> &#123;</span><br><span class="line">        <span class="type">SparkSession</span> <span class="variable">spark</span> <span class="operator">=</span> SparkSession.builder()</span><br><span class="line">               .appName(<span class="string">&quot;WriteToMySQL&quot;</span>)</span><br><span class="line">               .master(<span class="string">&quot;local[*]&quot;</span>)</span><br><span class="line">               .getOrCreate();</span><br><span class="line">        processedData.write()</span><br><span class="line">               .format(<span class="string">&quot;jdbc&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;jdbc:mysql://localhost:3306/your_database?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;dbtable&quot;</span>, <span class="string">&quot;result_table&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;your_username&quot;</span>)</span><br><span class="line">               .option(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;your_password&quot;</span>)</span><br><span class="line">               .mode(<span class="string">&quot;append&quot;</span>)</span><br><span class="line">               .save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mode(“append”) 表示以追加的方式将数据写入表中，如果表不存在会自动创建；如果希望覆盖原有数据，可以使用 mode(“overwrite”) ；mode(“ignore”) 则表示如果数据已存在，忽略此次写入操作。result_table 替换为实际要写入数据的表名。</p>
<p>通过以上详细步骤，我们就能在 Spring Boot 中成功整合 Apache Spark 技术实现链接 MySQL 数据库的数据处理。在实际的互联网大厂项目开发中，这种技术整合能够显著提升数据处理的效率和性能，满足企业对海量数据处理的需求。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成八【MyBatis框架】</title>
    <url>/cnblogs.github.io/p/a56c.html</url>
    <content><![CDATA[<h3 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h3><p>在 Spring Boot3 项目中，首先需要在pom.xml文件中添加 MyBatis 和 Spring Boot 整合的依赖。确保使用的mybatis-spring-boot-starter版本与 Spring Boot 3 兼容。例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时，根据项目所使用的数据库类型，添加相应的数据库驱动依赖。比如使用 MySQL 数据库，添加如下依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mapper-接口定义"><a href="#Mapper-接口定义" class="headerlink" title="Mapper 接口定义"></a>Mapper 接口定义</h3><p>创建 Mapper 接口，在接口中定义数据库操作方法。例如，创建一个UserMapper接口，用于对用户表进行操作：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用了@Mapper注解，它可以让 Spring Boot 自动将 Mapper 接口注册为 Bean。如果项目中 Mapper 接口较多，可以在启动类上使用@MapperScan注解指定 Mapper 接口所在的包，如@MapperScan(“com.example.demo.mapper”) ，这样就无需在每个 Mapper 接口上都添加@Mapper注解。</p>
<h3 id="Mapper-XML-文件配置"><a href="#Mapper-XML-文件配置" class="headerlink" title="Mapper XML 文件配置"></a>Mapper XML 文件配置</h3><p>创建与 Mapper 接口对应的 Mapper XML 文件，例如UserMapper.xml。在 XML 文件中编写具体的 SQL 语句，并通过namespace属性与 Mapper 接口进行关联。示例如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.demo.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.demo.entity.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，application.properties或application.yml配置文件中的mybatis.mapper-locations属性要正确指向 Mapper XML 文件的位置，如mybatis.mapper-locations&#x3D;classpath:mapper&#x2F;*.xml。</p>
<h3 id="使用-Mapper-接口"><a href="#使用-Mapper-接口" class="headerlink" title="使用 Mapper 接口"></a>使用 Mapper 接口</h3><p>在 Service 层或 Controller 层中，通过依赖注入的方式使用 Mapper 接口。例如，在 Service 层：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.getAllUsers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Controller 层：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUsers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成六【ClickHouse框架】</title>
    <url>/cnblogs.github.io/p/43c0.html</url>
    <content><![CDATA[<p>该案例基于：SpringBoot2, Druid连接池和mybatis进行整合。Druid 1.1.10 版本 SQL Parser对clickhouse的开始提供支持。</p>
<h2 id="核心依赖"><a href="#核心依赖" class="headerlink" title="核心依赖"></a>核心依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ru.yandex.clickhouse<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>clickhouse-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.53<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="配属数据源"><a href="#配属数据源" class="headerlink" title="配属数据源"></a>配属数据源</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">click:</span></span><br><span class="line">      <span class="attr">driverClassName:</span> <span class="string">ru.yandex.clickhouse.ClickHouseDriver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:clickhouse://127.0.0.1:8123/default</span></span><br><span class="line">      <span class="attr">initialSize:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maxActive:</span> <span class="number">100</span></span><br><span class="line">      <span class="attr">minIdle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maxWait:</span> <span class="number">6000</span></span><br></pre></td></tr></table></figure>
<h2 id="Druid连接池配置"><a href="#Druid连接池配置" class="headerlink" title="Druid连接池配置"></a>Druid连接池配置</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JdbcParamConfig jdbcParamConfig ;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">datasource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        datasource.setUrl(jdbcParamConfig.getUrl());</span><br><span class="line">        datasource.setDriverClassName(jdbcParamConfig.getDriverClassName());</span><br><span class="line">        datasource.setInitialSize(jdbcParamConfig.getInitialSize());</span><br><span class="line">        datasource.setMinIdle(jdbcParamConfig.getMinIdle());</span><br><span class="line">        datasource.setMaxActive(jdbcParamConfig.getMaxActive());</span><br><span class="line">        datasource.setMaxWait(jdbcParamConfig.getMaxWait());</span><br><span class="line">        <span class="keyword">return</span> datasource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参数配置类"><a href="#参数配置类" class="headerlink" title="参数配置类"></a>参数配置类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource.click&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcParamConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String driverClassName ;</span><br><span class="line">    <span class="keyword">private</span> String url ;</span><br><span class="line">    <span class="keyword">private</span> Integer initialSize ;</span><br><span class="line">    <span class="keyword">private</span> Integer maxActive ;</span><br><span class="line">    <span class="keyword">private</span> Integer minIdle ;</span><br><span class="line">    <span class="keyword">private</span> Integer maxWait ;</span><br><span class="line">    <span class="comment">// 省略 GET 和 SET</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Mapper接口"><a href="#Mapper接口" class="headerlink" title="Mapper接口"></a>Mapper接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserInfoMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 写入数据</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveData</span> <span class="params">(UserInfo userInfo)</span> ;</span><br><span class="line">    <span class="comment">// ID 查询</span></span><br><span class="line">    UserInfo <span class="title function_">selectById</span> <span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span> ;</span><br><span class="line">    <span class="comment">// 查询全部</span></span><br><span class="line">    List <span class="title function_">selectList</span> <span class="params">()</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Mapper-xml文件"><a href="#Mapper-xml文件" class="headerlink" title="Mapper.xml文件"></a>Mapper.xml文件</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.click.house.mapper.UserInfoMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.click.house.entity.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;pass_word&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;passWord&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_day&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createDay&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">        id,user_name,pass_word,phone,email,create_day</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;saveData&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.click.house.entity.UserInfo&quot;</span> &gt;</span></span><br><span class="line">        INSERT INTO cs_user_info</span><br><span class="line">        (id,user_name,pass_word,phone,email,create_day)</span><br><span class="line">        VALUES</span><br><span class="line">        (#&#123;id,jdbcType=INTEGER&#125;,#&#123;userName,jdbcType=VARCHAR&#125;,#&#123;passWord,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;phone,jdbcType=VARCHAR&#125;,#&#123;email,jdbcType=VARCHAR&#125;,#&#123;createDay,jdbcType=VARCHAR&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">        from cs_user_info</span><br><span class="line">        where id = #&#123;id,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span> &gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">        from cs_user_info</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里 create_day 是以字符串的方式在转换，这里需要注意下。</p>
<h2 id="控制层接口"><a href="#控制层接口" class="headerlink" title="控制层接口"></a>控制层接口</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoService userInfoService ;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/saveData&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveData</span> <span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfo</span> () ;</span><br><span class="line">        userInfo.setId(<span class="number">4</span>);</span><br><span class="line">        userInfo.setUserName(<span class="string">&quot;winter&quot;</span>);</span><br><span class="line">        userInfo.setPassWord(<span class="string">&quot;567&quot;</span>);</span><br><span class="line">        userInfo.setPhone(<span class="string">&quot;13977776789&quot;</span>);</span><br><span class="line">        userInfo.setEmail(<span class="string">&quot;winter&quot;</span>);</span><br><span class="line">        userInfo.setCreateDay(<span class="string">&quot;2020-02-20&quot;</span>);</span><br><span class="line">        userInfoService.saveData(userInfo);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;sus&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/selectById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserInfo <span class="title function_">selectById</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userInfoService.selectById(<span class="number">1</span>) ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/selectList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List <span class="title function_">selectList</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userInfoService.selectList() ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot集成四【ShardingSphere分库分表框架】</title>
    <url>/cnblogs.github.io/p/3cbb.html</url>
    <content><![CDATA[<p>在众多分库分表框架中，ShardingSphere 以其强大的功能和广泛的应用而备受青睐。接下来，我们详细看看如何在 Spring Boot3 项目中整合 ShardingSphere 实现分库分表。</p>
<h2 id="工程搭建"><a href="#工程搭建" class="headerlink" title="工程搭建"></a>工程搭建</h2><h3 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h3><p>在pom.xml文件中添加必要的依赖。核心组件包括shardingsphere-jdbc和mybatis。以<br>shardingsphere-jdbc-core-spring-boot-starter为例，版本可以选用 5.2.1，mybatis-spring-boot-starter版本选用 3.5.13。同时，要注意添加 MySQL 驱动以及分页等相关依赖，并根据实际情况添加排除配置。例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;shardingsphere.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在application.yml文件中进行分库分表相关配置。假设我们有一个默认数据源db_master，以及用于分库分表的数据源db_0和db_1。配置如下：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">default-data-source-name:</span> <span class="string">db_master</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">db_master,db_0,db_1</span></span><br><span class="line">      <span class="attr">db_master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://localhost:3306/shard_db</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">db_0:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://localhost:3306/shard_db_0</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">db_1:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://localhost:3306/shard_db_1</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">sharding:</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">tb_order:</span></span><br><span class="line">            <span class="attr">actual-data-nodes:</span> <span class="string">db_$&#123;0..1&#125;.tb_order_$&#123;0..2&#125;</span></span><br><span class="line">            <span class="attr">database-strategy:</span></span><br><span class="line">              <span class="attr">standard:</span></span><br><span class="line">                <span class="attr">sharding-column:</span> <span class="string">order_id</span></span><br><span class="line">                <span class="attr">sharding-algorithm-name:</span> <span class="string">database_inline</span></span><br><span class="line">            <span class="attr">table-strategy:</span></span><br><span class="line">              <span class="attr">standard:</span></span><br><span class="line">                <span class="attr">sharding-column:</span> <span class="string">order_id</span></span><br><span class="line">                <span class="attr">sharding-algorithm-name:</span> <span class="string">table_inline</span></span><br><span class="line">        <span class="attr">sharding-algorithms:</span></span><br><span class="line">          <span class="attr">database_inline:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">db_$&#123;order_id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">          <span class="attr">table_inline:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">tb_order_$&#123;order_id</span> <span class="string">%</span> <span class="number">3</span><span class="string">&#125;</span></span><br><span class="line">        <span class="attr">props:</span></span><br><span class="line">          <span class="attr">sql-show:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">sql-comment-parse-enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>在这个配置中，我们定义了tb_order逻辑表，它会根据order_id字段值定位数据所属的分片节点。库路由采用db_${order_id%2}的算法，表路由采用tb_order_${order_id%3}的算法。</p>
<h3 id="配置原理"><a href="#配置原理" class="headerlink" title="配置原理"></a>配置原理</h3><ul>
<li>数据源管理：在配置中，我们管理了三个数据源。shard_db作为默认库，当操作不涉及需要路由的表时，默认使用该数据源。shard_db_0和shard_db_1则是tb_order逻辑表的路由库。</li>
<li>逻辑表与实际表的映射：逻辑表tb_order整体使用两个数据库，每个库建 3 张结构相同的表。在操作tb_order数据时，ShardingSphere 会根据配置的算法，依据order_id字段值自动将数据路由到对应的数据库和表。例如，当order_id为 5 时，根据库路由算法order_id % 2，会将数据路由到db_1库；再根据表路由算法order_id % 3，会将数据路由到tb_order_2表。</li>
</ul>
<h2 id="测试案例"><a href="#测试案例" class="headerlink" title="测试案例"></a>测试案例</h2><h3 id="主库操作"><a href="#主库操作" class="headerlink" title="主库操作"></a>主库操作</h3><p>基于 Mybatis 持久层框架，我们可以实现对shard_db默认库的数据操作。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MasterTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BuyerMapper buyerMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SellerMapper sellerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBuyerQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Buyer</span> <span class="variable">buyer</span> <span class="operator">=</span> buyerMapper.selectByPrimaryKey(<span class="number">1</span>);</span><br><span class="line">        System.out.println(buyer.getId() + <span class="string">&quot;;&quot;</span> + buyer.getBuyerName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBuyerInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Buyer</span> <span class="variable">buyer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buyer</span>();</span><br><span class="line">        buyer.setBuyerName(<span class="string">&quot;买家Three&quot;</span>);</span><br><span class="line">        System.out.println(buyerMapper.insert(buyer));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBuyerUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Buyer</span> <span class="variable">buyer</span> <span class="operator">=</span> buyerMapper.selectByPrimaryKey(<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (buyer != <span class="literal">null</span>) &#123;</span><br><span class="line">            buyer.setBuyerName(<span class="string">&quot;Three买家&quot;</span>);</span><br><span class="line">            System.out.println(buyerMapper.updateByPrimaryKey(buyer));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个测试类中，我们通过BuyerMapper对shard_db库中的Buyer表进行查询、插入和更新操作。在实际执行过程中，我们可以通过控制台日志打印，看到 ShardingSphere 对 SQL 语句的解析逻辑以及库表节点的定位过程。如果需要进行分页查询，使用PageHelper组件即可轻松实现</p>
<h2 id="读写分离优化"><a href="#读写分离优化" class="headerlink" title="读写分离优化"></a>读写分离优化</h2><p>在高负载的系统环境下，读写分离是进一步提升数据库性能的重要手段。通过将读操作和写操作分散到不同的服务器上，可以有效减轻单个服务器的压力，提高系统的整体性能。</p>
<h3 id="主从架构原理"><a href="#主从架构原理" class="headerlink" title="主从架构原理"></a>主从架构原理</h3><p>在主从架构中，主库（Master）负责处理所有的写操作，如数据插入、更新和删除。从库（Slave）则主要用于处理读取请求。主库的数据会自动同步至从库，以确保数据的一致性。例如，在一个新闻资讯平台中，当有新的新闻发布时，写操作会在主库执行，而大量用户浏览新闻的读操作则由从库承担。</p>
<h3 id="ShardingSphere-实现读写分离"><a href="#ShardingSphere-实现读写分离" class="headerlink" title="ShardingSphere 实现读写分离"></a>ShardingSphere 实现读写分离</h3><p>在 ShardingSphere 中实现读写分离，我们可以通过配置来指定读操作和写操作的数据源。例如，在application.yml文件中添加如下配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">masterslave:</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">ROUND_ROBIN</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">ms</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave_0,slave_1</span></span><br></pre></td></tr></table></figure>
<p>在这个配置中，我们定义了一个名为ms的读写分离规则，主数据源为master，从数据源为slave_0和slave_1。load-balance-algorithm-type指定了负载均衡算法为ROUND_ROBIN，即轮询算法，它会按照顺序依次将读请求分配到各个从库上，以实现负载均衡。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloud分布式功能一【Gateway网关统一管理】</title>
    <url>/cnblogs.github.io/p/4353.html</url>
    <content><![CDATA[<p><strong>创建网关模块并配置依赖</strong><br>想要将多个 Spring Boot 3 应用接入网关进行统一管理，第一步就是创建一个网关模块。以 Maven 项目为例，在pom.xml文件中添加如下依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Cloud Gateway 核心依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 如果使用Nacos作为服务注册中心，添加Nacos依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加完依赖后，在项目的启动类上，添加@EnableDiscoveryClient注解，开启服务注册与发现功能。假设启动类名为GatewayApplication，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果项目使用 Nacos 等服务注册中心，还需要在application.yml文件中配置 Nacos 的相关信息，例如：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos服务器地址</span></span><br></pre></td></tr></table></figure>
<p>这样，网关模块就能注册到 Nacos 中，并且感知到其他已注册的 Spring Boot 3 应用服务。</p>
<p><strong>路由配置详解</strong><br>接着，在配置文件中进行关键的路由配置。我们要开启从注册中心动态创建路由的功能，在application.yml文件的spring.cloud.gateway节点下进行配置。在routes配置中，为每个路由指定一个唯一的id ，比如可以采用 “服务名 + route” 的形式；uri则填写对应的服务名称，这样即使服务的实际 IP 地址发生变化，也无需重新配置网关；predicates部分用于配置服务中controller的路由规则，确保请求能够准确地转发到对应的应用接口上。<br>例如，我们有一个名为user-service的用户服务，想要将所有以&#x2F;user&#x2F;开头的请求转发到该服务上，配置如下：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启从注册中心动态创建路由的功能</span></span><br><span class="line">          <span class="attr">lowerCaseServiceId:</span> <span class="literal">true</span> <span class="comment"># 将服务ID转换为小写</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service-route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span> <span class="comment"># lb表示基于负载均衡，指向user-service服务</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 匹配所有以/user/开头的请求路径</span></span><br></pre></td></tr></table></figure>
<p>如果希望根据请求头中的信息进行路由，比如只有请求头中包含X-User-Type: admin的请求才转发到特定服务，可以这样配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin-service-route</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">lb://admin-service</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-User-Type,</span> <span class="string">admin</span></span><br></pre></td></tr></table></figure>
<p><strong>功能实现：限流防刷与登录鉴权</strong><br>在功能实现方面，限流防刷是必不可少的一环。我们可以借助 Redis 来实现，通过编写过滤器，设定某个 IP 在一定时间内的访问次数上限，一旦超过这个次数，就限制该 IP 的访问，从而有效防止恶意攻击和流量暴增对系统造成的冲击。<br>首先，引入 Redis 依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后，编写一个自定义的限流过滤器RateLimitingFilter，代码示例如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitingFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;rate_limit:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, Integer&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RateLimitingFilter</span><span class="params">(RedisTemplate&lt;String, Integer&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> exchange.getRequest().getRemoteAddress().getAddress().getHostAddress();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> KEY_PREFIX + ip;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前IP的访问次数</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 首次访问，设置初始值为1，过期时间为1分钟</span></span><br><span class="line">            redisTemplate.opsForValue().set(key, <span class="number">1</span>, Duration.ofMinutes(<span class="number">1</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="comment">// 访问次数未超过限制，次数加1</span></span><br><span class="line">            redisTemplate.opsForValue().increment(key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 访问次数超过限制，返回429 Too Many Requests</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.TOO_MANY_REQUESTS);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// 过滤器执行顺序，数值越小越先执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>登录鉴权也是保障系统安全的重要措施，通常采用无状态的做法，前端在请求时携带token，网关通过过滤器对token进行校验，确保请求的合法性。<br>创建一个TokenValidationFilter过滤器，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenValidationFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> exchange.getRequest().getHeaders().getFirst(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token == <span class="literal">null</span> ||!isValidToken(token)) &#123;</span><br><span class="line">            <span class="comment">// token无效，返回401 Unauthorized</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isValidToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里可以实现具体的token校验逻辑，例如调用认证服务进行校验</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 过滤器执行顺序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时，我们还需要对一些不需要鉴权的接口，如登录接口进行放行处理，这可以通过在配置文件中进行声明，并编写对应的配置类来实现。比如，在配置文件中定义一个不需要鉴权的路径列表:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">auth:</span></span><br><span class="line">  <span class="attr">ignore:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/user/login</span></span><br></pre></td></tr></table></figure>
<p>然后编写配置类读取这些路径，并在过滤器中进行判断：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.Ordered;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IgnoreAuthFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;auth.ignore&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; ignorePaths;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> exchange.getRequest().getPath().value();</span><br><span class="line">        <span class="keyword">if</span> (ignorePaths.contains(path)) &#123;</span><br><span class="line">            <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TokenValidationFilter</span>().filter(exchange, chain);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">2</span>; <span class="comment">// 过滤器执行顺序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而且要特别注意过滤器的执行顺序，以保证功能的正常运行。</p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Java功能一【泛型通配符T/E/K/V解析】</title>
    <url>/cnblogs.github.io/p/20873.html</url>
    <content><![CDATA[<h4 id="T（Type）：万能替身演员"><a href="#T（Type）：万能替身演员" class="headerlink" title="T（Type）：万能替身演员"></a>T（Type）：万能替身演员</h4><p>作为泛型的“门面担当”，T在类、方法、接口中扮演任意类型的占位符：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 泛型类：盒子能装任何类型的物品  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MagicBox</span>&lt;T&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> T secret;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">store</span><span class="params">(T item)</span> &#123; <span class="built_in">this</span>.secret = item; &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 使用时指定具体类型  </span></span><br><span class="line">MagicBox&lt;String&gt; wordBox = <span class="keyword">new</span> <span class="title class_">MagicBox</span>&lt;&gt;();  </span><br><span class="line">wordBox.store(<span class="string">&quot;Hello Generics!&quot;</span>);  <span class="comment">// 编译期自动类型检查[1,5](@ref)  </span></span><br></pre></td></tr></table></figure>
<p><strong>核心价值：</strong></p>
<ul>
<li>消除强制转换（告别(String)list.get(0)的提心吊胆）</li>
<li>防止ClassCastException（错误在编译期就被拦截）</li>
</ul>
<h4 id="E（Element）：集合家族的专属身份证"><a href="#E（Element）：集合家族的专属身份证" class="headerlink" title="E（Element）：集合家族的专属身份证"></a>E（Element）：集合家族的专属身份证</h4><p>当你在List<E>或Set<E>中看到E，它专指集合元素类型：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeList</span>&lt;E&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> List&lt;E&gt; data = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">    <span class="comment">// 确保存入/取出类型一致  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addElement</span><span class="params">(E e)</span> &#123; data.add(e); &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 使用时明确元素类型  </span></span><br><span class="line">SafeList&lt;Integer&gt; scores = <span class="keyword">new</span> <span class="title class_">SafeList</span>&lt;&gt;();  </span><br><span class="line">scores.addElement(<span class="number">95</span>);  <span class="comment">// 若尝试add(&quot;A+&quot;)会直接编译报错[3,4](@ref)  </span></span><br></pre></td></tr></table></figure>
<p><strong>设计哲学：</strong>让集合像“类型保险箱”，存入和取出保持类型一致性</p>
<h4 id="K-V（Key-Value）：映射关系的黄金搭档"><a href="#K-V（Key-Value）：映射关系的黄金搭档" class="headerlink" title="K&#x2F;V（Key&#x2F;Value）：映射关系的黄金搭档"></a>K&#x2F;V（Key&#x2F;Value）：映射关系的黄金搭档</h4><p>这对CP专为Map量身定制，定义键值对的类型约束：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigCache</span>&lt;K, V&gt; &#123;  </span><br><span class="line">    <span class="keyword">private</span> Map&lt;K, V&gt; cacheMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveConfig</span><span class="params">(K key, V value)</span> &#123;  </span><br><span class="line">        cacheMap.put(key, value);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 使用时明确键值类型  </span></span><br><span class="line">ConfigCache&lt;String, LocalDateTime&gt; timeCache = <span class="keyword">new</span> <span class="title class_">ConfigCache</span>&lt;&gt;();  </span><br><span class="line">timeCache.saveConfig(<span class="string">&quot;userLogin&quot;</span>, LocalDateTime.now());  </span><br></pre></td></tr></table></figure>
<p><strong>黄金法则：</strong></p>
<ul>
<li>K约束键的类型（如必须实现hashCode()）</li>
<li>V约束值的类型（如统一存储JSON对象</li>
</ul>
<h4 id="上界通配符：类型安全的“天花板”"><a href="#上界通配符：类型安全的“天花板”" class="headerlink" title="上界通配符：类型安全的“天花板”"></a>上界通配符：类型安全的“天花板”</h4><p>&lt;? extends T&gt;定义类型上限，常用于数据消费场景：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 处理所有动物及其子类（Cat/Dog）  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">feedAnimals</span><span class="params">(List&lt;? extends Animal&gt; animals)</span> &#123;  </span><br><span class="line">    animals.forEach(Animal::eat);  <span class="comment">// 安全调用父类方法  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 可传入List&lt;Cat&gt;但不能传入List&lt;Object&gt;[4,5](@ref)  </span></span><br></pre></td></tr></table></figure>
<p><strong>优势：</strong> 保证集合元素至少具备父类特性</p>
<h4 id="下界通配符：类型系统的“地板”"><a href="#下界通配符：类型系统的“地板”" class="headerlink" title="下界通配符：类型系统的“地板”"></a>下界通配符：类型系统的“地板”</h4><p>&lt;? super T&gt;设定类型下限，适用于数据生产场景：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 向容器添加特定类型元素  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fillNumbers</span><span class="params">(List&lt;? <span class="built_in">super</span> Integer&gt; list)</span> &#123;  </span><br><span class="line">    list.add(<span class="number">42</span>);  <span class="comment">// 允许添加Integer及其父类容器  </span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 可传入List&lt;Number&gt;或List&lt;Object&gt;[4,5](@ref) </span></span><br></pre></td></tr></table></figure>
<p><strong>经典案例：</strong> Collections.copy(dest, src)方法实现</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java功能三【FileInputStream二次使用】</title>
    <url>/cnblogs.github.io/p/32689.html</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputStreamTest</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line"> </span><br><span class="line">         <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;F:\\HelloCoder-HaC.txt&quot;</span>;</span><br><span class="line">         <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName);</span><br><span class="line">         <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">             file.mkdir();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(fileName));</span><br><span class="line">         <span class="type">int</span> <span class="variable">by</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">         <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span>];</span><br><span class="line"> <span class="comment">//        一个字节数组的读出数据</span></span><br><span class="line"> <span class="comment">//        第一次读写  </span></span><br><span class="line">         <span class="keyword">while</span> ((by = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">             System.out.print((<span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, by)));</span><br><span class="line">         &#125;</span><br><span class="line"> <span class="comment">//        //关闭流，这里关闭也不影响</span></span><br><span class="line">         fileInputStream.close();</span><br><span class="line"> </span><br><span class="line">         <span class="comment">//关闭流后如何打开，利用反射</span></span><br><span class="line">         System.out.println();</span><br><span class="line">         System.out.println(<span class="string">&quot;-------重新复用流-------&quot;</span>);</span><br><span class="line"> <span class="comment">//      第二次 重新读写</span></span><br><span class="line">         <span class="type">Class</span> <span class="variable">in</span> <span class="operator">=</span> fileInputStream.getClass();</span><br><span class="line">         <span class="type">Method</span> <span class="variable">openo</span> <span class="operator">=</span> in.getDeclaredMethod(<span class="string">&quot;open&quot;</span>, String.class);</span><br><span class="line">         <span class="comment">//因为是private</span></span><br><span class="line">         openo.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         openo.invoke(fileInputStream, fileName);</span><br><span class="line">         bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span>];</span><br><span class="line">         <span class="keyword">while</span> ((by = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">             System.out.print((<span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, by)));</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HelloCoder ,I am HaC</span><br><span class="line">My webSite is https://rain.baimuxym.cn</span><br><span class="line">-------重新复用流-------</span><br><span class="line">HelloCoder ,I am HaC</span><br><span class="line">My webSite is https://rain.baimuxym.cn</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java功能二【本地缓存Caffeine和Guava】</title>
    <url>/cnblogs.github.io/p/14281.html</url>
    <content><![CDATA[<h4 id="Caffeine"><a href="#Caffeine" class="headerlink" title="Caffeine"></a>Caffeine</h4><p>Caffeine 是一个性能ISS（In-Space Sizing）的缓存框架，它使用无锁算法和分段锁机制，以更优的方式优化了缓存淘汰算法。Caffeine 的设计目标为极致性能，并针对一些常见的场景进行了优化。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>caffeine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.benmanes.caffeine.cache.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CaffeineDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        basicUsageDemo();</span><br><span class="line">        loadingCacheDemo();</span><br><span class="line">        asyncLoadingCacheDemo();</span><br><span class="line">        evictionDemo();</span><br><span class="line">        statisticsDemo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基础缓存操作示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">basicUsageDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 1. 基础缓存操作 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(<span class="number">5</span>, TimeUnit.SECONDS) <span class="comment">// 写入5秒后过期</span></span><br><span class="line">            .maximumSize(<span class="number">100</span>)                     <span class="comment">// 最大100个条目</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 手动写入</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取值（不存在返回null）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取key1: &quot;</span> + value);  <span class="comment">// 输出: value1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取或计算（线程安全）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value2</span> <span class="operator">=</span> cache.get(<span class="string">&quot;key2&quot;</span>, k -&gt; <span class="string">&quot;computed-&quot;</span> + k);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取key2: &quot;</span> + value2); <span class="comment">// 输出: computed-key2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动加载缓存示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">loadingCacheDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 2. 自动加载缓存 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        LoadingCache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .expireAfterAccess(<span class="number">3</span>, TimeUnit.SECONDS) <span class="comment">// 3秒未访问则过期</span></span><br><span class="line">            .maximumSize(<span class="number">10</span>)</span><br><span class="line">            .build(key -&gt; &#123;</span><br><span class="line">                <span class="comment">// 模拟从数据库加载</span></span><br><span class="line">                System.out.println(<span class="string">&quot;正在加载: &quot;</span> + key);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;db-value-&quot;</span> + key;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自动触发加载函数</span></span><br><span class="line">        System.out.println(cache.get(<span class="string">&quot;user1001&quot;</span>)); <span class="comment">// 输出: db-value-user1001</span></span><br><span class="line">        System.out.println(cache.get(<span class="string">&quot;user1001&quot;</span>)); <span class="comment">// 第二次直接从缓存获取</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步加载缓存示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">asyncLoadingCacheDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 3. 异步加载缓存 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        AsyncLoadingCache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .expireAfterWrite(<span class="number">10</span>, TimeUnit.SECONDS)</span><br><span class="line">            .maximumSize(<span class="number">1000</span>)</span><br><span class="line">            .buildAsync(key -&gt; &#123;</span><br><span class="line">                <span class="comment">// 模拟异步加载</span></span><br><span class="line">                <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;异步加载: &quot;</span> + key);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;async-value-&quot;</span> + key;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 异步获取</span></span><br><span class="line">        cache.get(<span class="string">&quot;id123&quot;</span>).thenAccept(value -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;异步获取结果: &quot;</span> + value); <span class="comment">// 输出: async-value-id123</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 淘汰策略示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">evictionDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 4. 淘汰策略 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">3</span>) <span class="comment">// 测试用的小容量</span></span><br><span class="line">            .removalListener((key, value, cause) -&gt; </span><br><span class="line">                System.out.printf(<span class="string">&quot;淘汰事件: key=%s, 原因=%s\n&quot;</span>, key, cause))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k4&quot;</span>, <span class="string">&quot;v4&quot;</span>); <span class="comment">// 触发淘汰（LRU）</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;当前大小: &quot;</span> + cache.estimatedSize()); <span class="comment">// 输出: 3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 统计功能示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">statisticsDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 5. 统计功能 ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        Cache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">100</span>)</span><br><span class="line">            .recordStats() <span class="comment">// 开启统计</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;missingKey&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        System.out.println(<span class="string">&quot;命中率: &quot;</span> + stats.hitRate());    <span class="comment">// 输出: 0.5</span></span><br><span class="line">        System.out.println(<span class="string">&quot;命中数: &quot;</span> + stats.hitCount());    <span class="comment">// 输出: 1</span></span><br><span class="line">        System.out.println(<span class="string">&quot;未命中数: &quot;</span> + stats.missCount()); <span class="comment">// 输出: 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Guava-Cache"><a href="#Guava-Cache" class="headerlink" title="Guava Cache"></a>Guava Cache</h4><p>Guava Cache 是 Google 官方提供的一个缓存框架，它提供了许多高级特性，如自动加载、统计、序列化、并发控制等。与 Caffeine 不同，Guava Cache 的设计目标为简单易用，并支持更多的高级特性。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>33.4.8-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> com.google.common.cache.*;</span><br><span class="line"><span class="keyword">import</span> io.vavr.collection.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuavaCacheDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException &#123;</span><br><span class="line">        basicUsageDemo();</span><br><span class="line">        loadingCacheDemo();</span><br><span class="line">        cacheRemovalListenerDemo();</span><br><span class="line">        cacheStatisticsDemo();</span><br><span class="line">        advancedEvictionDemo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基础缓存操作示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">basicUsageDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 1. 基础缓存操作 ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder().expireAfterWrite(<span class="number">5</span>, TimeUnit.SECONDS) <span class="comment">// 写入5秒后过期</span></span><br><span class="line">            .maximumSize(<span class="number">100</span>) <span class="comment">// 最大100个条目</span></span><br><span class="line">            .concurrencyLevel(<span class="number">4</span>) <span class="comment">// 并发级别</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 手动写入</span></span><br><span class="line">        cache.put(<span class="string">&quot;key1&quot;</span>, <span class="string">&quot;value1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取值（不存在返回null）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cache.getIfPresent(<span class="string">&quot;key1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取key1: &quot;</span> + value); <span class="comment">// 输出: value1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 尝试获取不存在的key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value2</span> <span class="operator">=</span> cache.getIfPresent(<span class="string">&quot;key2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;获取不存在的key2: &quot;</span> + value2); <span class="comment">// 输出: null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动加载缓存示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">loadingCacheDemo</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 2. 自动加载缓存 ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        LoadingCache&lt;String, String&gt; cache = CacheBuilder.newBuilder().expireAfterAccess(<span class="number">3</span>, TimeUnit.SECONDS) <span class="comment">// 3秒未访问则过期</span></span><br><span class="line">            .maximumSize(<span class="number">10</span>).build(<span class="keyword">new</span> <span class="title class_">CacheLoader</span>&lt;String, String&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">load</span><span class="params">(String key)</span> &#123;</span><br><span class="line">                    <span class="comment">// 模拟从数据库加载</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;正在加载: &quot;</span> + key);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;db-value-&quot;</span> + key;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自动触发加载函数</span></span><br><span class="line">        System.out.println(cache.get(<span class="string">&quot;user1001&quot;</span>)); <span class="comment">// 输出: db-value-user1001</span></span><br><span class="line">        System.out.println(cache.get(<span class="string">&quot;user1001&quot;</span>)); <span class="comment">// 第二次直接从缓存获取</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 批量获取</span></span><br><span class="line">        System.out.println(cache.getAll(List.of(<span class="string">&quot;user1002&quot;</span>, <span class="string">&quot;user1003&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存淘汰监听器示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">cacheRemovalListenerDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 3. 淘汰监听器 ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        RemovalListener&lt;String, String&gt; listener = notification -&gt; &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;淘汰事件: key=%s, value=%s, 原因=%s\n&quot;</span>, notification.getKey(), notification.getValue(),</span><br><span class="line">                notification.getCause());</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder().maximumSize(<span class="number">3</span>) <span class="comment">// 测试用的小容量</span></span><br><span class="line">            .removalListener(listener).build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;k4&quot;</span>, <span class="string">&quot;v4&quot;</span>); <span class="comment">// 触发淘汰（LRU）</span></span><br><span class="line"></span><br><span class="line">        cache.invalidate(<span class="string">&quot;k2&quot;</span>); <span class="comment">// 手动触发淘汰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 缓存统计示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">cacheStatisticsDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 4. 缓存统计 ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder().maximumSize(<span class="number">100</span>).recordStats() <span class="comment">// 开启统计</span></span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        cache.getIfPresent(<span class="string">&quot;missingKey&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CacheStats</span> <span class="variable">stats</span> <span class="operator">=</span> cache.stats();</span><br><span class="line">        System.out.println(<span class="string">&quot;命中率: &quot;</span> + stats.hitRate()); <span class="comment">// 输出: 0.5</span></span><br><span class="line">        System.out.println(<span class="string">&quot;命中数: &quot;</span> + stats.hitCount()); <span class="comment">// 输出: 1</span></span><br><span class="line">        System.out.println(<span class="string">&quot;未命中数: &quot;</span> + stats.missCount()); <span class="comment">// 输出: 1</span></span><br><span class="line">        System.out.println(<span class="string">&quot;加载成功数: &quot;</span> + stats.loadSuccessCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 高级淘汰策略示例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">advancedEvictionDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\n=== 5. 高级淘汰策略 ===&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder()</span><br><span class="line">            <span class="comment">// 基于权重的淘汰（假设不同value占用不同空间）</span></span><br><span class="line">            .maximumWeight(<span class="number">1000</span>).weigher((String key, String value) -&gt; value.length())</span><br><span class="line">            <span class="comment">// 弱引用key和value（适合缓存大对象）</span></span><br><span class="line">            .weakKeys().weakValues()</span><br><span class="line">            <span class="comment">// 定期维护（减少并发开销）</span></span><br><span class="line">            .concurrencyLevel(<span class="number">8</span>).build();</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;long&quot;</span>, <span class="string">&quot;这是一个很长的字符串值&quot;</span>);</span><br><span class="line">        cache.put(<span class="string">&quot;short&quot;</span>, <span class="string">&quot;小&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;当前大小: &quot;</span> + cache.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java功能五【自定义异步任务工具类LatchUtils】</title>
    <url>/cnblogs.github.io/p/feb0.html</url>
    <content><![CDATA[<p>在Java应用开发中，我们经常需要将一些任务进行异步并行处理。当主流程需要等待所有任务执行完毕后再继续时，这就会用到 CountDownLatch 等并发工具类。然而，直接使用这些原生工具类，往往意味着需要编写一些重复的、模式化的“胶水代码”，这不仅增加了代码量，也让核心业务逻辑显得不够清晰。我封装了一个名为 LatchUtils 的轻量级工具类。它能够以一种极其简洁的方式来组织和管理这一类异步任务。</p>
<p><strong>详细代码</strong><br>先上代码，后面会有使用说明和示例以及和传统实现代码的对比</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LatchUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;List&lt;TaskInfo&gt;&gt; THREADLOCAL = ThreadLocal.withInitial(LinkedList::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">submitTask</span><span class="params">(Executor executor, Runnable runnable)</span> &#123;</span><br><span class="line">        THREADLOCAL.get().add(<span class="keyword">new</span> <span class="title class_">TaskInfo</span>(executor, runnable));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;TaskInfo&gt; <span class="title function_">popTask</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;TaskInfo&gt; taskInfos = THREADLOCAL.get();</span><br><span class="line">        THREADLOCAL.remove();</span><br><span class="line">        <span class="keyword">return</span> taskInfos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">waitFor</span><span class="params">(<span class="type">long</span> timeout, TimeUnit timeUnit)</span> &#123;</span><br><span class="line">        List&lt;TaskInfo&gt; taskInfos = popTask();</span><br><span class="line">        <span class="keyword">if</span> (taskInfos.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(taskInfos.size());</span><br><span class="line">        <span class="keyword">for</span> (TaskInfo taskInfo : taskInfos) &#123;</span><br><span class="line">            <span class="type">Executor</span> <span class="variable">executor</span> <span class="operator">=</span> taskInfo.executor;</span><br><span class="line">            <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> taskInfo.runnable;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    runnable.run();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">await</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            await = latch.await(timeout, timeUnit);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> await;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">TaskInfo</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Executor executor;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Runnable runnable;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">TaskInfo</span><span class="params">(Executor executor, Runnable runnable)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.executor = executor;</span><br><span class="line">            <span class="built_in">this</span>.runnable = runnable;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用说明</strong><br>只需如下两步即可。</p>
<ul>
<li>提交任务: 在主流程代码，先调用 LatchUtils.submitTask() 提交Runnable任务和其对应的Executor（用来执行这个Runnable）。</li>
<li>执行并等待: 当并行任务都提交完毕后，只需调用一次 LatchUtils.waitFor()。该方法会立即触发所有已注册任务执行，并阻塞等待所有任务执行完成或超时。</li>
</ul>
<p><strong>实战示例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">	LatchUtils.submitTask(executorService, () -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Task 1 started.&quot;</span>);</span><br><span class="line">		<span class="comment">// Simulate some work</span></span><br><span class="line">		System.out.println(<span class="string">&quot;Task 1 completed.&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	LatchUtils.submitTask(executorService, () -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Task 2 started.&quot;</span>);</span><br><span class="line">		<span class="comment">// Simulate some work</span></span><br><span class="line">		System.out.println(<span class="string">&quot;Task 2 completed.&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	LatchUtils.submitTask(executorService, () -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Task 3 started.&quot;</span>);</span><br><span class="line">		<span class="comment">// Simulate some work</span></span><br><span class="line">		System.out.println(<span class="string">&quot;Task 3 completed.&quot;</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="type">boolean</span> <span class="variable">waitFor</span> <span class="operator">=</span> LatchUtils.waitFor(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">	<span class="keyword">if</span> (waitFor) &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;All tasks completed within the specified time.&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Some tasks may not have completed.&quot;</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>从这个例子中可以看到，业务代码变得非常清晰。我们只需要关注“提交任务”和“等待结果”这两个动作，而无需关心 CountDownLatch 的初始化、countDown() 的调用等细节。<br><strong>对比：不使用 LatchUtils</strong><br>为了更好地理解 LatchUtils 带来的价值，让我们用传统的Java并发API实现与上面完全相同的功能。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">	<span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">3</span>);</span><br><span class="line">	executorService.execute(() -&gt; &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Task 1 started.&quot;</span>);</span><br><span class="line">			<span class="comment">// Simulate some work</span></span><br><span class="line">			System.out.println(<span class="string">&quot;Task 1 completed.&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			latch.countDown();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	executorService.execute(() -&gt; &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Task 2 started.&quot;</span>);</span><br><span class="line">			<span class="comment">// Simulate some work</span></span><br><span class="line">			System.out.println(<span class="string">&quot;Task 2 completed.&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			latch.countDown();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	executorService.execute(() -&gt; &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Task 3 started.&quot;</span>);</span><br><span class="line">			<span class="comment">// Simulate some work</span></span><br><span class="line">			System.out.println(<span class="string">&quot;Task 3 completed.&quot;</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			latch.countDown();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="type">boolean</span> <span class="variable">await</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		await = latch.await(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (await) &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;All tasks completed within the specified time.&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;Some tasks may not have completed.&quot;</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java功能四【Java8-Stream-API详解】</title>
    <url>/cnblogs.github.io/p/7991.html</url>
    <content><![CDATA[<h2 id="Stream-的概念"><a href="#Stream-的概念" class="headerlink" title="Stream 的概念"></a>Stream 的概念</h2><p>Stream 不是一种数据结构，它是对数据源（如集合、数组等）的元素进行一系列操作的抽象。可以将 Stream 看作是一个高级迭代器，它允许我们以一种更灵活的方式遍历和处理集合中的元素。</p>
<h2 id="创建-Stream"><a href="#创建-Stream" class="headerlink" title="创建 Stream"></a>创建 Stream</h2><p><strong>从集合创建 Stream</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCreationFromCollection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; fruits = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        fruits.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        fruits.add(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        fruits.add(<span class="string">&quot;cherry&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建顺序流</span></span><br><span class="line">        Stream&lt;String&gt; sequentialStream = fruits.stream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建并行流</span></span><br><span class="line">        Stream&lt;String&gt; parallelStream = fruits.parallelStream();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>从数组创建 Stream</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamCreationFromArray</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String[] colors = &#123;<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>&#125;;</span><br><span class="line">        Stream&lt;String&gt; colorStream = Stream.of(colors);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用 Stream.generate() 和 Stream.iterate() 创建无限流</strong> </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfiniteStreamCreation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 generate 创建无限流，生成随机数</span></span><br><span class="line">        Stream&lt;Double&gt; randomStream = Stream.generate(Math::random);</span><br><span class="line">        randomStream.limit(<span class="number">5</span>).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 iterate 创建无限流，从 0 开始，每次递增 2</span></span><br><span class="line">        Stream&lt;Integer&gt; evenStream = Stream.iterate(<span class="number">0</span>, n -&gt; n + <span class="number">2</span>);</span><br><span class="line">        evenStream.limit(<span class="number">5</span>).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Stream-的操作"><a href="#Stream-的操作" class="headerlink" title="Stream 的操作"></a>Stream 的操作</h2><h3 id="中间操作"><a href="#中间操作" class="headerlink" title="中间操作"></a>中间操作</h3><p>中间操作会返回一个新的 Stream，并且不会立即执行，常见的中间操作有</p>
<h4 id="过滤（filter）"><a href="#过滤（filter）" class="headerlink" title="过滤（filter）"></a>过滤（filter）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FilterOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        numbers.stream()</span><br><span class="line">              .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="映射（map）"><a href="#映射（map）" class="headerlink" title="映射（map）"></a>映射（map）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; words = Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">        words.stream()</span><br><span class="line">              .map(String::toUpperCase)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="扁平化映射（flatMap）"><a href="#扁平化映射（flatMap）" class="headerlink" title="扁平化映射（flatMap）"></a>扁平化映射（flatMap）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlatMapOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; nestedList = Arrays.asList(</span><br><span class="line">                Arrays.asList(<span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">                Arrays.asList(<span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">                Arrays.asList(<span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">        );</span><br><span class="line">        Stream&lt;Integer&gt; flatStream = nestedList.stream()</span><br><span class="line">              .flatMap(List::stream);</span><br><span class="line">        flatStream.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="排序（sorted）"><a href="#排序（sorted）" class="headerlink" title="排序（sorted）"></a>排序（sorted）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortedOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>);</span><br><span class="line">        numbers.stream()</span><br><span class="line">              .sorted()</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自定义排序</span></span><br><span class="line">        numbers.stream()</span><br><span class="line">              .sorted((a, b) -&gt; b - a)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="去重（distinct）"><a href="#去重（distinct）" class="headerlink" title="去重（distinct）"></a>去重（distinct）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DistinctOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">        numbers.stream()</span><br><span class="line">              .distinct()</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="截断（limit）和跳过（skip）"><a href="#截断（limit）和跳过（skip）" class="headerlink" title="截断（limit）和跳过（skip）"></a>截断（limit）和跳过（skip）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LimitAndSkipOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">        <span class="comment">// 取前 3 个元素</span></span><br><span class="line">        numbers.stream()</span><br><span class="line">              .limit(<span class="number">3</span>)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 跳过前 2 个元素</span></span><br><span class="line">        numbers.stream()</span><br><span class="line">              .skip(<span class="number">2</span>)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="终止操作"><a href="#终止操作" class="headerlink" title="终止操作"></a>终止操作</h3><p>终止操作会触发中间操作的执行，并产生一个最终结果，常见的终止操作有：</p>
<h4 id="遍历（forEach）"><a href="#遍历（forEach）" class="headerlink" title="遍历（forEach）"></a>遍历（forEach）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForEachOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        names.stream()</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="收集（collect）"><a href="#收集（collect）" class="headerlink" title="收集（collect）"></a>收集（collect）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; people = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">30</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Charlie&quot;</span>, <span class="number">25</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 收集到 List</span></span><br><span class="line">        List&lt;String&gt; names = people.stream()</span><br><span class="line">              .map(Person::getName)</span><br><span class="line">              .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按年龄分组</span></span><br><span class="line">        Map&lt;Integer, List&lt;Person&gt;&gt; groupedByAge = people.stream()</span><br><span class="line">              .collect(Collectors.groupingBy(Person::getAge));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">namesJoined</span> <span class="operator">=</span> people.stream()</span><br><span class="line">              .map(Person::getName)</span><br><span class="line">              .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="统计（count）"><a href="#统计（count）" class="headerlink" title="统计（count）"></a>统计（count）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> names.stream()</span><br><span class="line">              .count();</span><br><span class="line">        System.out.println(<span class="string">&quot;Number of names: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="查找（findFirst、findAny）"><a href="#查找（findFirst、findAny）" class="headerlink" title="查找（findFirst、findAny）"></a>查找（findFirst、findAny）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FindOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        Optional&lt;Integer&gt; firstEven = numbers.stream()</span><br><span class="line">              .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">              .findFirst();</span><br><span class="line">        <span class="keyword">if</span> (firstEven.isPresent()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;First even number: &quot;</span> + firstEven.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Optional&lt;Integer&gt; anyEven = numbers.parallelStream()</span><br><span class="line">              .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">              .findAny();</span><br><span class="line">        <span class="keyword">if</span> (anyEven.isPresent()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Any even number: &quot;</span> + anyEven.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="匹配（allMatch、anyMatch、noneMatch）"><a href="#匹配（allMatch、anyMatch、noneMatch）" class="headerlink" title="匹配（allMatch、anyMatch、noneMatch）"></a>匹配（allMatch、anyMatch、noneMatch）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MatchOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allEven</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">              .allMatch(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;All numbers are even: &quot;</span> + allEven);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">anyGreaterThanFive</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">              .anyMatch(n -&gt; n &gt; <span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Any number is greater than 5: &quot;</span> + anyGreaterThanFive);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">noneGreaterThanTen</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">              .noneMatch(n -&gt; n &gt; <span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;None of the numbers is greater than 10: &quot;</span> + noneGreaterThanTen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="归约（reduce）"><a href="#归约（reduce）" class="headerlink" title="归约（reduce）"></a>归约（reduce）</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReduceOperation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">// 无初始值的归约</span></span><br><span class="line">        Optional&lt;Integer&gt; sumWithoutInitial = numbers.stream()</span><br><span class="line">              .reduce((a, b) -&gt; a + b);</span><br><span class="line">        <span class="keyword">if</span> (sumWithoutInitial.isPresent()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Sum without initial value: &quot;</span> + sumWithoutInitial.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 有初始值的归约</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">sumWithInitial</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">              .reduce(<span class="number">10</span>, (a, b) -&gt; a + b);</span><br><span class="line">        System.out.println(<span class="string">&quot;Sum with initial value: &quot;</span> + sumWithInitial);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="并行流"><a href="#并行流" class="headerlink" title="并行流"></a>并行流</h3><p>并行流可以利用多核处理器并行处理元素，提高处理效率。但并行流并不适用于所有场景，使用时需要注意线程安全和性能开销。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelStreamExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        numbers.parallelStream()</span><br><span class="line">              .map(n -&gt; n * <span class="number">2</span>)</span><br><span class="line">              .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java总结一【通用工具库】</title>
    <url>/cnblogs.github.io/p/213d.html</url>
    <content><![CDATA[<h2 id="1-Collections"><a href="#1-Collections" class="headerlink" title="1. Collections"></a>1. Collections</h2><p>首先是 java.util 包下的 Collections 类。这个类主要用于操作集合，我个人非常喜欢使用它。以下是一些常用功能：</p>
<h3 id="1-1-排序"><a href="#1-1-排序" class="headerlink" title="1.1 排序"></a>1.1 排序</h3><p>在工作中，经常需要对集合进行排序。让我们看看如何使用 Collections 工具实现升序和降序排列：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">Collections.sort(list); <span class="comment">//升序</span></span><br><span class="line">System.out.println(list);</span><br><span class="line">Collections.reverse(list); <span class="comment">//降序</span></span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[1, 2, 3]</span><br><span class="line">[3, 2, 1]</span><br></pre></td></tr></table></figure>

<h3 id="1-2-获取最大值或最小值"><a href="#1-2-获取最大值或最小值" class="headerlink" title="1.2 获取最大值或最小值"></a>1.2 获取最大值或最小值</h3><p>有时需要在集合中找到最大值或最小值，这时可以使用 Collections 的 max 和 min 方法。 例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">max</span> <span class="operator">=</span> Collections.max(list);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">min</span> <span class="operator">=</span> Collections.min(list);</span><br><span class="line">System.out.println(max);</span><br><span class="line">System.out.println(min);</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="1-3-返回空集合"><a href="#1-3-返回空集合" class="headerlink" title="1.3 返回空集合"></a>1.3 返回空集合</h3><p>有时，在检查为空后，我们需要返回一个空集合，可以使用 emptyList 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title function_">fun</span><span class="params">(List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (list == <span class="literal">null</span> || list.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-转换为不可修改的集合"><a href="#1-4-转换为不可修改的集合" class="headerlink" title="1.4 转换为不可修改的集合"></a>1.4 转换为不可修改的集合</h3><p>为了防止后续程序修改某个集合的结果，有时我们需要将某个集合定义为不可修改的。这可以通过使用 Collections 的 unmodifiablexxx 方法轻松实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; integers = Collections.unmodifiableList(list);</span><br><span class="line">integers.add(<span class="number">4</span>);</span><br><span class="line">System.out.println(integers);</span><br></pre></td></tr></table></figure>

<h3 id="1-5-转换为线程安全的集合"><a href="#1-5-转换为线程安全的集合" class="headerlink" title="1.5 转换为线程安全的集合"></a>1.5 转换为线程安全的集合</h3><p>我们都知道，Java 中的许多集合，如 ArrayList、LinkedList、HashMap、HashSet 等，都不是线程安全的。 换句话说，在多线程环境中，向这些集合中添加数据存在线程安全问题。这时，可以使用 Collections 的 synchronizedxxx 方法直接将这些线程不安全的集合转换为线程安全的集合。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; integers = Collections.synchronizedList(list); <span class="comment">//将 ArrayList 转换为线程安全的集合</span></span><br><span class="line">System.out.println(integers);</span><br></pre></td></tr></table></figure>
<p>它的底层实现会创建SynchronizedRandomAccessList 或 SynchronizedList 类。这两个类的许多方法都会用 synchronized 加锁。</p>
<h2 id="2-CollectionUtils"><a href="#2-CollectionUtils" class="headerlink" title="2. CollectionUtils"></a>2. CollectionUtils</h2><p>对于集合操作，除了前面提到的 Collections 工具类，CollectionUtils 工具类也非常常用。目前，比较主流的是 apache 的org.apache.commons.collections 包下的 CollectionUtils 工具类。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然，Spring 框架的 org.springframework.util 包下也有 CollectionUtils 工具类。不过，我个人推荐使用 apache 包下的 CollectionUtils 工具类，因为它的工具更多且更全面。举个简单的例子，Spring 中的 CollectionUtils 工具类没有判断集合是否不为空的方法，而 apache 中的有。 接下来，我们以 apache 中的 CollectionUtils 工具类为例，介绍一些常用方法。</p>
<h3 id="2-1-检查集合是否为空"><a href="#2-1-检查集合是否为空" class="headerlink" title="2.1 检查集合是否为空"></a>2.1 检查集合是否为空</h3><p>CollectionUtils 工具类的 isEmpty 方法可以轻松判断集合是否为空，isNotEmpty 方法判断集合是否不为空。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span> (CollectionUtils.isEmpty(list)) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Collection is empty.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (CollectionUtils.isNotEmpty(list)) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Collection is not empty&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-对两个集合进行操作"><a href="#2-2-对两个集合进行操作" class="headerlink" title="2.2 对两个集合进行操作"></a>2.2 对两个集合进行操作</h3><p>有时我们需要对两个已有的集合进行操作，比如取交集或并集。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="number">2</span>);</span><br><span class="line">list.add(<span class="number">1</span>);</span><br><span class="line">list.add(<span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list2.add(<span class="number">2</span>);</span><br><span class="line">list2.add(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//获取并集</span></span><br><span class="line">Collection&lt;Integer&gt; unionList = CollectionUtils.union(list, list2);</span><br><span class="line">System.out.println(unionList);</span><br><span class="line"><span class="comment">//获取交集</span></span><br><span class="line">Collection&lt;Integer&gt; intersectionList = CollectionUtils.intersection(list, list2);</span><br><span class="line">System.out.println(intersectionList);</span><br><span class="line"><span class="comment">//获取交集的补集</span></span><br><span class="line">Collection&lt;Integer&gt; disjunctionList = CollectionUtils.disjunction(list, list2);</span><br><span class="line">System.out.println(disjunctionList);</span><br><span class="line"><span class="comment">//获取差集</span></span><br><span class="line">Collection&lt;Integer&gt; subtractList = CollectionUtils.subtract(list, list2);</span><br><span class="line">System.out.println(subtractList);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[1, 2, 3, 4]</span><br><span class="line">[2]</span><br><span class="line">[1, 3, 4]</span><br><span class="line">[1, 3]</span><br></pre></td></tr></table></figure>

<h2 id="3-Lists"><a href="#3-Lists" class="headerlink" title="3. Lists"></a>3. Lists</h2><p>如果你引入 com.google.guava 的依赖，会得到很多有用的工具类。这里推荐一个 com.google.common.collect 包下的集合工具：Lists。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>28.2-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-快速初始化集合"><a href="#3-1-快速初始化集合" class="headerlink" title="3.1 快速初始化集合"></a>3.1 快速初始化集合</h3><p>有时，我们想初始化集合中的一些元素，这时可以使用 Lists 的 newArrayList 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>这比直接创建一个列表然后逐个添加元素更方便。 执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[1, 2, 3]</span><br></pre></td></tr></table></figure>

<h3 id="3-2-笛卡尔积"><a href="#3-2-笛卡尔积" class="headerlink" title="3.2 笛卡尔积"></a>3.2 笛卡尔积</h3><p>如果你想对两个集合进行笛卡尔积操作，Lists 的 cartesianProduct 方法可以帮你实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list1 = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">List&lt;Integer&gt; list2 = Lists.newArrayList(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; productList = Lists.cartesianProduct(list1, list2);</span><br><span class="line">System.out.println(productList);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[[1, 4], [1, 5], [2, 4], [2, 5], [3, 4], [3, 5]]</span><br></pre></td></tr></table></figure>

<h3 id="3-3-分割集合"><a href="#3-3-分割集合" class="headerlink" title="3.3 分割集合"></a>3.3 分割集合</h3><p>如果你想将一个大集合分割成几个小集合，可以使用 Lists 的 partition 方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; partitionList = Lists.partition(list, <span class="number">2</span>);</span><br><span class="line">System.out.println(partitionList);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[[1, 2], [3, 4], [5]]</span><br></pre></td></tr></table></figure>
<p>在这个例子中，列表有 5 条数据。我将列表集合分成了 3 份，每份大小为 2，即变成了 3 个小集合。 这是我最喜欢的方法之一，我在项目中经常使用。</p>
<h3 id="3-4-流处理"><a href="#3-4-流处理" class="headerlink" title="3.4 流处理"></a>3.4 流处理</h3><p>如果我们想对集合内的元素进行操作，可以使用 Lists 的 transform 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = Lists.newArrayList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">List&lt;String&gt; transformList = Lists.transform(list, x -&gt; x.toUpperCase());</span><br><span class="line">System.out.println(transformList);</span><br></pre></td></tr></table></figure>
<p>小写字母被转换为大写字母。 执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[A, B, C]</span><br></pre></td></tr></table></figure>

<h3 id="3-5-反转顺序"><a href="#3-5-反转顺序" class="headerlink" title="3.5 反转顺序"></a>3.5 反转顺序</h3><p>Lists 有一个 reverse() 方法用于反转顺序。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line">List&lt;Integer&gt; reverseList = Lists.reverse(list);</span><br><span class="line">System.out.println(reverseList);</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[4, 5, 2, 1, 3]</span><br></pre></td></tr></table></figure>

<h2 id="4-Objects"><a href="#4-Objects" class="headerlink" title="4. Objects"></a>4. Objects</h2><p>在 jdk7 之后，提供了 Objects 工具类，我们可以通过它对对象进行操作。</p>
<h3 id="4-1-检查对象是否为空"><a href="#4-1-检查对象是否为空" class="headerlink" title="4.1 检查对象是否为空"></a>4.1 检查对象是否为空</h3><p>在 Java 中，一切皆对象。检查对象是否为空可以说是无处不在。Objects 的 isNull 方法检查对象是否为空，nonNull 方法检查对象是否不为空。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">if</span> (Objects.isNull(i)) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Object is null&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (Objects.nonNull(i)) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Object is not null&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-对象为空时抛出异常"><a href="#4-2-对象为空时抛出异常" class="headerlink" title="4.2 对象为空时抛出异常"></a>4.2 对象为空时抛出异常</h3><p>如果我们想在对象为空时抛出空指针异常，可以使用 Objects 的 requireNonNull 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">128</span>);</span><br><span class="line">Objects.requireNonNull(i);</span><br><span class="line">Objects.requireNonNull(i, <span class="string">&quot;Parameters cannot be null&quot;</span>);</span><br><span class="line">Objects.requireNonNull(i, () -&gt; <span class="string">&quot;Parameters cannot be null&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-3-检查两个对象是否相等"><a href="#4-3-检查两个对象是否相等" class="headerlink" title="4.3 检查两个对象是否相等"></a>4.3 检查两个对象是否相等</h3><p>我们经常需要检查两个对象是否相等。Objects 为我们提供了 equals 方法，可以很方便地实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line">System.out.println(Objects.equals(i1, i2));</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">true</span><br></pre></td></tr></table></figure>
<p>但是使用这个方法时有一个坑。例如，如果将例子改为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line"><span class="type">Long</span> <span class="variable">l</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>);</span><br><span class="line">System.out.println(Objects.equals(i, l));</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">false</span><br></pre></td></tr></table></figure>

<h3 id="4-4-获取对象的哈希码"><a href="#4-4-获取对象的哈希码" class="headerlink" title="4.4 获取对象的哈希码"></a>4.4 获取对象的哈希码</h3><p>如果你想获取某个对象的哈希码，可以使用 Objects 的 hashCode 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">System.out.println(Objects.hashCode(str));</span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">96354</span><br></pre></td></tr></table></figure>

<h2 id="5-StringUtils"><a href="#5-StringUtils" class="headerlink" title="5. StringUtils"></a>5. StringUtils</h2><p>字符串在我们的日常工作中使用得非常频繁。在我们的代码中，经常需要检查字符串是否为空、转换大小写、分割字符串、比较字符串、去除多余空格、连接字符串、使用正则表达式等等。 如果我们只使用 String 类提供的方法，就需要手动编写大量额外的代码，既耗时又费力。作为程序员，当然要学会偷懒。现在有一个现成的工具类，即 org.apache.commons.lang3 包下的 StringUtils 工具类，它为我们提供了非常多操作 String 的方法。</p>
<h3 id="5-1-检查字符串是否为空"><a href="#5-1-检查字符串是否为空" class="headerlink" title="5.1 检查字符串是否为空"></a>5.1 检查字符串是否为空</h3><p>实际上，对于空字符串，不仅有 null，还有“”、“ ”、“null”等多种情况。StringUtils 为我们提供了多个静态方法来检查字符串是否为空。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">System.out.println(StringUtils.isEmpty(str1));</span><br><span class="line">System.out.println(StringUtils.isEmpty(str2));</span><br><span class="line">System.out.println(StringUtils.isEmpty(str3));</span><br><span class="line">System.out.println(StringUtils.isEmpty(str4));</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">System.out.println(StringUtils.isNotEmpty(str1));</span><br><span class="line">System.out.println(StringUtils.isNotEmpty(str2));</span><br><span class="line">System.out.println(StringUtils.isNotEmpty(str3));</span><br><span class="line">System.out.println(StringUtils.isNotEmpty(str4));</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">System.out.println(StringUtils.isBlank(str1));</span><br><span class="line">System.out.println(StringUtils.isBlank(str2));</span><br><span class="line">System.out.println(StringUtils.isBlank(str3));</span><br><span class="line">System.out.println(StringUtils.isBlank(str4));</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------------------------&quot;</span>);</span><br><span class="line">System.out.println(StringUtils.isNotBlank(str1));</span><br><span class="line">System.out.println(StringUtils.isNotBlank(str2));</span><br><span class="line">System.out.println(StringUtils.isNotBlank(str3));</span><br><span class="line">System.out.println(StringUtils.isNotBlank(str4));</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">true</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">false</span><br><span class="line">true</span><br></pre></td></tr></table></figure>
<p>示例中的四个空检查方法：isEmpty、isNotEmpty、isBlank 和 isNotBlank。你可以根据实际情况使用这些方法。 建议优先使用 isBlank 和 isNotBlank 方法，因为它们会考虑更多情况。</p>
<h3 id="5-2-分割字符串"><a href="#5-2-分割字符串" class="headerlink" title="5.2 分割字符串"></a>5.2 分割字符串</h3><p>分割字符串是一个常见需求。如果直接使用 String 类的 split 方法，可能会出现空指针异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">System.out.println(StringUtils.split(str1, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">System.out.println(str1.split(<span class="string">&quot;,&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>使用 StringUtils 的 split 方法会返回 null，而使用 String 的 split 方法会报指针异常。</p>
<h3 id="5-3-检查是否为纯数字"><a href="#5-3-检查是否为纯数字" class="headerlink" title="5.3 检查是否为纯数字"></a>5.3 检查是否为纯数字</h3><p>给定一个字符串，要检查它是否为纯数字，可以使用 isNumeric 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;123abc&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;0.33&quot;</span>;</span><br><span class="line">System.out.println(StringUtils.isNumeric(str1));</span><br><span class="line">System.out.println(StringUtils.isNumeric(str2));</span><br><span class="line">System.out.println(StringUtils.isNumeric(str3));</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line">false</span><br><span class="line">false</span><br></pre></td></tr></table></figure>

<h3 id="5-4-将集合连接成字符串"><a href="#5-4-将集合连接成字符串" class="headerlink" title="5.4 将集合连接成字符串"></a>5.4 将集合连接成字符串</h3><p>有时，我们需要将集合的内容连接成一个字符串然后输出，这时可以使用 join 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = Lists.newArrayList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">List&lt;Integer&gt; list2 = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">System.out.println(StringUtils.join(list, <span class="string">&quot;,&quot;</span>));</span><br><span class="line">System.out.println(StringUtils.join(list2, <span class="string">&quot; &quot;</span>));</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a,b,c</span><br><span class="line">1 2 3</span><br></pre></td></tr></table></figure>

<h2 id="6-BeanUtils"><a href="#6-BeanUtils" class="headerlink" title="6. BeanUtils"></a>6. BeanUtils</h2><p>Spring 为我们提供了一个用于 JavaBean 的工具类，它在 org.springframework.beans 包下，名字是：BeanUtils。</p>
<h3 id="6-1-复制对象属性"><a href="#6-1-复制对象属性" class="headerlink" title="6.1 复制对象属性"></a>6.1 复制对象属性</h3><p>你是否遇到过这样的需求：将某个对象的所有属性复制到另一个对象。这时可以使用 BeanUtils 的 copyProperties 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user1.setId(<span class="number">1L</span>);</span><br><span class="line">user1.setName(<span class="string">&quot;Dylan&quot;</span>);</span><br><span class="line">user1.setAddress(<span class="string">&quot;Hong Kong&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">BeanUtils.copyProperties(user1, user2);</span><br><span class="line">System.out.println(user2);</span><br></pre></td></tr></table></figure>

<h3 id="6-2-获取指定类的指定方法"><a href="#6-2-获取指定类的指定方法" class="headerlink" title="6.2 获取指定类的指定方法"></a>6.2 获取指定类的指定方法</h3><p>如果你想获取某个类的指定方法以便后续操作，可以使用 BeanUtils 的 findDeclaredMethod 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">declaredMethod</span> <span class="operator">=</span> BeanUtils.findDeclaredMethod(User.class, <span class="string">&quot;getId&quot;</span>);</span><br><span class="line">System.out.println(declaredMethod.getName());</span><br></pre></td></tr></table></figure>

<h3 id="6-3-获取指定方法的参数"><a href="#6-3-获取指定方法的参数" class="headerlink" title="6.3 获取指定方法的参数"></a>6.3 获取指定方法的参数</h3><p>如果你想获取某个方法的参数，可以使用 BeanUtils 的 findPropertyForMethod 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">declaredMethod</span> <span class="operator">=</span> BeanUtils.findDeclaredMethod(User.class, <span class="string">&quot;getId&quot;</span>);</span><br><span class="line"><span class="type">PropertyDescriptor</span> <span class="variable">propertyForMethod</span> <span class="operator">=</span> BeanUtils.findPropertyForMethod(declaredMethod);</span><br><span class="line">System.out.println(propertyForMethod.getName());</span><br></pre></td></tr></table></figure>

<h2 id="7-ReflectionUtils"><a href="#7-ReflectionUtils" class="headerlink" title="7. ReflectionUtils"></a>7. ReflectionUtils</h2><p>有时，我们在项目中需要使用反射功能。如果使用最原始的方法开发，代码量会非常大且麻烦，需要处理大量异常和访问权限问题。 好消息是，Spring 为我们提供了一个 ReflectionUtils 工具类，它在 org.springframework.util 包下。</p>
<h3 id="7-1-获取方法"><a href="#7-1-获取方法" class="headerlink" title="7.1 获取方法"></a>7.1 获取方法</h3><p>如果你想获取某个类的某个方法，可以使用 ReflectionUtils 类的 findMethod 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(User.class, <span class="string">&quot;getId&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="7-2-获取字段"><a href="#7-2-获取字段" class="headerlink" title="7.2 获取字段"></a>7.2 获取字段</h3><p>如果你想获取某个类的某个字段，可以使用 ReflectionUtils 类的 findField 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectionUtils.findField(User.class, <span class="string">&quot;id&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="7-3-执行方法"><a href="#7-3-执行方法" class="headerlink" title="7.3 执行方法"></a>7.3 执行方法</h3><p>如果你想通过反射调用某个方法并传递参数，可以使用 ReflectionUtils 类的 invokeMethod 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ReflectionUtils.invokeMethod(method, springContextsUtil.getBean(beanName), param);</span><br></pre></td></tr></table></figure>

<h3 id="7-4-检查字段是否为常量"><a href="#7-4-检查字段是否为常量" class="headerlink" title="7.4 检查字段是否为常量"></a>7.4 检查字段是否为常量</h3><p>如果你想检查某个字段是否为常量，可以使用 ReflectionUtils 类的 isPublicStaticFinal 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectionUtils.findField(User.class, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">System.out.println(ReflectionUtils.isPublicStaticFinal(field));</span><br></pre></td></tr></table></figure>

<h3 id="7-5-检查是否为-equals-方法"><a href="#7-5-检查是否为-equals-方法" class="headerlink" title="7.5 检查是否为 equals 方法"></a>7.5 检查是否为 equals 方法</h3><p>如果你想检查某个方法是否为 equals 方法，可以使用 ReflectionUtils 类的 isEqualsMethod 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(User.class, <span class="string">&quot;getId&quot;</span>);</span><br><span class="line">System.out.println(ReflectionUtils.isEqualsMethod(method));</span><br></pre></td></tr></table></figure>

<h2 id="8-DigestUtils"><a href="#8-DigestUtils" class="headerlink" title="8. DigestUtils"></a>8. DigestUtils</h2><p>有时，我们需要对数据进行加密，比如使用 md5 或 sha256。我们可以使用 Apache 的org.apache.commons.codec.digest 包下的 DigestUtils 类。</p>
<h3 id="8-1-MD5-加密"><a href="#8-1-MD5-加密" class="headerlink" title="8.1 MD5 加密"></a>8.1 MD5 加密</h3><p>如果你想使用 MD5 加密数据，可以使用 DigestUtils 的 md5Hex 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">md5Hex</span> <span class="operator">=</span> DigestUtils.md5Hex(<span class="string">&quot;Dylan&quot;</span>);</span><br><span class="line">System.out.println(md5Hex);</span><br></pre></td></tr></table></figure>

<h3 id="8-2-SHA256-加密"><a href="#8-2-SHA256-加密" class="headerlink" title="8.2 SHA256 加密"></a>8.2 SHA256 加密</h3><p>如果你想使用 SHA256 加密数据，可以使用 DigestUtils 的 sha256Hex 方法。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">md5Hex</span> <span class="operator">=</span> DigestUtils.sha256Hex(<span class="string">&quot;Dylan&quot;</span>);</span><br><span class="line">System.out.println(md5Hex);</span><br></pre></td></tr></table></figure>

<h2 id="9-HttpStatus"><a href="#9-HttpStatus" class="headerlink" title="9. HttpStatus"></a>9. HttpStatus</h2><p>很多时候，我们会在代码中定义 HTTP 返回码。例如，正常接口返回 200，异常返回 500，如果接口找不到则返回 404。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">SUCCESS_CODE</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">ERROR_CODE</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">NOT_FOUND_CODE</span> <span class="operator">=</span> <span class="number">404</span>;</span><br></pre></td></tr></table></figure>
<p>实际上，org.springframework.http 包下的 HttpStatus 枚举或 org.apache.http 包下的 HttpStatus 接口已经为我们定义了常用的 HTTP 返回码，我们可以直接使用，真的不需要重新定义</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis功能一【设置自定义插件】</title>
    <url>/cnblogs.github.io/p/52094.html</url>
    <content><![CDATA[<p>假设我们想做一个插件，用于统计每个 SQL 查询的执行时间。这听起来是不是很酷？下面就是实现这个功能的具体步骤。</p>
<h4 id="第一步：实现-Interceptor-接口"><a href="#第一步：实现-Interceptor-接口" class="headerlink" title="第一步：实现 Interceptor 接口"></a>第一步：实现 Interceptor 接口</h4><p>MyBatis 插件的核心在于实现org.apache.ibatis.plugin.Interceptor 接口。这个接口只有一个方法需要重写：intercept(Invocation invocation)。我们可以通过这个方法插入自定义逻辑。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.executor.statement.StatementHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.plugin.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.ResultHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type = StatementHandler.class, method = &quot;query&quot;, args = &#123;java.sql.Statement.class, ResultHandler.class&#125;),</span></span><br><span class="line"><span class="meta">    @Signature(type = StatementHandler.class, method = &quot;update&quot;, args = &#123;java.sql.Statement.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeStatInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> invocation.proceed(); <span class="comment">// 调用原始方法</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">            System.out.println(<span class="string">&quot;SQL Execution Time: &quot;</span> + (end - start) + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="comment">// 可以在这里设置插件属性</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第二步：配置插件"><a href="#第二步：配置插件" class="headerlink" title="第二步：配置插件"></a>第二步：配置插件</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.example.TimeStatInterceptor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis功能二【数据进行脱敏显示】</title>
    <url>/cnblogs.github.io/p/40359.html</url>
    <content><![CDATA[<h4 id="创建脱敏数据处理器"><a href="#创建脱敏数据处理器" class="headerlink" title="创建脱敏数据处理器"></a>创建脱敏数据处理器</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.BaseTypeHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.JdbcType;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.MappedJdbcTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.type.MappedTypes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.CallableStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.VARCHAR)</span></span><br><span class="line"><span class="meta">@MappedTypes(String.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveInfoTypeHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span> &#123;</span><br><span class="line">    <span class="comment">// 关键字列表，实际开发中，关键字列表可以做成配置或在表中存储，这样可以更灵活</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEYWORD_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;token|Authorization|password|email|keyword1|keyword2|keyword3&quot;</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">PATTERN</span> <span class="operator">=</span> Pattern.compile(KEYWORD_PATTERN);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, String parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// 一般个人信息或敏感数据都要加密存储，可以参考文末给出的数据加解密处理方案，这里不处理</span></span><br><span class="line">        ps.setString(i, parameter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// 对结果进行脱敏</span></span><br><span class="line">        <span class="keyword">return</span> desensitize(rs.getString(columnName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// 对结果进行脱敏</span></span><br><span class="line">        <span class="keyword">return</span> desensitize(rs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getNullableResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// 对结果进行脱敏</span></span><br><span class="line">        <span class="keyword">return</span> desensitize(cs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">desensitize</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果字段中存在指定的关键字，则对关键字后面10位字符串使用***代替</span></span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> PATTERN.matcher(value);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(value);</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> matcher.start() + matcher.group().length();</span><br><span class="line">            <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> Math.min(start + <span class="number">10</span>, result.length());</span><br><span class="line">            result.replace(start + offset, end + offset, <span class="string">&quot;***&quot;</span>);</span><br><span class="line">            offset += <span class="string">&quot;***&quot;</span>.length() - (end - start);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 返回脱敏后的数据</span></span><br><span class="line">        <span class="keyword">return</span> result.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码中：</p>
<ul>
<li>KEYWORD_PATTERN 定义了一个包含多个关键字的正则表达式模式，关键字之间用 | 分隔。</li>
<li>desensitize 方法中，通过 Pattern 和 Matcher 来查找字符串中所有匹配关键字的位置。</li>
<li>使用 StringBuilder 来修改原始字符串，将关键字后的 10 位字符串替换为 ***。在替换过程中，考虑到替换字符串长度变化对后续位置的影响，通过 offset 变量进行修正</li>
</ul>
<h4 id="在Mapper-XML中使用"><a href="#在Mapper-XML中使用" class="headerlink" title="在Mapper XML中使用"></a>在Mapper XML中使用</h4><p> 示例中对请求头req_headers、响应体resp_body字段应用脱敏处理器<br> <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">     <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;BaseResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.demo.entity.Log&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;url&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;req_headers&quot;</span> <span class="attr">property</span>=<span class="string">&quot;reqHeaders&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;com.example.demo.typehandler.SensitiveInfoTypeHandler&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;resp_headers&quot;</span> <span class="attr">property</span>=<span class="string">&quot;respHeaders&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;resp_body&quot;</span> <span class="attr">property</span>=<span class="string">&quot;respBody&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;com.example.demo.typehandler.SensitiveInfoTypeHandler&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cost_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;costTime&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;BaseResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT id, url,</span><br><span class="line">           req_headers,</span><br><span class="line">           resp_headers,</span><br><span class="line">           resp_body,</span><br><span class="line">           cost_time</span><br><span class="line">    FROM logs</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库一【基础语句】</title>
    <url>/cnblogs.github.io/p/37224.html</url>
    <content><![CDATA[<h4 id="MySQL数据库语句"><a href="#MySQL数据库语句" class="headerlink" title="MySQL数据库语句"></a>MySQL数据库语句</h4><h5 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database name; 创建数据库</span><br></pre></td></tr></table></figure>
<h5 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use databasename; 选择数据库</span><br></pre></td></tr></table></figure>
<h5 id="选择数据库-1"><a href="#选择数据库-1" class="headerlink" title="选择数据库"></a>选择数据库</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> database name; 删除数据库</span><br></pre></td></tr></table></figure>
<h4 id="MySQL表语句"><a href="#MySQL表语句" class="headerlink" title="MySQL表语句"></a>MySQL表语句</h4><h5 id="新建表"><a href="#新建表" class="headerlink" title="新建表"></a>新建表</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 新增一个User表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="keyword">user</span>(</span><br><span class="line">id <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">create_by <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">create_date datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">update_by <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新人&#x27;</span>,</span><br><span class="line">update_date datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">status <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;数据状态&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;user表&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="新增表字段"><a href="#新增表字段" class="headerlink" title="新增表字段"></a>新增表字段</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="keyword">user</span> <span class="keyword">add</span> <span class="keyword">COLUMN</span> age <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="修改表字段"><a href="#修改表字段" class="headerlink" title="修改表字段"></a>修改表字段</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="keyword">user</span> MODIFY <span class="keyword">COLUMN</span> age <span class="type">varchar</span>(<span class="number">64</span>) COMMENT <span class="string">&#x27;年龄&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="删除表字段"><a href="#删除表字段" class="headerlink" title="删除表字段"></a>删除表字段</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter table</span> <span class="keyword">user</span> <span class="keyword">DROP</span> age;</span><br></pre></td></tr></table></figure>
<h4 id="MySQL管理语句"><a href="#MySQL管理语句" class="headerlink" title="MySQL管理语句"></a>MySQL管理语句</h4><h5 id="连接本机数据库"><a href="#连接本机数据库" class="headerlink" title="连接本机数据库"></a>连接本机数据库</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p密码</span><br></pre></td></tr></table></figure>
<h5 id="连接到远程主机上的MYSQL"><a href="#连接到远程主机上的MYSQL" class="headerlink" title="连接到远程主机上的MYSQL"></a>连接到远程主机上的MYSQL</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql <span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="number">123456</span></span><br></pre></td></tr></table></figure>
<h5 id="修改mysql中root的密码"><a href="#修改mysql中root的密码" class="headerlink" title="修改mysql中root的密码"></a>修改mysql中root的密码</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqladmin <span class="operator">-</span>u root password &quot;newpwd&quot;;</span><br></pre></td></tr></table></figure>
<h5 id="添加创建用户"><a href="#添加创建用户" class="headerlink" title="添加创建用户"></a>添加创建用户</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> mikechen;   添加用户</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;mikechen&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;password&#x27;</span> ;  给用户权限这里是把操作数据库的所有权限给了mikechen，并且设置密码是password。</span><br></pre></td></tr></table></figure>
<h4 id="MySQL增删改查语句"><a href="#MySQL增删改查语句" class="headerlink" title="MySQL增删改查语句"></a>MySQL增删改查语句</h4><h5 id="MySQL插入数据"><a href="#MySQL插入数据" class="headerlink" title="MySQL插入数据"></a>MySQL插入数据</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert into</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span> ( <span class="operator">&lt;</span>字段名<span class="number">1</span><span class="operator">&gt;</span>, ...) <span class="keyword">values</span> ( 值<span class="number">1</span>, ...)</span><br></pre></td></tr></table></figure>
<h5 id="MySQL删除数据"><a href="#MySQL删除数据" class="headerlink" title="MySQL删除数据"></a>MySQL删除数据</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span>  条件]</span><br></pre></td></tr></table></figure>
<h5 id="MySQL修改数据"><a href="#MySQL修改数据" class="headerlink" title="MySQL修改数据"></a>MySQL修改数据</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>，字段名<span class="number">2</span><span class="operator">=</span>值<span class="number">2</span>，....[<span class="keyword">where</span>条件]</span><br></pre></td></tr></table></figure>
<h5 id="MySQL查询数据"><a href="#MySQL查询数据" class="headerlink" title="MySQL查询数据"></a>MySQL查询数据</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">&lt;</span>字段<span class="number">1</span>，字段<span class="number">2</span>，...<span class="operator">&gt;</span> <span class="keyword">from</span> <span class="operator">&lt;</span> 表名 <span class="operator">&gt;</span> <span class="keyword">where</span> <span class="operator">&lt;</span> 表达式 <span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="MySQL索引语句"><a href="#MySQL索引语句" class="headerlink" title="MySQL索引语句"></a>MySQL索引语句</h4><h5 id="使用CREATE-INDEX"><a href="#使用CREATE-INDEX" class="headerlink" title="使用CREATE INDEX"></a>使用CREATE INDEX</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">能够增加普通索引和<span class="keyword">UNIQUE</span>索引两种，其格式如下：</span><br><span class="line"><span class="keyword">create</span> index index_name <span class="keyword">on</span> table_name (column_list) ;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index index_name <span class="keyword">on</span> table_name (column_list) ;</span><br></pre></td></tr></table></figure>
<h5 id="使用ALTER-TABLE"><a href="#使用ALTER-TABLE" class="headerlink" title="使用ALTER TABLE"></a>使用ALTER TABLE</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">PRIMARY KEY</span>（主键索引）</span><br><span class="line">        mysql<span class="operator">&gt;</span> <span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> <span class="keyword">PRIMARY KEY</span> index_name(`column1`, `column2`) </span><br><span class="line"><span class="number">2.</span><span class="keyword">UNIQUE</span>(唯一索引)</span><br><span class="line">        mysql<span class="operator">&gt;</span> <span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> index_name(`column1`, `column2`) </span><br><span class="line"><span class="number">3.</span>INDEX(普通索引)</span><br><span class="line">        mysql<span class="operator">&gt;</span> <span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX index_name (`column1`, `column2`)</span><br><span class="line"><span class="number">4.</span>FULLTEXT(全文索引)</span><br><span class="line">        mysql<span class="operator">&gt;</span> <span class="keyword">ALTER TABLE</span> `table_name` <span class="keyword">ADD</span> FULLTEXT (`column1`, `column2`)</span><br></pre></td></tr></table></figure>
<h5 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">-</span>如果查看索引前，没有使用<span class="keyword">user</span> db_name等命令指定具体的数据库，则必须加上<span class="keyword">FROM</span> db_name</span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> table_name [<span class="keyword">FROM</span> db_name]</span><br><span class="line"><span class="comment">--如果查看索引前，没有使用user db_name等命令指定具体的数据库，则必须加上db_name.前缀</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> [db_name.]table_name</span><br></pre></td></tr></table></figure>
<h5 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="operator">-</span>先删除</span><br><span class="line"><span class="keyword">ALTER TABLE</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_user_username;</span><br><span class="line"><span class="comment">--再以修改后的内容创建同名索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cust_name <span class="keyword">ON</span> customers (cust_name(<span class="number">8</span>));</span><br></pre></td></tr></table></figure>
<h5 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> customers</span><br><span class="line"><span class="keyword">DROP</span> INDEX idx_cust_name;</span><br></pre></td></tr></table></figure>
<h4 id="MySQL查询语句"><a href="#MySQL查询语句" class="headerlink" title="MySQL查询语句"></a>MySQL查询语句</h4><h5 id="直接查询"><a href="#直接查询" class="headerlink" title="直接查询"></a>直接查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名</span><br></pre></td></tr></table></figure>
<h5 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件</span><br></pre></td></tr></table></figure>
<h5 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名 <span class="keyword">order</span> <span class="keyword">by</span> 字段 排序方式(<span class="keyword">desc</span>:<span class="keyword">asc</span>)</span><br></pre></td></tr></table></figure>
<h5 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> userwhere age <span class="operator">&gt;=</span><span class="number">21</span> <span class="keyword">and</span> age<span class="operator">&lt;=</span><span class="number">23</span>;</span><br></pre></td></tr></table></figure>
<h5 id="SQL查询五子句"><a href="#SQL查询五子句" class="headerlink" title="SQL查询五子句"></a>SQL查询五子句</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span><span class="operator">/</span>字段列表 <span class="keyword">from</span> 数据表名称 <span class="keyword">where</span> 子句 <span class="keyword">group</span> <span class="keyword">by</span> 子句 <span class="keyword">having</span> 子句 <span class="keyword">order</span> <span class="keyword">by</span> 子句 limit 子句;</span><br><span class="line"></span><br><span class="line">①.<span class="keyword">where</span> 子句</span><br><span class="line">②.<span class="keyword">group</span> <span class="keyword">by</span> 子句</span><br><span class="line">③.<span class="keyword">having</span> 子句</span><br><span class="line">④.<span class="keyword">order</span> <span class="keyword">by</span> 子句</span><br><span class="line">⑤.limit子句</span><br></pre></td></tr></table></figure>
<h5 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid, name <span class="keyword">FROM</span> staffs <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;a%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="集合查询"><a href="#集合查询" class="headerlink" title="集合查询"></a>集合查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> uid, name <span class="keyword">FROM</span> staffs <span class="keyword">WHERE</span> uid <span class="keyword">IN</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<h5 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> staffs LIMIT <span class="number">5</span>, <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<h5 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h5><p><img src="https://s2.loli.net/2025/01/18/Gm3nWlJZ7H5RNt6.gif"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_list</span><br><span class="line"><span class="keyword">FROM</span> t1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> t2 <span class="keyword">ON</span> join_condition;</span><br></pre></td></tr></table></figure>
<p>也叫内连接或等值连接，用于获取两个表中字段匹配关系的记录。</p>
<p><img src="https://s2.loli.net/2025/01/18/9sA2NhSRmMzJiwU.gif"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    t1.c1, t1.c2, t2.c1, t2.c2</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    t1</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    t2 <span class="keyword">ON</span> t1.c1 <span class="operator">=</span> t2.c1;</span><br></pre></td></tr></table></figure>
<p>左连接：获取左表所有记录，即使右表没有对应匹配的记录。</p>
<p><img src="https://s2.loli.net/2025/01/18/MtLPk146X3l5CHq.gif"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> students <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">right</span> <span class="keyword">join</span> teacher <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">on</span> s.class_id <span class="operator">=</span> t.class_id</span><br></pre></td></tr></table></figure>
<p>与 LEFT JOIN 相反，用于获取右表所有记录，即使左表没有对应匹配的记录。</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库三【重置root密码-忘记原密码】</title>
    <url>/cnblogs.github.io/p/22924.html</url>
    <content><![CDATA[<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>重置MySQL root密码的通用步骤（适用于MySQL 5.7及8.0版本）：<br><strong>方法一：通过跳过权限验证重置密码36</strong><br>停止MySQL服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows</span></span><br><span class="line">net stop MySQL80</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux（systemd系统）</span></span><br><span class="line">sudo systemctl stop mysqld</span><br></pre></td></tr></table></figure>
<p>以无权限模式启动MySQL,保持当前终端窗口运行（不要关闭）：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需指定my.ini/my.cnf路径（Windows参考路径示例）</span></span><br><span class="line">mysqld --defaults-file=&quot;C:\ProgramData\MySQL\MySQL Server 8.0\my.ini&quot; --skip-grant-tables --shared-memory</span><br></pre></td></tr></table></figure>
<p>重置密码,新开一个终端窗口执行：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br></pre></td></tr></table></figure>
<p>在MySQL交互界面输入：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">FLUSH PRIVILEGES;  <span class="comment">-- 刷新权限（必须执行）</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;YourNewPass&#x27;</span>;  <span class="comment">-- MySQL 5.7+</span></span><br><span class="line"><span class="comment">-- 或（MySQL 8.0可能需要指定插件）</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;YourNewPass&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;  <span class="comment">-- 再次刷新</span></span><br><span class="line">EXIT;</span><br></pre></td></tr></table></figure>
<p>重启MySQL服务,回到第2步的窗口按Ctrl+C终止无权限模式，然后重启服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows</span></span><br><span class="line">net start MySQL80</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux</span></span><br><span class="line">sudo systemctl start mysqld</span><br></pre></td></tr></table></figure>
<p><strong>方法二：通过初始化文件重置密码4</strong><br>创建初始化文件,新建文本文件mysql-init.txt，写入：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;NewPassword&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>启动MySQL时加载文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqld --init-file=/path/to/mysql-init.txt --console</span><br></pre></td></tr></table></figure>
<p>启动后密码即被修改，完成后删除初始化文件。</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库二【配置与命令详解】</title>
    <url>/cnblogs.github.io/p/40284.html</url>
    <content><![CDATA[<h4 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 基础设置</span><br><span class="line">datadir=/var/lib/mysql           # 数据文件存储路径</span><br><span class="line">socket=/var/lib/mysql/mysql.sock  # Unix套接字路径</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid  # 进程ID文件</span><br><span class="line">port=3306                        # 服务端口</span><br><span class="line">user=mysql                       # 运行用户</span><br><span class="line"></span><br><span class="line"># 字符集设置（重要！避免乱码）</span><br><span class="line">character-set-server=utf8mb4     # 服务器默认字符集</span><br><span class="line">collation-server=utf8mb4_unicode_ci  # 默认排序规则</span><br><span class="line">init_connect=&#x27;SET NAMES utf8mb4&#x27;  # 客户端连接时自动设置</span><br><span class="line"></span><br><span class="line"># 网络与安全</span><br><span class="line">bind-address=0.0.0.0             # 监听所有IP（生产环境建议指定具体IP）</span><br><span class="line">skip-name-resolve                # 禁用DNS解析，提高性能</span><br></pre></td></tr></table></figure>
<h4 id="内存和性能优化"><a href="#内存和性能优化" class="headerlink" title="内存和性能优化"></a>内存和性能优化</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 内存分配（根据服务器总内存调整）</span><br><span class="line">innodb_buffer_pool_size=1G       # InnoDB缓存池大小（通常占总内存50-75%）</span><br><span class="line">key_buffer_size=128M             # MyISAM索引缓存</span><br><span class="line">query_cache_size=64M             # 查询缓存大小（5.7后逐渐弃用，8.0移除）</span><br><span class="line"></span><br><span class="line"># 日志配置</span><br><span class="line">log-bin=mysql-bin                # 启用二进制日志（主从复制必须）</span><br><span class="line">expire-logs-days=7               # 二进制日志保留天数</span><br><span class="line">slow-query-log=1                 # 开启慢查询日志</span><br><span class="line">slow-query-log-file=/var/log/mysql/slow.log  # 慢查询日志路径</span><br><span class="line">long_query_time=2                # 超过2秒的查询记录到慢日志</span><br></pre></td></tr></table></figure>
<h4 id="连接与线程"><a href="#连接与线程" class="headerlink" title="连接与线程"></a>连接与线程</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">max_connections=200              # 最大连接数</span><br><span class="line">back_log=100                     # 连接队列长度</span><br><span class="line">wait_timeout=28800               # 空闲连接超时时间（秒）</span><br></pre></td></tr></table></figure>
<h4 id="服务控制"><a href="#服务控制" class="headerlink" title="服务控制"></a>服务控制</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动/停止/重启服务（systemd方式）</span></span><br><span class="line">systemctl start mysql</span><br><span class="line">systemctl stop mysql</span><br><span class="line">systemctl restart mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看服务状态</span></span><br><span class="line">systemctl status mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看端口监听</span></span><br><span class="line">netstat -tlnp | grep 3306</span><br></pre></td></tr></table></figure>
<h4 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接本地MySQL</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接远程MySQL</span></span><br><span class="line">mysql -h 192.168.1.100 -P 3306 -u user -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行SQL脚本</span></span><br><span class="line">mysql -u root -p &lt; script.sql</span><br></pre></td></tr></table></figure>
<h4 id="用户与权限管理"><a href="#用户与权限管理" class="headerlink" title="用户与权限管理"></a>用户与权限管理</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建用户并授权（允许从任意主机连接）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 撤销权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="查看状态与变量"><a href="#查看状态与变量" class="headerlink" title="查看状态与变量"></a>查看状态与变量</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看服务器状态</span></span><br><span class="line"><span class="keyword">SHOW</span> STATUS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看配置变量</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看InnoDB缓冲池状态</span></span><br><span class="line"><span class="keyword">SHOW</span> ENGINE INNODB STATUS;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前连接</span></span><br><span class="line"><span class="keyword">SHOW</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>
<h4 id="逻辑备份"><a href="#逻辑备份" class="headerlink" title="逻辑备份"></a>逻辑备份</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份单个数据库</span></span><br><span class="line">mysqldump -u root -p mydb &gt; mydb_backup.sql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">备份所有数据库</span></span><br><span class="line">mysqldump -u root -p --all-databases &gt; all_databases_backup.sql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复数据库</span></span><br><span class="line">mysql -u root -p mydb &lt; mydb_backup.sql</span><br></pre></td></tr></table></figure>
<h4 id="定期备份脚本"><a href="#定期备份脚本" class="headerlink" title="定期备份脚本"></a>定期备份脚本</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">BACKUP_DIR=&quot;/backup/mysql&quot;</span><br><span class="line">DATE=$(date +%Y%m%d)</span><br><span class="line">USER=&quot;root&quot;</span><br><span class="line">PASSWORD=&quot;password&quot;</span><br><span class="line"></span><br><span class="line">mkdir -p $BACKUP_DIR/$DATE</span><br><span class="line">mysqldump -u$USER -p$PASSWORD --all-databases &gt; $BACKUP_DIR/$DATE/all_databases.sql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除7天前的备份</span></span><br><span class="line">find $BACKUP_DIR -type d -mtime +7 -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库四【高级语句】</title>
    <url>/cnblogs.github.io/p/30041.html</url>
    <content><![CDATA[<h3 id="原生SQL函数脱敏"><a href="#原生SQL函数脱敏" class="headerlink" title="原生SQL函数脱敏"></a>原生SQL函数脱敏</h3><h4 id="1、部分隐藏-替换"><a href="#1、部分隐藏-替换" class="headerlink" title="1、部分隐藏&#x2F;替换"></a>1、部分隐藏&#x2F;替换</h4><p>使用字符串函数对敏感字段进行处理：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 手机号脱敏（保留前3位和后4位）</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="keyword">LEFT</span>(phone, <span class="number">3</span>), <span class="string">&#x27;****&#x27;</span>, <span class="keyword">RIGHT</span>(phone, <span class="number">4</span>)) <span class="keyword">AS</span> masked_phone <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="comment">-- 姓名脱敏（保留首尾字符）</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="keyword">LEFT</span>(name, <span class="number">1</span>), <span class="string">&#x27;***&#x27;</span>, <span class="keyword">RIGHT</span>(name, <span class="number">1</span>)) <span class="keyword">AS</span> masked_name <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<h4 id="2、正则替换"><a href="#2、正则替换" class="headerlink" title="2、正则替换"></a>2、正则替换</h4><p>使用REGEXP_REPLACE（MySQL 8.0+）隐藏敏感片段：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 身份证号脱敏（保留前6位和后4位）</span></span><br><span class="line"><span class="keyword">SELECT</span> REGEXP_REPLACE(id_card, <span class="string">&#x27;(.&#123;6&#125;).*(.&#123;4&#125;)&#x27;</span>, <span class="string">&#x27;\\1****\\2&#x27;</span>) <span class="keyword">AS</span> masked_id <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<h3 id="视图封装脱敏数据"><a href="#视图封装脱敏数据" class="headerlink" title="视图封装脱敏数据"></a>视图封装脱敏数据</h3><p>通过视图暴露脱敏后的数据，保护底层原始数据：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> masked_customers <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  id,</span><br><span class="line">  CONCAT(<span class="keyword">LEFT</span>(name, <span class="number">1</span>), <span class="string">&#x27;***&#x27;</span>) <span class="keyword">AS</span> name,  <span class="comment">-- 姓名脱敏</span></span><br><span class="line">  CONCAT(<span class="keyword">LEFT</span>(email, <span class="number">3</span>), <span class="string">&#x27;***@***.com&#x27;</span>) <span class="keyword">AS</span> email  <span class="comment">-- 邮箱脱敏</span></span><br><span class="line"><span class="keyword">FROM</span> customers;</span><br><span class="line"><span class="comment">-- 回收原表权限，仅开放视图权限</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> customers <span class="keyword">FROM</span> app_user;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> masked_customers <span class="keyword">TO</span> app_user;</span><br></pre></td></tr></table></figure>
<h3 id="加密存储敏感数据"><a href="#加密存储敏感数据" class="headerlink" title="加密存储敏感数据"></a>加密存储敏感数据</h3><p>对高敏感字段（如银行卡号）进行加密存储：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 使用AES加密存储（MySQL 5.7+）</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> payments (card_no) </span><br><span class="line"><span class="keyword">VALUES</span> (AES_ENCRYPT(<span class="string">&#x27;622588****1234&#x27;</span>, <span class="string">&#x27;encryption_key&#x27;</span>));</span><br><span class="line"><span class="comment">-- 查询时解密</span></span><br><span class="line"><span class="keyword">SELECT</span> AES_DECRYPT(card_no, <span class="string">&#x27;encryption_key&#x27;</span>) <span class="keyword">AS</span> decrypted_card <span class="keyword">FROM</span> payments;</span><br></pre></td></tr></table></figure>

<h3 id="MySQLDump"><a href="#MySQLDump" class="headerlink" title="MySQLDump"></a>MySQLDump</h3><h4 id="导出整个数据库"><a href="#导出整个数据库" class="headerlink" title="导出整个数据库"></a>导出整个数据库</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -u root -p mydb &gt; mydb_backup.sql</span><br></pre></td></tr></table></figure>
<h4 id="导出指定表"><a href="#导出指定表" class="headerlink" title="导出指定表"></a>导出指定表</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -u root -p mydb users &gt; mydb_users_backup.sql</span><br></pre></td></tr></table></figure>
<h4 id="只导出表结构，不导出数据"><a href="#只导出表结构，不导出数据" class="headerlink" title="只导出表结构，不导出数据"></a>只导出表结构，不导出数据</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -u root -p -d mydb &gt; mydb_structure.sql</span><br></pre></td></tr></table></figure>
<h4 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -u root -p mydb &lt; mydb_backup.sql</span><br></pre></td></tr></table></figure>

<h3 id="数据导出-SELECT-…-INTO-OUTFILE"><a href="#数据导出-SELECT-…-INTO-OUTFILE" class="headerlink" title="数据导出-SELECT … INTO OUTFILE"></a>数据导出-SELECT … INTO OUTFILE</h3><h4 id="导出users表的所有数据到CSV文件"><a href="#导出users表的所有数据到CSV文件" class="headerlink" title="导出users表的所有数据到CSV文件"></a>导出users表的所有数据到CSV文件</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, username, email <span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/tmp/users_data.csv&#x27;</span></span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;&quot;&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x2F;tmp&#x2F;users_data.csv：文件保存路径，需要确保MySQL用户有写入权限。</li>
<li>FIELDS TERMINATED BY ‘,’：指定字段之间用逗号分隔。</li>
<li>ENCLOSED BY ‘“‘：指定字段内容用双引号括起来（特别是字符串类型）。</li>
<li>LINES TERMINATED BY ‘\n’：指定每一行以换行符结束。</li>
</ul>
<h4 id="导出查询结果"><a href="#导出查询结果" class="headerlink" title="导出查询结果"></a>导出查询结果</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, price <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> category <span class="operator">=</span> <span class="string">&#x27;Electronics&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;/var/lib/mysql-files/electronics_products.txt&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="数据导入-LOAD-DATA-INFILE"><a href="#数据导入-LOAD-DATA-INFILE" class="headerlink" title="数据导入-LOAD DATA INFILE"></a>数据导入-LOAD DATA INFILE</h3><h4 id="从CSV文件导入数据到users表"><a href="#从CSV文件导入数据到users表" class="headerlink" title="从CSV文件导入数据到users表"></a>从CSV文件导入数据到users表</h4><p>假设&#x2F;tmp&#x2F;new_users.csv文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">101,&quot;Alice&quot;,&quot;alice@example.com&quot;</span><br><span class="line">102,&quot;Bob&quot;,&quot;bob@example.com&quot;</span><br></pre></td></tr></table></figure>
<p>导入命令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/tmp/new_users.csv&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> users</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;&quot;&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">(id, username, email);</span><br></pre></td></tr></table></figure>
<ul>
<li>(id, username, email)：指定文件中列的顺序与表中列的对应关系。</li>
</ul>
<h4 id="跳过文件头"><a href="#跳过文件头" class="headerlink" title="跳过文件头"></a>跳过文件头</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">LOAD DATA INFILE <span class="string">&#x27;/tmp/users_with_header.csv&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> users</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> ENCLOSED <span class="keyword">BY</span> <span class="string">&#x27;&quot;&#x27;</span> LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">IGNORE <span class="number">1</span> LINES; <span class="comment">-- 忽略文件第一行</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle数据库一【基础语句】</title>
    <url>/cnblogs.github.io/p/16816.html</url>
    <content><![CDATA[<h3 id="Oracle数据库连接"><a href="#Oracle数据库连接" class="headerlink" title="Oracle数据库连接"></a>Oracle数据库连接</h3><p>三种以系统管理员身份连接数据库的方式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">conn / as sysdba  -- 无需监听进程</span><br><span class="line">conn system/admin  -- 本地连接</span><br><span class="line">conn system/admin@oracle  -- 需要监听进程</span><br></pre></td></tr></table></figure>
<p>查看当前数据库有多少用户连接</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> username, sid, serial# <span class="keyword">from</span> v$session;</span><br></pre></td></tr></table></figure>
<p>监听服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsnrctl start  -- 启动监听  </span><br><span class="line">lsnrctl stop   -- 关闭监听  </span><br><span class="line">lsnrctl status -- 查看监听状态</span><br></pre></td></tr></table></figure>
<p>Oracle实例服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">startup;  -- 启动实例</span><br><span class="line">shutdown immediate;  -- 关闭实例</span><br><span class="line">select * from v$instance;  -- 查看实例状态</span><br></pre></td></tr></table></figure>

<h3 id="Oracle用户管理"><a href="#Oracle用户管理" class="headerlink" title="Oracle用户管理"></a>Oracle用户管理</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看系统已有用户</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_users;</span><br><span class="line"></span><br><span class="line"># 显示当前连接用户</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"># 创建新用户并授权</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> a identified <span class="keyword">by</span> a;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">connect</span>, resource <span class="keyword">to</span> a;</span><br><span class="line"></span><br><span class="line"># 修改用户密码</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> a identified <span class="keyword">by</span> <span class="number">123456</span>;</span><br><span class="line"></span><br><span class="line"># 授权用户可以访问数据库所有表</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">any</span> <span class="keyword">table</span> <span class="keyword">to</span> a;</span><br><span class="line"></span><br><span class="line"># 授权用户操作其他用户的表</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>, <span class="keyword">insert</span>, <span class="keyword">update</span>, <span class="keyword">delete</span> <span class="keyword">on</span> student.emp <span class="keyword">to</span> a;</span><br><span class="line"></span><br><span class="line"># 查找用户下的所有表</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tab;</span><br><span class="line"></span><br><span class="line"># 查看当前用户的默认表空间</span><br><span class="line"><span class="keyword">select</span> username, default_tablespace <span class="keyword">from</span> user_users;</span><br><span class="line"></span><br><span class="line"># 查看当前用户的角色</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_role_privs;</span><br><span class="line"></span><br><span class="line"># 查看当前用户的权限</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_sys_privs;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_tab_privs;</span><br></pre></td></tr></table></figure>

<h3 id="Oracle表操作"><a href="#Oracle表操作" class="headerlink" title="Oracle表操作"></a>Oracle表操作</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看用户下所有的表</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_tables;</span><br><span class="line"></span><br><span class="line"># 查找表名包含&quot;LOG&quot;的表</span><br><span class="line"><span class="keyword">select</span> object_name, object_id <span class="keyword">from</span> user_objects <span class="keyword">where</span> instr(object_name, <span class="string">&#x27;LOG&#x27;</span>) <span class="operator">&gt;</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"># 查看表的创建时间</span><br><span class="line"><span class="keyword">select</span> object_name, created <span class="keyword">from</span> user_objects <span class="keyword">where</span> object_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;&amp;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 查看表的大小</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(bytes) <span class="operator">/</span> (<span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>) <span class="keyword">as</span> &quot;size(M)&quot; <span class="keyword">from</span> user_segments <span class="keyword">where</span> segment_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;&amp;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 查看存放在Oracle内存区的表</span><br><span class="line"><span class="keyword">select</span> table_name, cache <span class="keyword">from</span> user_tables <span class="keyword">where</span> instr(cache, <span class="string">&#x27;Y&#x27;</span>) <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Oracle索引"><a href="#Oracle索引" class="headerlink" title="Oracle索引"></a>Oracle索引</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看索引个数和类别</span><br><span class="line"><span class="keyword">select</span> index_name, index_type, table_name <span class="keyword">from</span> user_indexes <span class="keyword">order</span> <span class="keyword">by</span> table_name;</span><br><span class="line"></span><br><span class="line"># 查看索引所涉及的字段</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_ind_columns <span class="keyword">where</span> index_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;&amp;index_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 查看索引大小</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(bytes) <span class="operator">/</span> (<span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>) <span class="keyword">as</span> &quot;size(M)&quot; <span class="keyword">from</span> user_segments <span class="keyword">where</span> segment_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;&amp;index_name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Oracle数据库管理"><a href="#Oracle数据库管理" class="headerlink" title="Oracle数据库管理"></a>Oracle数据库管理</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># 查看表空间的名称及大小</span><br><span class="line"><span class="keyword">select</span> t.tablespace_name, round(<span class="built_in">sum</span>(bytes<span class="operator">/</span>(<span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>)),<span class="number">0</span>) ts_size <span class="keyword">from</span> dba_tablespaces t, dba_data_files d <span class="keyword">where</span> t.tablespace_name <span class="operator">=</span> d.tablespace_name <span class="keyword">group</span> <span class="keyword">by</span> t.tablespace_name;</span><br><span class="line"></span><br><span class="line"># 查看表空间物理文件的名称及大小</span><br><span class="line"><span class="keyword">select</span> tablespace_name, file_id, file_name, round(bytes<span class="operator">/</span>(<span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>),<span class="number">0</span>) total_space <span class="keyword">from</span> dba_data_files <span class="keyword">order</span> <span class="keyword">by</span> tablespace_name;</span><br><span class="line"></span><br><span class="line"># 查看回滚段名称及大小</span><br><span class="line"><span class="keyword">select</span> segment_name, tablespace_name, r.status, (initial_extent<span class="operator">/</span><span class="number">1024</span>) InitialExtent, (next_extent<span class="operator">/</span><span class="number">1024</span>) NextExtent, max_extents, v.curext CurExtent <span class="keyword">from</span> dba_rollback_segs r, v$rollstat v <span class="keyword">where</span> r.segment_id <span class="operator">=</span> v.usn(<span class="operator">+</span>) <span class="keyword">order</span> <span class="keyword">by</span> segment_name;</span><br><span class="line"></span><br><span class="line"># 查看控制文件</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> v$controlfile;</span><br><span class="line"></span><br><span class="line"># 查看日志文件</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">member</span> <span class="keyword">from</span> v$logfile;</span><br><span class="line"></span><br><span class="line"># 查看表空间的使用情况</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(bytes)<span class="operator">/</span>(<span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>) <span class="keyword">as</span> free_space, tablespace_name <span class="keyword">from</span> dba_free_space <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name;</span><br><span class="line"></span><br><span class="line"># 查看数据库对象</span><br><span class="line"><span class="keyword">select</span> owner, object_type, status, <span class="built_in">count</span>(<span class="operator">*</span>) count# <span class="keyword">from</span> all_objects <span class="keyword">group</span> <span class="keyword">by</span> owner, object_type, status;</span><br><span class="line"></span><br><span class="line"># 查看数据库版本</span><br><span class="line"><span class="keyword">select</span> version <span class="keyword">FROM</span> Product_component_version <span class="keyword">where</span> SUBSTR(PRODUCT,<span class="number">1</span>,<span class="number">6</span>)<span class="operator">=</span><span class="string">&#x27;Oracle&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查看数据库的创建日期和归档方式</span><br><span class="line"><span class="keyword">select</span> Created, Log_Mode <span class="keyword">From</span> V$Database;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle数据库二【常用函数】</title>
    <url>/cnblogs.github.io/p/c983.html</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结一【安装、开发环境和目录结构】</title>
    <url>/cnblogs.github.io/p/6f9c.html</url>
    <content><![CDATA[<h2 id="安装Node-js"><a href="#安装Node-js" class="headerlink" title="安装Node.js"></a>安装Node.js</h2><ul>
<li>官网直接下载：<a href="https://nodejs.org/">https://nodejs.org/</a></li>
<li>安装node.js</li>
<li>安装淘宝镜像记录：管理员运行cmd</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果是mac，需要加<span class="built_in">sudo</span></span></span><br><span class="line">npm install cnpm -g --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<ul>
<li>这时候如果有些人会报错，证书过期不能访问之类的 需要加上</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set strict-ssl false</span><br></pre></td></tr></table></figure>

<h2 id="创建Vue项目"><a href="#创建Vue项目" class="headerlink" title="创建Vue项目"></a>创建Vue项目</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm init vue@latest</span><br></pre></td></tr></table></figure>
<p>如果安装很慢，或者提示带有 proxy 之类的错误，可以切换镜像：</p>
<ul>
<li>查看当前镜像源，输入命令：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>
<ul>
<li>切换当前镜像源为下面的镜像：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm config set registry https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>
<ul>
<li>清除npm 内缓存：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm cache clean --force</span><br></pre></td></tr></table></figure>
<p>安装后会有提示，除了创建名称外，其他的暂时选否。用到的时候再安装</p>
<p>成功后执行如下操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入项目目录</span></span><br><span class="line">cd vue-project</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们这里不用npm install，cnpm比较快</span></span><br><span class="line">cnpm install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行项目</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h2 id="Vue项目目录结构"><a href="#Vue项目目录结构" class="headerlink" title="Vue项目目录结构"></a>Vue项目目录结构</h2><table>
<thead>
<tr>
<th>文件名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>.vscode</td>
<td>VSCode工具的配置文件夹</td>
</tr>
<tr>
<td>node_modules</td>
<td>Vue项目的运行依赖文件夹</td>
</tr>
<tr>
<td>public</td>
<td>资源文件夹（浏览器图标）</td>
</tr>
<tr>
<td>src</td>
<td>源码文件夹</td>
</tr>
<tr>
<td>.gitignore</td>
<td>git忽略文件</td>
</tr>
<tr>
<td>index.html</td>
<td>入口HTML文件</td>
</tr>
<tr>
<td>package.json</td>
<td>信息描述文件</td>
</tr>
<tr>
<td>README.md</td>
<td>注释文件</td>
</tr>
<tr>
<td>vite.config.js</td>
<td>Vue配置文件</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结七【Vue事件处理-事件参数】</title>
    <url>/cnblogs.github.io/p/a020.html</url>
    <content><![CDATA[<p><strong>事件参数</strong><br>事件参数可以获取 event 对象和通过事件传递数据</p>
<h3 id="获取event对象"><a href="#获取event对象" class="headerlink" title="获取event对象"></a>获取event对象</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">count</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;       </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        	<span class="comment">// event对象</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addCount</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// Vue的event对象，就是原生JS中的event对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>) <span class="comment">// 获取当前点击的元素</span></span></span><br><span class="line"><span class="language-javascript">                e.<span class="property">target</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;Add&#x27;</span>+<span class="variable language_">this</span>.<span class="property">count</span> <span class="comment">// 修改当前点击元素的内容</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">count</span>++</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">count</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;       </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addCount</span>(<span class="params">msg</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(msg)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">count</span>++</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount(&#x27;hello&#x27;)&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取列表里的内容"><a href="#获取列表里的内容" class="headerlink" title="获取列表里的内容"></a>获取列表里的内容</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;       </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getNameHandle</span>(<span class="params">name</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当前元素的点击事件，打印当前元素的name --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;getNameHandle(name)&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(name,index) of names&quot;</span> <span class="attr">:Key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="传递参数过程中获取event"><a href="#传递参数过程中获取event" class="headerlink" title="传递参数过程中获取event"></a>传递参数过程中获取event</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;       </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getNameHandle</span>(<span class="params">name,e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当前元素的点击事件，打印当前元素的name 和点击事件对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> @<span class="attr">click</span>=<span class="string">&quot;getNameHandle(name,$event)&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(name,index) of names&quot;</span> <span class="attr">:Key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结三【Vue模板语法-属性绑定】</title>
    <url>/cnblogs.github.io/p/37cf.html</url>
    <content><![CDATA[<p><strong>基本写法</strong><br>双大括号不能在 HTML attributes 中使用。想要响应式地绑定一个 attribute，应该使用v-bind 指令，v-bind指令指示 Vue 将元素的id attribute 与组件的dynamicld 属性保持一致。如果绑定的值是 null 或者undefined，那么该 attribute 将会从渲染的元素上移除</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.appclass</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dynamicClass</span>: <span class="string">&quot;appclass&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dynamicId</span>: <span class="string">&quot;appid&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tittle</span>:<span class="literal">null</span>  </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;dynamicId&quot;</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;dynamicClass&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>布尔型 Attribute</strong><br>布尔型 attribute 依据true &#x2F; false 值来决定 attribute 是否应该存在于该元素上，disabled 就是最常见的例子之一</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">isButtonDisabled</span>:<span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">:disabled</span>=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>动态绑定多个值</strong><br>如果你有像这样的一个包含多个 attribute 的JavaScript对象</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">objectOfAttrs</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>:<span class="string">&#x27;container&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">class</span>:<span class="string">&#x27;wrapper&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:</span>=<span class="string">&quot;objectOfAttrs&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结三十【Vue组件保持存活】</title>
    <url>/cnblogs.github.io/p/f11c.html</url>
    <content><![CDATA[<p><strong>组件保持存活</strong><br>当使用<code>&lt;component :is=&quot;...&quot;&gt;</code>来在多个组件间作切换时，被切换掉的组件会被卸载。我们可以通过 <code>&lt;keep-allve&gt;</code> 组件强制被切换掉的组件仍然保持”存活”的状态<br>我们先来看个例子（依然用上节课的代码改动下）：<br>ComponentA.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentA<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>说明组件被卸载了。我们写点明文演示下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&quot;老数据&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updateHandle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&quot;新数据&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentA<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateHandle&quot;</span>&gt;</span>更新数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们点更新数据，A组件会变成新数据。切换组件B后，再去切回A组件，发现又变成了老数据。说明我们在切换的时候，组件被卸载了，所以加载的还是原始的数据。那么我们怎么保持组件存活呢？（保持新数据不变）<br>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用 keep-alive 组件来缓存动态组件，避免重复渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;tabComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeHandle&quot;</span>&gt;</span>切换组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结三十一【Vue异步组件】</title>
    <url>/cnblogs.github.io/p/42f2.html</url>
    <content><![CDATA[<p><strong>异步组件：</strong><br>在大型项目中，我们可能需要拆分应用为更小的块，并仅在需要时再从服务器加载相关组件。Vue 提供了defineAsyncComponent方法来实现此功能</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入组件A</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentA</span> <span class="keyword">from</span> <span class="string">&quot;./components/ComponentA.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;defineAsyncComponent&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 定义一个异步组件 ComponentB</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 使用 defineAsyncComponent 来懒加载组件，以提高应用的性能</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 当组件实际需要渲染时，才会加载对应的组件文件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title class_">ComponentB</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span>(<span class="string">&quot;./components/ComponentB.vue&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">)</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tabComponent</span>: <span class="string">&#x27;ComponentA&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentA</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentB</span></span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeHandle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tabComponent</span> = <span class="variable language_">this</span>.<span class="property">tabComponent</span> === <span class="string">&#x27;ComponentA&#x27;</span> ? <span class="string">&#x27;ComponentB&#x27;</span> : <span class="string">&#x27;ComponentA&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用 keep-alive 组件来缓存动态组件，避免重复渲染 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;tabComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeHandle&quot;</span>&gt;</span>切换组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结三十三【Vue应用】</title>
    <url>/cnblogs.github.io/p/8688.html</url>
    <content><![CDATA[<p>每个 Vue 应用都是通过 createApp函数创建一个新的 应用实例<br>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app:Vue的实例对象</span></span><br><span class="line"><span class="comment">// 在一个Vue项目中，有且只有一个Vue的实例对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">	<span class="comment">/* 根组件选项 */</span></span><br><span class="line"><span class="comment">// App:根组件</span></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>根组件</strong><br>我们传入createApp的对象实际上是一个组件，每个应用都需要一个根组件”，其他组件将作为其子组件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从一个单文件组件中导入根组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>挂载应用</strong><br>应用实例必须在调用了.mount()方法后才会渲染出来。该方法接收一个“容器”参数，可以是一个实际的DOM元素或是一个 CSS 选择器字符串</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>#app –&gt; index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vite App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  </span></span><br><span class="line"><span class="comment">				浏览器可执行文件：</span></span><br><span class="line"><span class="comment">				1.Html</span></span><br><span class="line"><span class="comment">				2.CSS</span></span><br><span class="line"><span class="comment">				3.JavaScript</span></span><br><span class="line"><span class="comment">				4.Image</span></span><br><span class="line"><span class="comment">				</span></span><br><span class="line"><span class="comment">				构建工具：Webpack  vite</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/src/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>公共资源</strong><br>在src目录下的assets文件夹的作用就是存放公共资源，例如：图片、公共CSS或者字体图标等</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结三十二【Vue依赖注入】</title>
    <url>/cnblogs.github.io/p/d0e5.html</url>
    <content><![CDATA[<p>通常情况下，当我们需要从父组件向子组件传递数据时，会使用 props。想象一下这样的结构：有一些多层级嵌套的组件，形成了一颗巨大的组件树，而某个深层的子组件需要一个较远的祖先组件中的部分数据。在这种情况下，如果仅使用 props则必须将其沿着组件链逐级传递下去，这会非常麻烦<br>这一问题被称为“prop 逐级透传” provide和inject 可以帮助我们解决这一问题。一个父组件相对于其所有的后代组件，会作为依赖提供者。任何后代的组件树，无论层级有多深，都可以注入由父组件提供给整条链路的依赖<br>App.vue(祖宗组件)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Parent</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Parent.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Parent</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * 提供组件间共享的数据或功能</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> *</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * 在Vue中，provide选项允许我们向子组件树提供数据或功能，而不需要通过props逐层传递</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * 这里提供的`message`属性，值为&#x27;祖宗的财产&#x27;，可以被任意子组件注入和使用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> *</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * <span class="doctag">@providedProperties</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> *   - &#123;String&#125; message 提供给子组件的字符串常量</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">provide</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">message</span>: <span class="string">&#x27;祖宗的财产&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>祖宗<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Parent</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Parent.vue（父组件）</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;@/components/Child.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Child</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>父组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Child.vue(子组件)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注入外部提供的 message 属性或方法</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 这使得组件可以访问在其祖先组件中提供的 message，而无需通过每一层组件进行传递</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">inject</span>: [<span class="string">&quot;message&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>扩展：</strong><br>也可以从data中读取数据：<br>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Parent</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Parent.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Parent</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&#x27;祖宗的财产!!!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * <span class="doctag">@returns</span> &#123;<span class="type">Object</span>&#125; 返回一个对象，其中包含要提供的数据属性</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">provide</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 提供的 message 属性，其值为当前组件的 message 属性值</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="variable language_">this</span>.<span class="property">message</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>祖宗<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Parent</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注入会在组件自身的状态之前被解析，因此你也可以在data()中访问到注入的属性：<br>Child.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">inject</span>: [<span class="string">&quot;message&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * 组件的初始数据函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   *</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * 该函数用于定义和初始化组件的数据属性在这里，我们创建了一个名为 `fullMessage` 的数据属性，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * 它的初始值来源于组件的 `message` 属性这样做是为了在组件内部维护一个独立于原始 `message` 属性的副本，</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * 以便在不改变原始数据的情况下进行操作或展示</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   */</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fullMessage</span>: <span class="variable language_">this</span>.<span class="property">message</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>子组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; fullMessage &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了在一个组件中提供依赖，我们还可以在整个应用层面提供依赖:<br>main.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="comment">// 提供一个全局数据项，键名为 &#x27;golabDate&#x27;，值为 &#x27;我是全局数据&#x27;</span></span><br><span class="line">app.<span class="title function_">provide</span>(<span class="string">&#x27;golabDate&#x27;</span>, <span class="string">&#x27;我是全局数据&#x27;</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>温馨提示</strong><br>provide和inject只能由上到下的传递，不能反向传递</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结九【Vue数组变化侦测】</title>
    <url>/cnblogs.github.io/p/ea13.html</url>
    <content><![CDATA[<p><strong>变更方法</strong><br>Vue 能够侦听应式数组的变更方法，并在它们被调用时触发相关的更新。这些变更方法包括：</p>
<ul>
<li>push()</li>
<li>pop()</li>
<li>shift()</li>
<li>unshift()</li>
<li>splice()</li>
<li>sort()</li>
<li>reverse()</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>: [<span class="string">&#x27;zhangsan&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="string">&#x27;wangwu&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addListHandler</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 引起UI自动更新</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">names</span>.<span class="title function_">push</span>(<span class="string">&#x27;zhaoliu&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>数组变化侦听<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addListHandler&quot;</span>&gt;</span>添加数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(name, index) of names&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>替换一个数组</strong><br>变更方法，顾名思义，就是会对调用它们的原数组进行变更。相对地，也有一些不可变（immutable）方法，例如filter(),concat()和slice()，这些都不会更改原数组，而总是返回一个新数组。当遇到的是非变更方法时，我们需要将旧的数组替换为新的</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>: [<span class="string">&#x27;zhangsan&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="string">&#x27;wangwu&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addListHandler</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 引起UI自动更新</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// this.names.push(&#x27;zhaoliu&#x27;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 不会引起UI自动更新</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//this.names.concat([&#x27;zhaoliu&#x27;])</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//console.log(this.names)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 如果想引起UI自动更新，需要赋值给names</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">names</span> = <span class="variable language_">this</span>.<span class="property">names</span>.<span class="title function_">concat</span>([<span class="string">&#x27;zhaoliu&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">names</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>数组变化侦听<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addListHandler&quot;</span>&gt;</span>合并数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(name, index) of names&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二【Vue模板语法-文本插值】</title>
    <url>/cnblogs.github.io/p/ff55.html</url>
    <content><![CDATA[<p><strong>基本写法</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">msg</span>: <span class="string">&quot;hello world&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>模板语法<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>使用JavaScript表达式</strong><br>每个绑定仅支持单一表达式，也就是一段能够被求值的JavaScript代码。一个简单的判断方法是是否可以合法地写在return后面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">number</span>: <span class="number">10</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">ok</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&quot;大家好&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>模板语法<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; number + 1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; ok ? &#x27;yes&#x27; : &#x27;no&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>无效写法</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这是一个语句，而非表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; var a = 1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 条件控制也不支持，请使用三元表达式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; if (ok) &#123; return message &#125; &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>原始HTML</strong><br>双大括号将会将数据插值为纯文本，而不是HTML。若想插入HTML，你需要使用v-htmI指令</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">rawHtml</span>: <span class="string">&quot;&lt;a href=&#x27;https://www.baidu.com&#x27;&gt;百度&lt;/a&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>模板语法<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; rawHtml &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 按照下面方式写就可以了 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;rawHtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十【Vue组件事件】</title>
    <url>/cnblogs.github.io/p/dd9e.html</url>
    <content><![CDATA[<p><strong>组件事件</strong><br>在组件的模板表达式中，可以直接使用$emit方法触发自定义事件，触发自定义事件的目的是组件之间传递数据<br>我们来创建2个组件。父组件： ComponentEvent.vue,子组件：Child.vue<br>Child.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 子组件通过$emit触发父组件的自定义事件并传递数据</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// someEvent为自定义事件名，&quot;来自Child的数据&quot;为传递的数据</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">clickEventHandle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&quot;someEvent&quot;</span>, <span class="string">&quot;来自Child的数据&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Child<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 点击按钮触发clickEventHandle方法，通过$emit传递数据给父组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;clickEventHandle&quot;</span>&gt;</span>传递数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ComponentEvent.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&quot;./Child.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 用于存储子组件传递的数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Child</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 接收子组件传递的数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// data为接收到的数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getHandle</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">message</span>=data;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>组件事件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 子组件监听someEvent事件，绑定getHandle方法处理数据 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Child</span> @<span class="attr">someEvent</span>=<span class="string">&quot;getHandle&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 显示接收到的数据 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>父元素：&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十一【Vue组件事件配合v-model使用】</title>
    <url>/cnblogs.github.io/p/69c1.html</url>
    <content><![CDATA[<p><strong>组件事件配合v-model使用</strong><br>如果是用户输入，我们希望在获取数据的同时发送数据配合v-model 来使用，帮助理解组件间的通信和数据绑定。</p>
<h3 id="第一步：创建子组件（SearchComponent-vue）"><a href="#第一步：创建子组件（SearchComponent-vue）" class="headerlink" title="第一步：创建子组件（SearchComponent.vue）"></a>第一步：创建子组件（SearchComponent.vue）</h3><p>这个组件用于处理用户的搜索输入，并将输入值传递给父组件。<br>✅ 功能说明：</p>
<ul>
<li>数据属性 search：在 [data()]中定义了一个名为 search 的数据属性，作为输入框的双向绑定。</li>
<li>使用 v-model：模板中的 <code>&lt;input type=&quot;text&quot; v-model=&quot;search&quot;&gt;</code> 实现了用户输入与 search 数据的同步。</li>
<li>监听器 [watch]：当 search 发生变化时，通过 $emit 触发一个名为 searchEvent 的自定义事件，并传入新的值。</li>
<li>输出事件 searchEvent：该事件允许父组件订阅并接收子组件的数据更新。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SearchComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./SearchComponent.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SearchComponent</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">search</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getSearch</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">search</span> = data</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>搜索内容 &#123;&#123; search &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SearchComponent</span> @<span class="attr">searchEvent</span>=<span class="string">&quot;getSearch&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第二步：创建主组件（Main-vue）"><a href="#第二步：创建主组件（Main-vue）" class="headerlink" title="第二步：创建主组件（Main.vue）"></a>第二步：创建主组件（Main.vue）</h3><p>这个组件负责显示来自子组件的数据，并展示到页面上。<br>✅ 功能说明：</p>
<ul>
<li>引入子组件：使用 import SearchComponent from ‘.&#x2F;SearchComponent.vue’ 引入子组件。</li>
<li>注册组件：在 [components]属性中注册 SearchComponent。</li>
<li>数据属性 search：用来保存从子组件接收到的搜索内容。</li>
<li>方法 getSearch(data)：响应子组件发出的 searchEvent 事件，将数据赋值给 this.search。</li>
<li>模板渲染：使用插值表达式  显示当前搜索内容，并通过 @searchEvent&#x3D;”getSearch” 监听子组件的事件。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SearchComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./SearchComponent.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SearchComponent</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">search</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getSearch</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">search</span> = data</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>搜索内容 &#123;&#123; search &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SearchComponent</span> @<span class="attr">searchEvent</span>=<span class="string">&quot;getSearch&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="第三步：运行项目"><a href="#第三步：运行项目" class="headerlink" title="第三步：运行项目"></a>第三步：运行项目</h3><p>确保你的项目结构如下：<br>src&#x2F;<br>├── components&#x2F;<br>│   ├── SearchComponent.vue<br>│   └── Main.vue<br>├── App.vue<br>└── main.js<br>修改 [App.vue]：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Main</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Main</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Main.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Main</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后启动项目：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>
<p>总结</p>
<ul>
<li>父子组件通信：通过 $emit 在子组件中发送事件，在父组件中监听并处理。</li>
<li>数据绑定：v-model 简化了表单元素与数据之间的双向绑定。</li>
<li>模块化开发：将功能拆分为多个组件，提高可维护性和复用性。</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十七【Vue组件生命周期】</title>
    <url>/cnblogs.github.io/p/85db.html</url>
    <content><![CDATA[<p>每个Vue组件实例在创建时都需要经历一系列的初始化步骤，比如设置好数据侦听，编译模板，挂载实例到DOM，以及在数据改变时更新DOM。在此过程中，它也会运行被称为生命周期钩子的函数，让开发者有机会在特定阶段运行自己的代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 组件的生命周期</span><br><span class="line"> * 1. 创建阶段:beforeCreate,created</span><br><span class="line"> * 2. 挂载阶段:beforeMount,mounted</span><br><span class="line"> * 3. 更新阶段:beforeUpdate,updated</span><br><span class="line"> * 4. 销毁阶段:beforeUnmount,unmounted</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<p>在 Vue 中，组件的生命周期是指从创建到销毁的整个过程。Vue 提供了多个钩子函数，允许我们在特定的阶段执行自定义逻辑。<br>Vue 组件的生命周期可以分为四个主要阶段：</p>
<h3 id="1-创建阶段"><a href="#1-创建阶段" class="headerlink" title="1. 创建阶段"></a>1. 创建阶段</h3><ul>
<li>beforeCreate()：组件实例刚刚被创建，此时数据观测和事件配置尚未初始化。</li>
<li>created()：组件实例已经创建完成，数据观测、属性和事件方法已经配置好。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建之前&#x27;</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建完毕&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-挂载阶段"><a href="#2-挂载阶段" class="headerlink" title="2. 挂载阶段"></a>2. 挂载阶段</h3><ul>
<li>beforeMount()：模板编译&#x2F;挂载之前，此时还没有渲染 DOM。</li>
<li>mounted()：模板渲染完成，此时可以访问 DOM 元素。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染之前&#x27;</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染完毕&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-更新阶段"><a href="#3-更新阶段" class="headerlink" title="3. 更新阶段"></a>3. 更新阶段</h3><ul>
<li>beforeUpdate()：组件更新之前，响应式数据发生变化但 DOM 还未更新。</li>
<li>updated()：组件更新完成后调用，此时 DOM 已经更新。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新之前&#x27;</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">updated</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新完毕&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-销毁阶段"><a href="#4-销毁阶段" class="headerlink" title="4. 销毁阶段"></a>4. 销毁阶段</h3><ul>
<li>beforeUnmount()：组件销毁之前调用，此时组件仍然完全可用。</li>
<li>unmounted()：组件销毁完成后调用，此时所有指令已被解绑，子组件也已被销毁。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁之前&#x27;</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁完毕&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下是一个完整的示例，展示了如何在 App.vue 文件中使用这些生命周期钩子：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建之前&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建完毕&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染之前&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染完毕&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新之前&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新完毕&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁之前&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁完毕&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>组件的生命周期<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>app.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">messgae</span>: <span class="string">&#x27;更新之前&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updataHandle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">messgae</span> = <span class="string">&#x27;更新之后&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件创建完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件挂载/渲染完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件更新完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeUnmount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁之前&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">unmounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件销毁完毕&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>组件的生命周期<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; messgae &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updataHandle&quot;</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十三【Vue透传Attributes】</title>
    <url>/cnblogs.github.io/p/698e.html</url>
    <content><![CDATA[<p><strong>透传 Attributes</strong></p>
<p>透传attribute指的是传递给一个组件，却没有被该组件声明为props或emits的attribute或者v-on事件监听器。最常见的例子就是class、style和id.当一个组件以单个元素为根作渲染时，透传的attribute会自动被添加到根元素上<br>透传 Attributes 是 Vue 的一个特性，允许父组件传递任意属性到子组件上，而无需显式声明。这在封装可复用的组件时非常有用。</p>
<h3 id="步骤-1-创建子组件"><a href="#步骤-1-创建子组件" class="headerlink" title="步骤 1: 创建子组件"></a>步骤 1: 创建子组件</h3><p>创建一个名为 AttrComponents.vue 的子组件，并定义一个模板部分：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--  必须是唯一元素  如果多了其他元素 就不生效  比如&lt;p&gt;&lt;h2&gt;等--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>透传属性<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个组件没有显式声明任何 props 或其他属性处理逻辑。</p>
<h3 id="步骤-2-在父组件中使用子组件"><a href="#步骤-2-在父组件中使用子组件" class="headerlink" title="步骤 2: 在父组件中使用子组件"></a>步骤 2: 在父组件中使用子组件</h3><p>在你的主组件 App.vue中导入并注册子组件 AttrComponents：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">AttrComponents</span> <span class="keyword">from</span> <span class="string">&quot;./components/AttrComponents.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">AttrComponents</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AttrComponents</span> <span class="attr">class</span>=<span class="string">&quot;attr-container&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.attr-container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们通过 class&#x3D;”attr-container” 将样式类传递给子组件。</p>
<h3 id="步骤-3-使用透传的属性"><a href="#步骤-3-使用透传的属性" class="headerlink" title="步骤 3: 使用透传的属性"></a>步骤 3: 使用透传的属性</h3><p>当子组件接收到这些属性时，它们会自动应用到子组件的根元素上。在上面的例子中，class&#x3D;”attr-container” 被应用到了 <h3> 元素上，因此 <h3> 的文字颜色将会是红色。</p>
<p><strong>注意事项</strong></p>
<ul>
<li>透传的属性会直接绑定到组件的根元素上。</li>
<li>如果你在子组件中需要对属性进行更复杂的处理，可以使用 props显式声明它们。</li>
<li>如果你不希望某些属性被自动绑定，你可以使用inheritAttrs选项来控制。<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  必须是唯一元素  如果多了其他元素 就不生效  比如&lt;p&gt;&lt;h2&gt;等--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>透传属性<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">inheritAttrs</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十九【Vue动态组件】</title>
    <url>/cnblogs.github.io/p/c63a.html</url>
    <content><![CDATA[<p><strong>动态组件</strong><br>有些场景会需要在两个组件间来回切换，比如 Tab 界面，我们准备好A B两个组件ComponentA ComponentA<br>App.vue代码如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentA</span> <span class="keyword">from</span> <span class="string">&quot;./components/ComponentA.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentB</span> <span class="keyword">from</span> <span class="string">&quot;./components/ComponentB.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化组件状态，决定首先渲染ComponentA</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tabComponent</span>: <span class="string">&#x27;ComponentA&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentA</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentB</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 动态组件，根据data中的tabComponent属性值来决定渲染哪个组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;tabComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在我们加个按钮来切换组件：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入组件A</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentA</span> <span class="keyword">from</span> <span class="string">&quot;./components/ComponentA.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入组件B</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentB</span> <span class="keyword">from</span> <span class="string">&quot;./components/ComponentB.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化组件状态，决定首先渲染ComponentA</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tabComponent</span>: <span class="string">&#x27;ComponentA&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 注册组件A和组件B</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentA</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentB</span></span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换组件的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeHandle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 根据当前的tabComponent属性值来决定切换到哪个组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tabComponent</span> = <span class="variable language_">this</span>.<span class="property">tabComponent</span> === <span class="string">&#x27;ComponentA&#x27;</span> ? <span class="string">&#x27;ComponentB&#x27;</span> : <span class="string">&#x27;ComponentA&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 动态组件，根据data中的tabComponent属性值来决定渲染哪个组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;tabComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 当用户点击按钮时，调用changeHandle方法来切换组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeHandle&quot;</span>&gt;</span>切换组件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十二【Vue组件数据传递】</title>
    <url>/cnblogs.github.io/p/66e0.html</url>
    <content><![CDATA[<p><strong>_组件数据传递</strong><br>我们之前讲解过了组件之间的数据传递，props 和自定义事件 两种方式</p>
<ul>
<li>props：父传子</li>
<li>自定义事件：子传父</li>
</ul>
<p>除了上述的方案，props也可以实现子传父</p>
<h2 id="一、项目结构"><a href="#一、项目结构" class="headerlink" title="一、项目结构"></a>一、项目结构</h2><p>src&#x2F;<br>└── components&#x2F;<br>    ├── ComponentsA.vue  # 父组件<br>    └── ComponentsB.vue  # 子组件</p>
<h2 id="二、子组件-ComponentsB-vue-解析"><a href="#二、子组件-ComponentsB-vue-解析" class="headerlink" title="二、子组件(ComponentsB.vue)解析"></a>二、子组件(ComponentsB.vue)解析</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">onEvent</span>: <span class="title class_">Function</span>  <span class="comment">// 接收父组件传递的函数</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentsB<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; onEvent(&#x27;传递数据&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  <span class="comment">&lt;!-- 调用父组件函数并传递参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、父组件-ComponentsA-vue-解析"><a href="#三、父组件-ComponentsA-vue-解析" class="headerlink" title="三、父组件(ComponentsA.vue)解析"></a>三、父组件(ComponentsA.vue)解析</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentsB</span> <span class="keyword">from</span> <span class="string">&quot;@/components/ComponentsB.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ComponentsB</span>  <span class="comment">// 注册子组件</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&#x27;&#x27;</span>  <span class="comment">// 用于接收子组件传递的数据</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">dataFn</span>(<span class="params">data</span>) &#123;  <span class="comment">// 子组件调用的方法</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">message</span> = data</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentsA<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>父元素：&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  <span class="comment">&lt;!-- 显示子组件传递的数据 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ComponentsB</span> <span class="attr">:onEvent</span>=<span class="string">&quot;dataFn&quot;</span>/&gt;</span>  <span class="comment">&lt;!-- 绑定方法到子组件属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、通信原理图解"><a href="#四、通信原理图解" class="headerlink" title="四、通信原理图解"></a>四、通信原理图解</h2><ul>
<li>父组件通过:绑定方法到子组件属性 onEvent</li>
<li>子组件通过 props 接收这个函数</li>
<li>子组件中调用 onEvent(‘传递数据’) 直接触发父组件方法</li>
<li>父组件的 dataFn 方法被调用，更新 message 数据</li>
<li>模板中的  被更新显示</li>
</ul>
<h2 id="五、关键点说明"><a href="#五、关键点说明" class="headerlink" title="五、关键点说明"></a>五、关键点说明</h2><ul>
<li>父组件通过 props 向子组件传递函数</li>
<li>子组件可以直接在模板中调用这个函数并传递参数</li>
<li>父组件的方法可以直接操作组件状态(message)</li>
<li>这种方式实现了子组件向父组件传值的单向通信</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十五【Vue插槽slot（2）】</title>
    <url>/cnblogs.github.io/p/4bd2.html</url>
    <content><![CDATA[<p><strong>渲染作用域</strong><br>插槽内容可以访问到父组件的数据作用域，因为插槽内容本身是在父组件模板中定义的<br>SlotsTow.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Slots续集<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SlotsTow</span> <span class="keyword">from</span> <span class="string">&quot;@/components/SlotsTow.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SlotsTow</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">message</span>: <span class="string">&quot;插槽内容续集&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SlotsTow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SlotsTow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>默认内容</strong><br>在外部没有提供任何内容的情况下，可以为插槽指定默认内容</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Slots续集<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span>插槽默认值<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>具名插槽</strong><br>多个插槽情况下：<br>SlotsTow.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Slots续集<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span>&gt;</span>插槽默认值<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;main&quot;</span>&gt;</span>插槽默认值<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SlotsTow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SlotsTow</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>v-slot有对应的简写#，因此<code>&lt;template v-slot:header&gt;</code>可以简写为<code>&lt;template #header&gt;</code>。其意思就是“将这部分模板片段传入子组件的header插槽中</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十八【Vue生命周期的应用】</title>
    <url>/cnblogs.github.io/p/bab4.html</url>
    <content><![CDATA[<p><strong>生命周期的应用</strong><br>组件的生命周期会随着我们对Vue的了解越多，也会越来越重要，这里我们先讲两个常用的应用常见：</p>
<ul>
<li>通过ref获取元素DOM结构</li>
<li>模拟网络请求渲染数据</li>
</ul>
<p>通过ref获取元素DOM结构</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">name</span>); <span class="comment">// 组件挂载/渲染之前，获取不到</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">name</span>); <span class="comment">// 组件挂载/渲染完毕，获取到了</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>组件生命周期函数应用<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">ref</span>=<span class="string">&quot;name&quot;</span>&gt;</span>程序员<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>模拟网络请求渲染数据</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">banner</span>: []</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123; </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 模拟网络请求，组件挂载/渲染完毕，先有组件再有数据好些，所以用mounted()</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="property">banner</span> =</span></span><br><span class="line"><span class="language-javascript">        [</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;第一届编程大赛&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;contest&quot;</span>: <span class="string">&quot;算法竞赛&quot;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;创意设计展&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;contest&quot;</span>: <span class="string">&quot;平面设计比赛&quot;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;科技创新奖&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&quot;contest&quot;</span>: <span class="string">&quot;科研项目评选&quot;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">    ;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>组件生命周期函数应用<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,  index) in banner&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; item.title &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; item.contest &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十六【Vue插槽slot（3）】</title>
    <url>/cnblogs.github.io/p/2f68.html</url>
    <content><![CDATA[<p>在某些场景下插槽的内容可能想要同时使用父组件域内和子组件域内的数据。要做到这一点，我们需要一种方法来让子组件在渲染时将一部分数据提供给插槽。我们也确实有办法这么做！可以像对组件传递props那样，向一个插槽的出口上传递attributes<br>SlotsAttr.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * 定义一个Vue组件</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> * 该组件包含一个名为childMessage的数据属性，用于传递信息到子组件</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"> */</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化组件的数据属性</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">childMessage</span>: <span class="string">&#x27;子组件数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 组件标题 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Slots3<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 定义一个插槽，并传递childMessage数据属性给子组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:msg</span>=<span class="string">&quot;childMessage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 导入SlotsAttr组件，用于展示插槽内容</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SlotsAttr</span> <span class="keyword">from</span> <span class="string">&quot;@/components/SlotsAttr.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 定义当前组件的导出对象</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注册组件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SlotsAttr</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 定义数据属性</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 当前测试内容</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentTest</span>: <span class="string">&quot;测试内容&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 使用SlotsAttr组件，并通过v-slot指令定义默认插槽的内容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SlotsAttr</span> <span class="attr">v-slot</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 展示来自组件内部的数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; currentTest &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 展示来自SlotsAttr组件传递的msg属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; slotProps.msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SlotsAttr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>具名插槽传递数据</strong><br>SlotsAttr.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化组件的数据属性</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">childMessage</span>: <span class="string">&#x27;具名子组件数据&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">jobMessage</span>: <span class="string">&#x27;程序员&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Slots3<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span> <span class="attr">:msg</span>=<span class="string">&quot;childMessage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;main&quot;</span> <span class="attr">:job</span>=<span class="string">&quot;jobMessage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SlotsAttr</span> <span class="keyword">from</span> <span class="string">&quot;@/components/SlotsAttr.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SlotsAttr</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SlotsAttr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">header</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; slotProps.msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">main</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; slotProps.job &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SlotsAttr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结二十四【Vue插槽slot（1）】</title>
    <url>/cnblogs.github.io/p/917d.html</url>
    <content><![CDATA[<p>插槽是 Vue 中组件内容分发的机制，允许你在父组件中向子组件传递任意 HTML 内容。</p>
<h3 id="子组件：SlotsBase-vue"><a href="#子组件：SlotsBase-vue" class="headerlink" title="子组件：SlotsBase.vue"></a>子组件：SlotsBase.vue</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>插槽基础知识<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span> <span class="comment">&lt;!-- 插槽出口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;slot&gt;&lt;/slot&gt;</code> 是一个插槽出口，表示在使用该组件时可以插入自定义内容。</li>
<li>在这个例子中，我们定义了一个标题 “插槽基础知识”，下方是一个默认插槽。</li>
</ul>
<h3 id="父组件：App-vue"><a href="#父组件：App-vue" class="headerlink" title="父组件：App.vue"></a>父组件：App.vue</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">SlotsBase</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>插槽标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>插槽内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">SlotsBase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">SlotsBase</span> <span class="keyword">from</span> <span class="string">&quot;@/components/SlotsBase.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">SlotsBase</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们在 App.vue中引入并使用了 SlotsBase 组件。使用方式 <code>&lt;SlotsBase&gt;...&lt;/SlotsBase&gt;</code> 标签之间的内容会替换掉子组件中的 <code>&lt;slot&gt;&lt;/slot&gt;</code>。</p>
<p><strong>总结</strong></p>
<ul>
<li>子组件通过 <code>&lt;slot&gt;&lt;/slot&gt;</code> 定义插槽入口。</li>
<li>父组件在使用子组件时，在其标签内部写入内容即可传入插槽。</li>
<li>插槽内容支持任何 HTML 元素和结构。<br><code>&lt;slot&gt;</code>元素是一个插槽出口(slotoutlet)，标示了父元素提供的插槽内容(slotcontent)将在哪里被渲染</li>
</ul>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结五【Vue模板语法-列表渲染】</title>
    <url>/cnblogs.github.io/p/c81c.html</url>
    <content><![CDATA[<p><strong>基本写法</strong><br>我们可以使用 v-for 指令基于一个数组来渲染一个列表。 v-for 指令的值需要使用 item in items 形式的特殊语法其中 items 是源数据的数组，而 item 是迭代项的别名</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>列表渲染<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in names&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>复杂数据</strong><br>大多数情况，我们渲染的数据源来源于网络请求，也就是 JSON格式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">books</span>:[&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">25739</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;将进酒·君不见黄河之水天上来&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/25739.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">35180</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;江城子·乙卯正月二十日夜记梦&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/35180.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">3638</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;声声慢·寻寻觅觅&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/3638.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        ]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>列表渲染<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in names&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;book in books&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-bind:src</span>=<span class="string">&quot;book.img&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>位置索引</strong><br>v-for 也支持使用可选的第二个参数表示当前项的位置索引</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>列表渲染<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in names&quot;</span>&gt;</span>&#123;&#123; &quot;item&quot; &#125;&#125;-&#123;&#123; index &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>你也可以使用of作为分隔符代替in，这更接近JavaScript语法</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) of names&quot;</span>&gt;</span>&#123;&#123; &quot;items&quot; &#125;&#125;-&#123;&#123; index &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>v-for与对象</strong><br>你也可以使用v-for遍历一个对象的所有属性</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">user</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>:<span class="string">&#x27;26&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>列表渲染<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(value,key,index) of user&quot;</span>&gt;</span>&#123;&#123; value &#125;&#125;-&#123;&#123; key &#125;&#125;-&#123;&#123; index &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>通过key管理状态</strong><br>Vue默认按照“就地更新”的策略来更新通过v-for渲染的元素列表。当数据项的顺序改变时，Vue不会随之移动DOM元素的顺序，而是就地更新每个元素，确保它们在原本指定的索引位置上渲染。 为了给Vue一个提示，以便它可以跟踪每个节点的标识，从而重用和重新排序现有的元素，你需要为每个元素对应的块提供一个唯一的key attribute：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>],            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) of names&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>温馨提示 key在这里是一个通过v-bind绑定的特殊attribute 推荐在任何可行的时候为v-for提供一个key attribute key绑定的值期望是一个基础类型的值，例如字符串或number类型</li>
</ul>
<p>请不要使用index作为key的值，我们要确保每一条数据的唯一索引不会发生变化</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">names</span>:[<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;王五&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">books</span>:[&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">25739</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;将进酒·君不见黄河之水天上来&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/25739.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">35180</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;江城子·乙卯正月二十日夜记梦&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/35180.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;id&quot;</span>:<span class="number">3638</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;title&quot;</span>:<span class="string">&quot;声声慢·寻寻觅觅&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&quot;img&quot;</span>:<span class="string">&quot;https://img.shicimingju.com/pics/item/3638.jpg&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">        ],</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) of names&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;(book,index) in books&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;book.id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; book.title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结八【Vue事件处理-事件修饰符】</title>
    <url>/cnblogs.github.io/p/11d0.html</url>
    <content><![CDATA[<p><strong>事件修饰符</strong><br>在处理事件时调用 event.preventDefault() 或 event.stopPropagation() 是很常见的。尽管我们可以直接在方法内调用，但如果方法能更专注于数据逻辑而不用去处理 DOM 事件的细节会更好。为解决这一问题，Vue 为 v-on 提供了事件修饰符。修饰符是用 . 表示的指令后缀，包含以下这些：</p>
<ul>
<li>.stop</li>
<li>.prevent</li>
<li>.self</li>
<li>.capture</li>
<li>.once</li>
<li>.passive</li>
</ul>
<h3 id="阻止默认事件"><a href="#阻止默认事件" class="headerlink" title="阻止默认事件"></a>阻止默认事件</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">   </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">clickHandle</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 阻止默认事件,之前我们都是要这么写</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//e.preventDefault()</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>事件修饰符<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 阻止默认事件,Vue可以这样写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;clickHandle&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="阻止事件冒泡"><a href="#阻止事件冒泡" class="headerlink" title="阻止事件冒泡"></a>阻止事件冒泡</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">   </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">clickHandle</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 阻止默认事件,之前我们都是要这么写</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//e.preventDefault()</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">clickDiv</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">clickP</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 阻止事件冒泡</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// e.stopPropagation()</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了p&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>事件修饰符<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 阻止默认事件,Vue可以这样写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;clickHandle&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;clickDiv&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 阻止事件冒泡 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> @<span class="attr">click.stop</span>=<span class="string">&quot;clickP&quot;</span>&gt;</span>测试冒泡<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结六【Vue事件处理-事件处理】</title>
    <url>/cnblogs.github.io/p/663a.html</url>
    <content><![CDATA[<p><strong>事件处理</strong><br>我们可以使用v-on指令（简写为@)来监听DOM事件，并在事件触发时执行对应的JavaScript。用法：on:click&#x3D;”methodName”或@click&#x3D;”handler”</p>
<ul>
<li>内联事件处理器：事件被触发时执行的内联JavaScript语句（与onclick类似)</li>
<li>方法事件处理器：一个指向组件上定义的方法的属性名或是路径</li>
</ul>
<h3 id="内联事件处理器（少用）"><a href="#内联事件处理器（少用）" class="headerlink" title="内联事件处理器（少用）"></a>内联事件处理器（少用）</h3><p>内联事件处理器通常用于简单场景</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">count</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">on:</span>@<span class="attr">click</span>=<span class="string">&quot;count++&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="方法事件处理器（常用）"><a href="#方法事件处理器（常用）" class="headerlink" title="方法事件处理器（常用）"></a>方法事件处理器（常用）</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">count</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;       </span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 所有的方法或者事件，都放在这里</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addCount</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 读取到data里的数据方案：this.count</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">count</span>++</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>内联事件处理<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addCount&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十【Vue计算属性】</title>
    <url>/cnblogs.github.io/p/c920.html</url>
    <content><![CDATA[<p><strong>计算属性</strong><br>模板中的表达式虽然方便，但也只能用来做简单的操作。如果在模板中写太多逻辑，会让模板变得臃肿，难以维护，因此我们推荐使用计算属性依赖响应式状态的复杂逻辑。假设，我们判断，一个数组里是否有数据，之前我们是这么写：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">           <span class="attr">itzhangsan</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">content</span>:[<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;Python&#x27;</span>,<span class="string">&#x27;Java&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">           &#125; </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; itzhangsan.name &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 输出数组长度,若数组长度大于0则输出yes,否则输出no --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; itzhangsan.content.length &gt;0 ? &#x27;yes&#x27;:&#x27;no&#x27;&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果上面逻辑太多的话，会让模板变得臃肿。所以我们用计算属性。当然，我们用函数也可以实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">        <span class="title function_">itzhangsanContents</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//当itzhangsan.content数组长度大于0时,返回yes,否则返回no</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">itzhangsan</span>.<span class="property">content</span>.<span class="property">length</span> &gt;<span class="number">0</span> ? <span class="string">&#x27;yes&#x27;</span>:<span class="string">&#x27;no&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>计算属性缓存 VS 方法<br>你可能注意到我们在表达式中像这样调用一个函数也会获得和计算属性相同的结果</p>
<p><strong>重点区别：</strong><br>计算属性：计算属性值会基于其响应式依赖被缓存。一个计算属性仅会在其响应式依赖更新时才重新计算<br>方法：方法调用总是会在重渲染发生时再次执行函数</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十一【Vue的Class绑定】</title>
    <url>/cnblogs.github.io/p/f8ea.html</url>
    <content><![CDATA[<p><strong>Class绑定</strong><br>数据绑定的一个常见需求场景是操纵元素的 CSS class 列表，因为 class 是 attribute，我们可以和其他attribute 一样使用 v-bind 将它们和动态的字符串绑定。但是，在处理比较复杂的绑定时，通过拼接生成字符串是麻烦且易出错的。因此，Vue 专门为 cass 的 v-bind 用法提供了特殊的功能增强。除了字符串外，表达的值也可以是对象或数组</p>
<h3 id="绑定对象"><a href="#绑定对象" class="headerlink" title="绑定对象"></a>绑定对象</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">isActive</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">hasError</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">           &#125; </span></span><br><span class="line"><span class="language-javascript">        &#125;    </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;active&#x27;:isActive,&#x27;text-danger&#x27;:hasError&#125;&quot;</span>&gt;</span>Class样式绑定<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.text-danger</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="多个对象绑定"><a href="#多个对象绑定" class="headerlink" title="多个对象绑定"></a>多个对象绑定</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">isActive</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">hasError</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 多个对象绑定</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">classObjece</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">active</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="string">&#x27;text-danger&#x27;</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">           &#125; </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">       </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;active&#x27;:isActive,&#x27;text-danger&#x27;:hasError&#125;&quot;</span>&gt;</span>Class样式绑定1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;classObjece&quot;</span>&gt;</span>Class样式绑定2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.text-danger</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="绑定数组"><a href="#绑定数组" class="headerlink" title="绑定数组"></a>绑定数组</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">isActive</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">hasError</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">classObjece</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">             <span class="attr">active</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">             <span class="string">&#x27;text-danger&#x27;</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">arrActive</span>:<span class="string">&#x27;active&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">arrHasError</span>:<span class="string">&#x27;text-danger&#x27;</span></span></span><br><span class="line"><span class="language-javascript">           &#125; </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;active&#x27;:isActive,&#x27;text-danger&#x27;:hasError&#125;&quot;</span>&gt;</span>Class样式绑定1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;classObjece&quot;</span>&gt;</span>Class样式绑定2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># 绑定数组</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;[arrActive,arrHasError]&quot;</span>&gt;</span>Class样式绑定3<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.active</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.text-danger</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>:red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果你也想在数组中有条件地渲染某个 class，你可以使用三元表达式</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;[isActive ? &#x27;active&#x27; : &#x27;&#x27;]&quot;</span>&gt;</span>Class样式绑定4<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="数组和对象"><a href="#数组和对象" class="headerlink" title="数组和对象"></a>数组和对象</h3><p>数组和对象嵌套过程中，只能是数组嵌套对象，不能反其道而行</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;[isActive ? &#x27;active&#x27; : &#x27;&#x27;, &#123; &#x27;text-danger&#x27;: hasError &#125;]&quot;</span>&gt;</span>Class样式绑定5<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="style绑定"><a href="#style绑定" class="headerlink" title="style绑定"></a>style绑定</h3><p>同理，style也可以类似绑定</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">ColorObjet</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">fontSize</span>:<span class="number">60</span>+<span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">:style</span>=<span class="string">&quot;ColorObjet&quot;</span>&gt;</span>Style样式绑定1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十七【Vue组件的注册方式】</title>
    <url>/cnblogs.github.io/p/5eff.html</url>
    <content><![CDATA[<p><strong>组件的注册方式</strong><br>一个Vue组件在使用前需要先被“注册”，这样Vue才能在渲染模板时找到其对应的实现。组件注册有两种方式：全局注册和局部注册<br><strong>全局注册</strong></p>
<ul>
<li>main.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span><span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span><span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Globalcomponent</span> <span class="keyword">from</span> <span class="string">&quot;./components/Globalcomponent.vue&quot;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&quot;GlobalComponent&quot;</span>,<span class="title class_">GlobalComponent</span>)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>xx.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>全局应用组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>局部注册</strong><br>全局注册虽然很方便，但有以下几个问题：</p>
<ul>
<li>全局注册，但并没有被使用的组件无法在生产打包时被自动移除（也叫”tree-shaking”)。如果你全局注册了一个组件，即使它并没有被实际使用，它仍然会出现在打包后的JS文件中</li>
<li>全局注册在大型项目中使项目的依赖关系变得不那么明确。在父组件中使用子组件时，不太容易定位子组件的实现。和使用过多的全局变量一样，这可能会影响应用长期的可维护性</li>
</ul>
<p>局部注册需要使用components选项</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十三【Vue表单输入绑定】</title>
    <url>/cnblogs.github.io/p/97de.html</url>
    <content><![CDATA[<p><strong>表单输入绑定</strong><br>在前端处理表单时，我们常常需要将表单输入框的内容同步给JavaScript 中相应的变量。手动连接值绑定和更改事件监听器可能会很麻烦,v-mode 指令帮我们简化了这一步骤</p>
<h3 id="文本框"><a href="#文本框" class="headerlink" title="文本框"></a>文本框</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单输入绑定<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="复选框"><a href="#复选框" class="headerlink" title="复选框"></a>复选框</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">checked</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单输入绑定<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;agree&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;checked&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;agree&quot;</span>&gt;</span>&#123;&#123; checked &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><p>v-model也提供了修饰符: .lazy、.number 、.trim默认情况下， v-mode! 会在每次 input 事件后更新数据。你可以添加.lazy 修饰符来改为在每次 change 事件后更新数据</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>表单输入绑定<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model.lazy</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>输入的时候并不能时时显示，失去焦点的时候才会显示</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十九【Vue组件传递Props效验】</title>
    <url>/cnblogs.github.io/p/6e4c.html</url>
    <content><![CDATA[<p><strong>组件传递Props效验</strong><br>Vue组件可以更细致地声明对传入的props的校验要求<br>ComponentA.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ComponentB</span> <span class="keyword">from</span> <span class="string">&#x27;./ComponentB.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">ComponentB</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&#x27;标题&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentA <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ComponentB</span> <span class="attr">:title</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ComponentB.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 效验类型，可以为很多类型</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:[<span class="title class_">String</span>,<span class="title class_">Number</span>]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentB<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>默认值</strong><br>假设ComponentA.vue没有传入age的值：<br>ComponentB.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:[<span class="title class_">String</span>,<span class="title class_">Number</span>],</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">age</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:<span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">default</span>:<span class="number">18</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 数字和字符串可以直接default，但是如果是数组和对象，必须通过工厂函数返回默认值</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">names</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:<span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">default</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> [<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>ComponentB<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in names&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十二【Vue侦听器】</title>
    <url>/cnblogs.github.io/p/ce9f.html</url>
    <content><![CDATA[<p><strong>侦听器</strong><br>我们可以使用watch选项在每次响应式属性发生变化时触发一个函数</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span>&#123;<span class="attr">msg</span>:<span class="string">&#x27;Hello&#x27;</span>&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">changeMsg</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">msg</span>=<span class="string">&#x27;World&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">watch</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * 监听消息变化的函数</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * 当消息发生变化时，此函数会被调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * 函数名必须与要监听的属性名相同</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     */</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">msg</span>(<span class="params">newMsg, oldMsg</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 输出新旧消息值，以便在控制台中观察变化</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newMsg, oldMsg)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>侦听器<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeMsg&quot;</span>&gt;</span>修改数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十五【Vue组件组成】</title>
    <url>/cnblogs.github.io/p/c056.html</url>
    <content><![CDATA[<p><strong>组件组成</strong><br>组件最大的优势就是可复用性<br>当使用构建步骤时，我们一般会将Vue组件定义在一个单独的vue文件中，这被叫做单文件组件(简称SFC)</p>
<h3 id="（1）组件组成结构"><a href="#（1）组件组成结构" class="headerlink" title="（1）组件组成结构"></a>（1）组件组成结构</h3><p>MyComponent.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span>组件基础组成<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 第一步：引入组件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./components/MyComponent.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 第二步：注入组件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">MyComponent</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第三步：显示组件 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-scoped"><a href="#2-scoped" class="headerlink" title="(2)scoped"></a>(2)scoped</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- scoped:让当前样式只在当前组件中生效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十八【Vue组件传递数据_Props】</title>
    <url>/cnblogs.github.io/p/56d4.html</url>
    <content><![CDATA[<p><strong>组件传递数据_Props</strong><br>组件与组件之间不是完全独立的，而是有交集的，那就是组件与组件之间是可以传递数据的，传递数据的解决方案就是props</p>
<p>我们新增2个vue文件Parent.vue和Child.vue，把Child绑定到Parent里，传递方法如下：</p>
<ul>
<li>Parent.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&#x27;./Child.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Child</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Parent<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child</span> <span class="attr">title</span>=<span class="string">&quot;Parent数据&quot;</span> <span class="attr">demo</span>=<span class="string">&quot;测试&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Child.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;            </span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>:[<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;demo&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Child<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; demo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>动态传递数据</p>
<ul>
<li>Parent.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Child</span> <span class="keyword">from</span> <span class="string">&#x27;./Child.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">message</span>: <span class="string">&#x27;Parent数据&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Child</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Parent<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child</span> <span class="attr">:title</span>=<span class="string">&quot;message&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意事项：</strong><br>props传递数据：只能从父级传递到子级，不能反其道而行</p>
<p><strong>组件传递多种数据类型</strong><br>通过props传递数据，不仅可以传递字符串类型的数据，还可以是其他类型，例如：数字、对象、数组等。但实际上任何类型的值都可以作为props的值被传递</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十六【Vue组件嵌套关系】</title>
    <url>/cnblogs.github.io/p/8311.html</url>
    <content><![CDATA[<p><strong>组件嵌套关系</strong><br>组件允许我们将 UI划分为独立的、可重用的部分，并且可以对每个部分进行单独的思考。在实际应用中，组件常常被组织成层层嵌套的树状结构。这和我们嵌套 HTML 元素的方式类似，Vue 实现了自己的组件模型，使我们可以在每个组件内封装自定义内容与逻辑。</p>
<h3 id="（1）创建组件及引用关系"><a href="#（1）创建组件及引用关系" class="headerlink" title="（1）创建组件及引用关系"></a>（1）创建组件及引用关系</h3><p>创建新项目后，我们删掉src&#x2F;components下的所有文件。并且删除App.vue里的内容。方便我们干净的创建组件和引用关系。<br>我们在src文件夹下创建个pages文件夹。并创建以下文件：</p>
<ul>
<li>Header.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* 需要删掉自带的 main.js里的import &#x27;./assets/main.css&#x27; */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h3</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>:<span class="number">5px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>App.vue里引入Header</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&quot;./pages/Header.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Header</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们继续写其他的：（记得在App.vue里自行引入）</p>
<ul>
<li>Main.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">   </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.main</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">70%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Aside.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;aside&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Aside<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.aside</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">30%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Articke</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Article<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h3</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">80%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>引用要注意：</strong><br>最上面我们可以看到，Articke是在Main里的，所以我们要在Main里引用这个组件，而不是App.vue</p>
<ul>
<li>Main.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Articke</span> <span class="keyword">from</span> <span class="string">&#x27;./Articke.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">   <span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">       <span class="title class_">Articke</span></span></span><br><span class="line"><span class="language-javascript">   &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 因为是2个，所以我们显示2个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Articke</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Articke</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">....</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们接着写下个组件Item，同样在Aside里要引用三个</p>
<ul>
<li>Item.vue</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Item<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">h3</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">80%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background</span>: <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结十四【Vue模板引用】</title>
    <url>/cnblogs.github.io/p/725b.html</url>
    <content><![CDATA[<p><strong>模板引用</strong><br>虽然 Vue 的声明性渲染模型为你抽象了大部分对 DOM 的直接操作，但在某些情况下，我们仍然需要直接访问底层 DOM 元素。要实现这一点，我们可以使用特殊的 ref attribute挂载结束后引用都会被暴露在 this.$refs之上</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">* 内容改变：&#123;&#123; 模板语法 &#125;&#125;</span></span><br><span class="line"><span class="comment">* 属性改变：v-bind:指令</span></span><br><span class="line"><span class="comment">* 事件：v-on:click</span></span><br><span class="line"><span class="comment">* 如果没有特别的需求，不要操作DOM</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">content</span>: <span class="string">&#x27;内容&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">getElementHandle</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//innerHTML：原生的JS属性</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">container</span>.<span class="property">innerHTML</span>=<span class="string">&#x27;哈哈哈&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">username</span>.<span class="property">value</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span>&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getElementHandle&quot;</span>&gt;</span>获取元素<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3总结四【Vue模板语法-条件渲染】</title>
    <url>/cnblogs.github.io/p/b674.html</url>
    <content><![CDATA[<p><strong>v-if</strong><br>v-if指令用于条件性地渲染一块内容。这块内容只会在指令的表达式返回真值时才被渲染</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">flag</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>条件渲染<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>你能看到我吗？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>v-else</strong><br>你也可以使用 v-else 为 v-if 添加一个else 区块</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">flag</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>条件渲染<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>你能看到我吗？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>那你还是看看我吧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>v-else-if</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>: <span class="string">&#x27;D&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;type===&#x27;A&#x27;&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type===&#x27;B&#x27;&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;type===&#x27;C&#x27;&quot;</span>&gt;</span>C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>Not A/B/C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>v-show</strong><br>另一个可以用来按条件显示一个元素的指令是 v-show。其用法基本一样</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">flag</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>条件渲染<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>你能看到我吗？<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3核心API【watch】</title>
    <url>/cnblogs.github.io/p/7636.html</url>
    <content><![CDATA[<p>在 Vue3 的响应式系统中，watch 是监听数据变化的核心 API 之一。随着 Composition API 的普及，开发者需要更清晰地理解副作用管理机制。</p>
<h2 id="一、Vue3-的-watch-机制"><a href="#一、Vue3-的-watch-机制" class="headerlink" title="一、Vue3 的 watch 机制"></a>一、Vue3 的 watch 机制</h2><h3 id="1-1-基本用法"><a href="#1-1-基本用法" class="headerlink" title="1.1 基本用法"></a>1.1 基本用法</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基本监听模式</span></span><br><span class="line"><span class="keyword">const</span> stopWatch = <span class="title function_">watch</span>(count, <span class="function">(<span class="params">newVal, oldVal</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`值从 <span class="subst">$&#123;oldVal&#125;</span> 变为 <span class="subst">$&#123;newVal&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止监听</span></span><br><span class="line"><span class="comment">// stopWatch() // 手动调用停止监听</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-自动停止机制"><a href="#1-2-自动停止机制" class="headerlink" title="1.2 自动停止机制"></a>1.2 自动停止机制</h3><p>当在组件 setup() 中同步创建时，Vue3 会自动关联生命周期：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 自动绑定组件生命周期</span></span><br><span class="line">    <span class="title function_">watch</span>(count, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Count changed:&#x27;</span>, val)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; count &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件卸载时，Vue 会自动停止这些监听器，无需手动干预。</p>
<h2 id="二、必须手动清除的-3-种场景"><a href="#二、必须手动清除的-3-种场景" class="headerlink" title="二、必须手动清除的 3 种场景"></a>二、必须手动清除的 3 种场景</h2><h3 id="2-1-异步创建的监听器"><a href="#2-1-异步创建的监听器" class="headerlink" title="2.1 异步创建的监听器"></a>2.1 异步创建的监听器</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onMounted, onUnmounted &#125; <span class="keyword">from</span><span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line">exportdefault &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> stopWatch = <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 异步创建监听器</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        stopWatch = <span class="title function_">watch</span>(<span class="comment">/* ... */</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (stopWatch) &#123;</span><br><span class="line">        <span class="title function_">stopWatch</span>() <span class="comment">// 必须手动清除</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关键点：Vue 无法追踪异步创建的监听器，需要开发者自行管理</p>
<h3 id="2-2-动态条件监听"><a href="#2-2-动态条件监听" class="headerlink" title="2.2 动态条件监听"></a>2.2 动态条件监听</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchKeyword = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> searchWatch = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据用户操作动态创建</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">enableSearch</span>(<span class="params"></span>) &#123;</span><br><span class="line">  searchWatch = <span class="title function_">watch</span>(searchKeyword, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行搜索逻辑</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disableSearch</span>(<span class="params"></span>) &#123;</span><br><span class="line">  searchWatch?.() <span class="comment">// 主动销毁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>典型场景：需要运行时动态启用的监听逻辑。</p>
<h3 id="2-3-全局状态监听"><a href="#2-3-全局状态监听" class="headerlink" title="2.3 全局状态监听"></a>2.3 全局状态监听</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; watch &#125; <span class="keyword">from</span><span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span><span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局监听（危险操作！）</span></span><br><span class="line"><span class="keyword">let</span> globalWatcher = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span><span class="keyword">function</span> <span class="title function_">initGlobalWatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">  globalWatcher = <span class="title function_">watch</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> store.<span class="property">state</span>.<span class="property">user</span>,</span><br><span class="line">    <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;User changed:&#x27;</span>, user)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span><span class="keyword">function</span> <span class="title function_">cleanupGlobalWatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">  globalWatcher?.()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>风险提示：全局监听器不会自动销毁，必须提供显式清理接口。</p>
<h2 id="三、智能管理方案"><a href="#三、智能管理方案" class="headerlink" title="三、智能管理方案"></a>三、智能管理方案</h2><h3 id="3-1-自动管理组合式函数"><a href="#3-1-自动管理组合式函数" class="headerlink" title="3.1 自动管理组合式函数"></a>3.1 自动管理组合式函数</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; watchEffect, onScopeDispose &#125; <span class="keyword">from</span><span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span><span class="keyword">function</span> <span class="title function_">useAutoCleanWatcher</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 副作用逻辑</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动注册清理</span></span><br><span class="line">  <span class="title function_">onScopeDispose</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">stop</span>()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123; stop &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优势：利用 onScopeDispose 实现自动清理。</p>
<h3 id="3-2-监听器工厂模式"><a href="#3-2-监听器工厂模式" class="headerlink" title="3.2 监听器工厂模式"></a>3.2 监听器工厂模式</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createSmartWatcher</span>(<span class="params">source, callback</span>) &#123;</span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watch</span>(source, callback)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    stop,</span><br><span class="line">    <span class="attr">restart</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">stop</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createSmartWatcher</span>(source, callback)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">createSmartWatcher</span>(value, <span class="function">() =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>扩展性：封装重启功能，增强可维护性。</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue3组件库总结一【Vue-Office】</title>
    <url>/cnblogs.github.io/p/2efc.html</url>
    <content><![CDATA[<p><strong>vue-office简介</strong><br>vue-office是一个支持多种文件(docx、.xlsx、pdf)预览的vue组件库，支持vue2和vue3。 目标是成为使用最简单，功能最强大的文件预览库。</p>
<p><strong>功能特点</strong><br>一站式提供docx、.xlsx、pdf多种文档的在线预览方案，有它就够了，不用再四处寻找、测试、集成各种库了。使用简单只需提供文档的src(网络地址)即可完成文档预览，也支持ArrayBuffer、Blob等多种格式。支持样式不仅能预览内容，也支持文档样式，最大限度还原office文件内容 只需提供文档的src(网络地址)即可完成文档预览，也支持ArrayBuffer、Blob等多种格式&#96;</p>
<p><strong>安装步骤</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docx文档预览组件</span></span><br><span class="line">npm install @vue-office/docx vue-demi</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">excel文档预览组件</span></span><br><span class="line">npm install @vue-office/excel vue-demi</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pdf文档预览组件</span></span><br><span class="line">npm install @vue-office/pdf vue-demi</span><br></pre></td></tr></table></figure>
<p>如果是vue2.6版本或以下还需要额外安装 @vue&#x2F;composition-api</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install @vue/composition-api</span><br></pre></td></tr></table></figure>
<p><strong>案例</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vue-office-docx</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;currentAttachment.type === &#x27;docx&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:src</span>=<span class="string">&quot;docx&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">rendered</span>=<span class="string">&quot;renderedHandler&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">error</span>=<span class="string">&quot;errorHandler&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">v-if</span>=<span class="string">&quot;currentAttachment.type === &#x27;pdf&#x27;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;height:100%;&quot;</span> <span class="attr">:src</span>=<span class="string">pdf</span>&quot; <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vue-office-excel</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:src</span>=<span class="string">&quot;excel&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;currentAttachment.type === &#x27;xls&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">rendered</span>=<span class="string">&quot;renderedHandler&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">error</span>=<span class="string">&quot;errorHandler&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//引入VueOfficeDocx组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> <span class="title class_">VueOfficeDocx</span> <span class="keyword">from</span> <span class="string">&#x27;@vue-office/docx&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> <span class="title class_">VueOfficeExcel</span> <span class="keyword">from</span> <span class="string">&#x27;@vue-office/excel&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//引入相关样式</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> <span class="string">&#x27;@vue-office/docx/lib/index.css&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> <span class="string">&#x27;@vue-office/excel/lib/index.css&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">VueOfficeDocx</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">VueOfficeExcel</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">docx</span>: <span class="string">&#x27;http://xxx.com/test6.docx&#x27;</span>, <span class="comment">//设置文档网络地址，可以是相对地址</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">excel</span>: <span class="string">&#x27;http://xxx.com/test3.xls&#x27;</span>, <span class="comment">//设置文档网络地址，可以是相对地址</span></span></span><br><span class="line"><span class="language-javascript">                <span class="attr">pdf</span>: <span class="string">&#x27;http://xxx.com/test1.pdf&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">renderedHandler</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;渲染完成&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">errorHandler</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;渲染失败&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我这里没有用pdf组件，这个vue-office组件好处就是可以单独引用，pdf预览我这边用的iframe这就满足需求了。</p>
<p><strong>注意</strong><br>word 只支持docx后缀文件</p>
]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes安装软件一【Jenkins】</title>
    <url>/cnblogs.github.io/p/1590.html</url>
    <content><![CDATA[<p><strong>k8s 部署 Jenkins</strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins-crb</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins-master</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">devops:</span> <span class="string">jenkins-master</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">devops:</span> <span class="string">jenkins-master</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">jenkins</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fix-permissions</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;chown -R 1000:1000 /var/jenkins_home&quot;</span>]</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jenkinshome</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/jenkins_home</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">jenkinsci/blueocean:latest</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span> <span class="comment">#Jenkins Master Web 服务端口</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">slavelistener</span> <span class="comment">#Jenkins Master 供未来 Slave 连接的端口</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">50000</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jenkinshome</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/jenkins_home</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jenkinshome</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/usr1/jenkins</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">slavelistener</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">50000</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">50000</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">devops:</span> <span class="string">jenkins-master</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins-web</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">Kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www.jenkins.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">jenkins</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<p>简单描述一下：</p>
<ul>
<li>创建命名空间，并增加账户管理</li>
<li>通过 StatefulSet 创建 Jenkins 服务容器，绑定了持久化存储卷</li>
<li>创建 Service 和 Ingress，通过 Ingress 向外提供服务，Service 内的 NodePort 定义可以去掉</li>
</ul>
<p>安装完成后，如果配置了 Ingress，我们在当前机器上配置好 hosts，就可以通过 <a href="http://www.jenkins.com/">www.jenkins.com</a> 去访问了；如果没有配置 Ingress，可以通过节点和端口去访问，执行以下命令查询 NodePort 端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get service -n jenkins</span><br></pre></td></tr></table></figure>
<p>然后通过以下命令查询管理员密码：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pod -n jenkins</span><br><span class="line">kubectl exec jenkins-master-0 -n jenkins -- cat /var/jenkins_home/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes安装软件二【sonarqube】</title>
    <url>/cnblogs.github.io/p/40597.html</url>
    <content><![CDATA[<p><strong>kubernetes 搭建 sonarqube 扫描环境</strong></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sonarqube</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sonarqube</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sonarqube</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">9000</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sonarqube</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sonarqube</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">sonarqube</span></span><br><span class="line"><span class="attr">spce:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">sonarqube</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">sonarqube</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">sonar:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch-logging-init</span></span><br><span class="line">        <span class="attr">image: alpine:</span> <span class="number">3.6</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/sbin/sysctl</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">-w</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">vm.max_map_count=262144</span></span><br><span class="line">        <span class="attr">resources:</span> &#123;&#125;</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sonarqube</span></span><br><span class="line">        <span class="attr">image: sonarqube:</span> <span class="number">7.9</span><span class="number">.5</span><span class="string">-community</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9000</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SONARQUBE_JDBC_USERNAME</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">root</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SONARQUBE_JDBC_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">123456</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SONARQUBE_JDBC_URL</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;jdbc: mysql://ip:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/sessions/new</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/sessions/new</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">2000m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">4096Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">300m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">512Mi</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sonarqube-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/opt/sonarqube/data</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sonarqube-logs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/opt/sonarqube/logs</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sonarqube</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www.sonar.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">sonarqube</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes总结一【常用命令】</title>
    <url>/cnblogs.github.io/p/13065.html</url>
    <content><![CDATA[<h4 id="集群信息"><a href="#集群信息" class="headerlink" title="集群信息"></a>集群信息</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl cluster-info                  # 显示集群信息</span><br><span class="line">kubectl version                       # 显示客户端和服务器版本</span><br><span class="line">kubectl get nodes                     # 查看所有节点状态</span><br><span class="line">kubectl describe node &lt;node-name&gt;     # 查看节点详细信息</span><br></pre></td></tr></table></figure>
<h4 id="资源操作"><a href="#资源操作" class="headerlink" title="资源操作"></a>资源操作</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get &lt;resource&gt;                # 查看资源(pods, services, deployments等)</span><br><span class="line">kubectl describe &lt;resource&gt; &lt;name&gt;    # 查看资源详细信息</span><br><span class="line">kubectl create -f &lt;file.yaml&gt;         # 通过YAML文件创建资源</span><br><span class="line">kubectl apply -f &lt;file.yaml&gt;          # 应用YAML文件配置</span><br><span class="line">kubectl delete -f &lt;file.yaml&gt;         # 删除YAML文件中定义的资源</span><br><span class="line">kubectl delete &lt;resource&gt; &lt;name&gt;      # 删除指定资源</span><br></pre></td></tr></table></figure>
<h4 id="Pod相关"><a href="#Pod相关" class="headerlink" title="Pod相关"></a>Pod相关</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get pods                                        # 查看所有pod</span><br><span class="line">kubectl get pods -o wide                                # 查看pod及所在节点</span><br><span class="line">kubectl describe pod &lt;pod-name&gt;                         # 查看pod详细信息</span><br><span class="line">kubectl logs &lt;pod-name&gt;                                 # 查看pod日志</span><br><span class="line">kubectl logs -f &lt;pod-name&gt;                              # 实时查看pod日志</span><br><span class="line">kubectl exec -it &lt;pod-name&gt; -- /bin/bash                # 进入pod的shell</span><br><span class="line">kubectl port-forward &lt;pod-name&gt; &lt;local-port&gt;:&lt;pod-port&gt;  # 端口转发</span><br></pre></td></tr></table></figure>
<h4 id="Deployment相关"><a href="#Deployment相关" class="headerlink" title="Deployment相关"></a>Deployment相关</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get deployments                                     # 查看所有deployment</span><br><span class="line">kubectl describe deployment &lt;deploy-name&gt;                   # 查看deployment详情</span><br><span class="line">kubectl scale deployment &lt;deploy-name&gt; --replicas=&lt;number&gt;  # 扩缩容</span><br><span class="line">kubectl rollout status deployment &lt;deploy-name&gt;             # 查看滚动更新状态</span><br><span class="line">kubectl rollout history deployment &lt;deploy-name&gt;            # 查看部署历史</span><br><span class="line">kubectl rollout undo deployment &lt;deploy-name&gt;               # 回滚到上一版本</span><br></pre></td></tr></table></figure>
<h4 id="Service相关"><a href="#Service相关" class="headerlink" title="Service相关"></a>Service相关</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get services                                                                # 查看所有service</span><br><span class="line">kubectl describe service &lt;svc-name&gt;                                                 # 查看service详情</span><br><span class="line">kubectl expose deployment &lt;deploy-name&gt; --port=&lt;port&gt; --target-port=&lt;target-port&gt;   # 创建service</span><br></pre></td></tr></table></figure>
<h4 id="命名空间操作"><a href="#命名空间操作" class="headerlink" title="命名空间操作"></a>命名空间操作</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get namespaces                                      # 查看所有命名空间</span><br><span class="line">kubectl create namespace &lt;ns-name&gt;                          # 创建命名空间</span><br><span class="line">kubectl config set-context --current --namespace=&lt;ns-name&gt;  # 设置默认命名空间</span><br></pre></td></tr></table></figure>
<h4 id="调试命令"><a href="#调试命令" class="headerlink" title="调试命令"></a>调试命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl top nodes                                           # 查看节点资源使用情况</span><br><span class="line">kubectl top pods                                            # 查看pod资源使用情况</span><br><span class="line">kubectl get events                                          # 查看集群事件</span><br><span class="line">kubectl get events --sort-by=&#x27;.metadata.creationTimestamp&#x27;  # 按时间排序查看事件</span><br></pre></td></tr></table></figure>
<h4 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get configmaps                # 查看configmap</span><br><span class="line">kubectl get secrets                   # 查看secret</span><br><span class="line">kubectl edit &lt;resource&gt; &lt;name&gt;        # 编辑资源</span><br></pre></td></tr></table></figure>
<h4 id="其他实用命令"><a href="#其他实用命令" class="headerlink" title="其他实用命令"></a>其他实用命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl api-resources                       # 查看所有API资源类型</span><br><span class="line">kubectl explain &lt;resource&gt;                  # 查看资源定义说明</span><br><span class="line">kubectl cp &lt;pod-name&gt;:&lt;path&gt; &lt;local-path&gt;   # 从pod复制文件到本地</span><br><span class="line">kubectl auth can-i &lt;verb&gt; &lt;resource&gt;        # 检查权限</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes总结二【部署Java应用】</title>
    <url>/cnblogs.github.io/p/44053.html</url>
    <content><![CDATA[<h4 id="第一步：准备阶段"><a href="#第一步：准备阶段" class="headerlink" title="第一步：准备阶段"></a>第一步：准备阶段</h4><p>在开始之前，你需要确保自己的工作环境已经配置好了必要的工具。包括但不限于 Docker（用来打包 Java 应用）、kubectl（Kubernetes 的命令行工具）以及 Helm（一种方便快捷的 K8s 包管理工具）。如果你还不熟悉这些工具的话，别担心，我会尽量用最简单的语言给你解释清楚。假设你已经有了一个简单的 Spring Boot 应用程序。首先要做的是将其容器化。也就是说，我们需要创建一个 Dockerfile 文件来定义这个应用是如何被封装成镜像的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 使用官方 OpenJDK 镜像作为基础</span><br><span class="line">FROM openjdk:17-jdk-slim</span><br><span class="line"></span><br><span class="line"># 设置工作目录</span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"># 复制构建好的 JAR 包到镜像内</span><br><span class="line">COPY target/my-awesome-java-app.jar app.jar</span><br><span class="line"></span><br><span class="line"># 暴露端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># 定义启动命令</span><br><span class="line">CMD [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]</span><br></pre></td></tr></table></figure>
<p>在这个 Dockerfile 中，我们指定了基础镜像、工作目录、复制文件、暴露端口，并设置了容器启动时执行的命令。完成之后，你可以通过执行 docker build -t my-java-app . 来构建镜像。然后使用 docker run 命令验证一下是否能正常运行。</p>
<h4 id="第二步：编写-Deployment-配置文件"><a href="#第二步：编写-Deployment-配置文件" class="headerlink" title="第二步：编写 Deployment 配置文件"></a>第二步：编写 Deployment 配置文件</h4><p>当我们的应用成功被打包成 Docker 镜像后，下一步就是告诉 K8s 如何运行这个应用。这里需要用到 YAML 或 JSON 格式的配置文件。我们先来看一个典型的 Deployment 配置示例：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-java-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-java-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-java-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-java-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-java-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<p>这段配置文件告诉 K8s 我们希望运行三个副本（replicas）的 Java 应用实例，并且这些实例会监听 8080 端口。selector 字段用于匹配 Pod 的标签，而 template 部分则描述了每个 Pod 的具体设置。</p>
<h4 id="第三步：应用配置并检查状态"><a href="#第三步：应用配置并检查状态" class="headerlink" title="第三步：应用配置并检查状态"></a>第三步：应用配置并检查状态</h4><p>现在，有了完整的配置文件后，就可以通过 kubectl apply 命令将其应用到集群中了：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl apply -f deployment.yaml</span><br></pre></td></tr></table></figure>
<p>接着，我们可以用以下命令来查看 Deployment 和相关的 Pods 是否正确创建：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl get deployments</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>
<p>如果你看到类似 my-java-deployment-xxx 的 Pods 名称出现，并且它们的状态都是 Running，那么恭喜你，你的 Java 应用已经在 K8s 上顺利部署啦！</p>
<h4 id="第四步：服务暴露与外部访问"><a href="#第四步：服务暴露与外部访问" class="headerlink" title="第四步：服务暴露与外部访问"></a>第四步：服务暴露与外部访问</h4><p>为了让外界能够访问我们的 Java 应用，还需要创建一个 Service 来暴露应用的服务。这里以 LoadBalancer 类型为例：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-java-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-java-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<p>上述配置会创建一个外部可访问的服务，将请求转发给后端的 Java 应用实例。完成后再次应用配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl apply -f service.yaml</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes配置详解一【四类Service类型讲解】</title>
    <url>/cnblogs.github.io/p/8882.html</url>
    <content><![CDATA[<p><strong>Service 的四种类型详解</strong></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>是否集群内可用</th>
<th>是否集群外可访问</th>
<th>负载均衡</th>
<th>应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>ClusterIP（默认）</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>集群内服务通信</td>
</tr>
<tr>
<td>NodePort</td>
<td>是</td>
<td>是（节点IP+端口）</td>
<td>是</td>
<td>集群外简单访问</td>
</tr>
<tr>
<td>LoadBalancer</td>
<td>是</td>
<td>是（分配公网 IP）</td>
<td>是</td>
<td>云服务部署，自动负载均衡</td>
</tr>
<tr>
<td>Headless（无 Cluster IP）</td>
<td>是</td>
<td>否</td>
<td>否</td>
<td>DNS 直连后端 Pod，服务发现灵活</td>
</tr>
</tbody></table>
<h3 id="ClusterIP：集群内默认通信方式"><a href="#ClusterIP：集群内默认通信方式" class="headerlink" title="ClusterIP：集群内默认通信方式"></a>ClusterIP：集群内默认通信方式</h3><p>这是最常用的 Service 类型，也是默认值。它会分配一个 虚拟 IP 和 DNS 名称，用于集群内部通信（比如后端服务之间调用）。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">backend</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">backend</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<ul>
<li>kubectl get svc 可以查看该服务的 ClusterIP。</li>
<li>内部通信可直接使用 DNS 名称 backend.default.svc.cluster.local。</li>
</ul>
<p>✅ 使用场景：服务之间的调用，如 Web -&gt; API -&gt; DB，全部在集群内部。</p>
<h3 id="NodePort：暴露服务到集群外部"><a href="#NodePort：暴露服务到集群外部" class="headerlink" title="NodePort：暴露服务到集群外部"></a>NodePort：暴露服务到集群外部</h3><p>当你希望集群外部访问服务时，可以使用 NodePort 类型。Kubernetes 会在每个节点上分配一个端口（默认范围：30000~32767），将请求转发到对应 Service。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nodeport-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30080</span></span><br></pre></td></tr></table></figure>
<p>外部访问方式为：&lt;任意NodeIP&gt;:30080<br>⚠️ 警告：不适合大规模对外服务，缺乏公网 IP 与负载均衡能力。</p>
<h3 id="LoadBalancer：自动申请云负载均衡器"><a href="#LoadBalancer：自动申请云负载均衡器" class="headerlink" title="LoadBalancer：自动申请云负载均衡器"></a>LoadBalancer：自动申请云负载均衡器</h3><p>当你的集群部署在云平台（如 AWS、GCP、阿里云）时，选择 LoadBalancer 类型，Kubernetes 会自动向云服务商申请一个公网 IP，并绑定到负载均衡器。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">lb-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<p>外部访问方式为：公网 IP:端口</p>
<h3 id="Headless-Service：服务发现更灵活"><a href="#Headless-Service：服务发现更灵活" class="headerlink" title="Headless Service：服务发现更灵活"></a>Headless Service：服务发现更灵活</h3><p>Headless Service 是一种特殊类型，没有 ClusterIP，也不做负载均衡，主要用于将 DNS 直接解析为后端 Pod IP，适合状态服务（如数据库、分布式缓存）。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">headless-db</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure>
<p>DNS 查询会返回所有匹配 Pod 的 IP（类似 A 记录数组），而不是虚拟 IP。</p>
<p>典型场景：</p>
<ul>
<li>StatefulSet + Headless Service，构建分布式服务（如 Kafka、Zookeeper）</li>
<li>DNS 控制下的服务发现机制更灵活</li>
</ul>
<p>✅ 总结：四种 Service 类型一句话记住</p>
<ul>
<li>ClusterIP：内部访问首选，默认选项。</li>
<li>NodePort：开发测试简易外部暴露方式。</li>
<li>LoadBalancer：云原生部署首选，自动负载均衡 + 公网 IP。</li>
<li>Headless：Pod 直连、分布式服务构建的基石</li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes配置详解三【Ingress讲解】</title>
    <url>/cnblogs.github.io/p/6068.html</url>
    <content><![CDATA[<h2 id="一、什么是-Ingress？"><a href="#一、什么是-Ingress？" class="headerlink" title="一、什么是 Ingress？"></a>一、什么是 Ingress？</h2><p>Ingress 是一种 Kubernetes API 对象，用于管理集群外部对服务（Service）的 HTTP 和 HTTPS 访问。与传统 NodePort、LoadBalancer 相比，Ingress 更像是一个七层的应用网关。它借助 Ingress Controller，实现对流量的灵活调度，例如：</p>
<ul>
<li>按域名路由（example.com vs api.example.com）</li>
<li>按路径路由（&#x2F;api vs &#x2F;admin）</li>
<li>TLS 终止</li>
<li>支持自定义头部、重定向、中间件等功能（需依赖具体 Controller）</li>
</ul>
<h2 id="二、Ingress-的架构与工作机制"><a href="#二、Ingress-的架构与工作机制" class="headerlink" title="二、Ingress 的架构与工作机制"></a>二、Ingress 的架构与工作机制</h2><p>Ingress 本身只是资源定义，并不具备处理请求的能力。真正转发流量的是 Ingress Controller，它通常是一个运行在集群中的 Pod，比如：</p>
<table>
<thead>
<tr>
<th>控制器</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>NGINX Ingress</td>
<td>最主流、社区支持广泛，适合绝大多数场景</td>
</tr>
<tr>
<td>Traefik</td>
<td>动态配置强、与微服务集成紧密，支持中间件功能</td>
</tr>
<tr>
<td>HAProxy Ingress</td>
<td>基于 HAProxy，性能出色</td>
</tr>
<tr>
<td>Istio Gateway</td>
<td>与服务网格场景结合，用于高级路由控制</td>
</tr>
</tbody></table>
<h2 id="三、Ingress-配置实战"><a href="#三、Ingress-配置实战" class="headerlink" title="三、Ingress 配置实战"></a>三、Ingress 配置实战</h2><h3 id="1-基本示例：基于路径的转发"><a href="#1-基本示例：基于路径的转发" class="headerlink" title="1. 基本示例：基于路径的转发"></a>1. 基本示例：基于路径的转发</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">demo-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/$2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">api-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/web(/|$)(.*)</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">web-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>说明：<br>    请求 example.com&#x2F;api&#x2F;user 将被转发到 api-service。使用 rewrite-target 重写路径，确保后端能正确解析。pathType 支持 Prefix、Exact、ImplementationSpecific</p>
<h3 id="2-添加-TLS-支持"><a href="#2-添加-TLS-支持" class="headerlink" title="2. 添加 TLS 支持"></a>2. 添加 TLS 支持</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">example.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">example-com-tls</span></span><br></pre></td></tr></table></figure>
<p>TLS 证书通常由 Cert-Manager 自动申请、续签，或手动创建 Secret：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create secret tls example-com-tls --cert=cert.pem --key=key.pem</span><br></pre></td></tr></table></figure>
<p>使用 HTTPS 能有效提升安全性，特别是在处理用户数据或提供 API 接口时。</p>
<h3 id="3-多域名支持"><a href="#3-多域名支持" class="headerlink" title="3. 多域名支持"></a>3. 多域名支持</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">app.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">app-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">blog.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">blog-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<p>这种方式适合将多个服务部署在同一集群中，按域名隔离访问入口。</p>
<h2 id="四、常用-Annotation-说明（以-NGINX-为例）"><a href="#四、常用-Annotation-说明（以-NGINX-为例）" class="headerlink" title="四、常用 Annotation 说明（以 NGINX 为例）"></a>四、常用 Annotation 说明（以 NGINX 为例）</h2><table>
<thead>
<tr>
<th>Annotation</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>rewrite-target</td>
<td>重写路径</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io&#x2F;ssl-redirect</td>
<td>是否强制 HTTPS</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io&#x2F;backend-protocol</td>
<td>后端协议 HTTP&#x2F;HTTPS</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io&#x2F;whitelist-source-range</td>
<td>限制来源 IP</td>
</tr>
<tr>
<td>nginx.ingress.kubernetes.io&#x2F;configuration-snippet</td>
<td>插入 NGINX 配置片段</td>
</tr>
<tr>
<td>例如，限制某服务只能由特定 IP 段访问：</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">nginx.ingress.kubernetes.io/whitelist-source-range:</span> <span class="string">&quot;192.168.0.0/24&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetes配置详解二【ConfigMap与Secret讲解】</title>
    <url>/cnblogs.github.io/p/6ae7.html</url>
    <content><![CDATA[<h3 id="ConfigMap：管理普通配置信息"><a href="#ConfigMap：管理普通配置信息" class="headerlink" title="ConfigMap：管理普通配置信息"></a>ConfigMap：管理普通配置信息</h3><p>ConfigMap 用于存储非敏感的配置信息，如：</p>
<ul>
<li>应用的参数设置</li>
<li>环境变量配置</li>
<li>配置文件内容</li>
</ul>
<h3 id="创建-ConfigMap-的三种方式："><a href="#创建-ConfigMap-的三种方式：" class="headerlink" title="创建 ConfigMap 的三种方式："></a>创建 ConfigMap 的三种方式：</h3><h4 id="1-从文件创建"><a href="#1-从文件创建" class="headerlink" title="1. 从文件创建"></a>1. 从文件创建</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create configmap app-config --from-file=./app.properties</span><br></pre></td></tr></table></figure>
<h4 id="2-从字面值创建"><a href="#2-从字面值创建" class="headerlink" title="2. 从字面值创建"></a>2. 从字面值创建</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create configmap app-config --from-literal=ENV=prod --from-literal=VERSION=1.2.3</span><br></pre></td></tr></table></figure>
<h4 id="3-使用-YAML-配置"><a href="#3-使用-YAML-配置" class="headerlink" title="3. 使用 YAML 配置"></a>3. 使用 YAML 配置</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">ENV:</span> <span class="string">&quot;prod&quot;</span></span><br><span class="line">  <span class="attr">VERSION:</span> <span class="string">&quot;1.2.3&quot;</span></span><br><span class="line">  <span class="attr">config.yaml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    port: 8080</span></span><br><span class="line"><span class="string">    logLevel: info</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-ConfigMap-的四种方式"><a href="#使用-ConfigMap-的四种方式" class="headerlink" title="使用 ConfigMap 的四种方式"></a>使用 ConfigMap 的四种方式</h3><h4 id="1-注入为环境变量"><a href="#1-注入为环境变量" class="headerlink" title="1. 注入为环境变量"></a>1. 注入为环境变量</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">envFrom:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span></span><br></pre></td></tr></table></figure>
<h4 id="2-注入为单个变量"><a href="#2-注入为单个变量" class="headerlink" title="2. 注入为单个变量"></a>2. 注入为单个变量</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_ENV</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">configMapKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">ENV</span></span><br></pre></td></tr></table></figure>
<h4 id="3-挂载为文件（适合配置文件）"><a href="#3-挂载为文件（适合配置文件）" class="headerlink" title="3. 挂载为文件（适合配置文件）"></a>3. 挂载为文件（适合配置文件）</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">app-config</span></span><br></pre></td></tr></table></figure>

<h3 id="Secret：管理敏感配置信息"><a href="#Secret：管理敏感配置信息" class="headerlink" title="Secret：管理敏感配置信息"></a>Secret：管理敏感配置信息</h3><p>Secret 用于存储敏感信息，如：</p>
<ul>
<li>数据库账号密码</li>
<li>JWT 签名密钥</li>
<li>TLS 证书与私钥</li>
</ul>
<h3 id="创建-Secret-的三种方式："><a href="#创建-Secret-的三种方式：" class="headerlink" title="创建 Secret 的三种方式："></a>创建 Secret 的三种方式：</h3><h4 id="1-从字面值（需-base64-编码）"><a href="#1-从字面值（需-base64-编码）" class="headerlink" title="1. 从字面值（需 base64 编码）"></a>1. 从字面值（需 base64 编码）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create secret generic db-secret --from-literal=username=admin --from-literal=password=123456</span><br></pre></td></tr></table></figure>
<h4 id="2-使用-YAML-编写（注意-base64-编码）"><a href="#2-使用-YAML-编写（注意-base64-编码）" class="headerlink" title="2. 使用 YAML 编写（注意 base64 编码）"></a>2. 使用 YAML 编写（注意 base64 编码）</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">db-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>      <span class="comment"># admin</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span>      <span class="comment"># 123456</span></span><br></pre></td></tr></table></figure>
<h4 id="3-TLS-类型-Secret（自动编码）"><a href="#3-TLS-类型-Secret（自动编码）" class="headerlink" title="3. TLS 类型 Secret（自动编码）"></a>3. TLS 类型 Secret（自动编码）</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kubectl create secret tls tls-secret --cert=./tls.crt --key=./tls.key</span><br></pre></td></tr></table></figure>

<h3 id="使用-Secret-的三种方式"><a href="#使用-Secret-的三种方式" class="headerlink" title="使用 Secret 的三种方式"></a>使用 Secret 的三种方式</h3><h4 id="1-注入为环境变量-1"><a href="#1-注入为环境变量-1" class="headerlink" title="1. 注入为环境变量"></a>1. 注入为环境变量</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USER</span></span><br><span class="line">    <span class="attr">valueFrom:</span></span><br><span class="line">      <span class="attr">secretKeyRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">db-secret</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">username</span></span><br></pre></td></tr></table></figure>
<h4 id="2-挂载为文件"><a href="#2-挂载为文件" class="headerlink" title="2. 挂载为文件"></a>2. 挂载为文件</h4><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">volumeMounts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">    <span class="attr">mountPath:</span> <span class="string">/etc/secret</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">db-secret</span></span><br></pre></td></tr></table></figure>

<p><strong>ConfigMap vs Secret 核心对比</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>ConfigMap</th>
<th>Secret</th>
</tr>
</thead>
<tbody><tr>
<td>存储类型</td>
<td>明文</td>
<td>base64 编码（并非加密）</td>
</tr>
<tr>
<td>用途</td>
<td>一般配置信息</td>
<td>敏感信息（密码、证书）</td>
</tr>
<tr>
<td>挂载方式</td>
<td>环境变量、文件</td>
<td>环境变量、文件</td>
</tr>
<tr>
<td>加密支持</td>
<td>❌ 默认无加密</td>
<td>✅ 可结合加密机制（如 KMS）</td>
</tr>
<tr>
<td>安全性</td>
<td>低</td>
<td>高（但仍建议配合 RBAC）</td>
</tr>
</tbody></table>
<h3 id="实战案例：配置数据库连接信息"><a href="#实战案例：配置数据库连接信息" class="headerlink" title="实战案例：配置数据库连接信息"></a>实战案例：配置数据库连接信息</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">db-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">my-app:v1</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USER</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">db-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">username</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASS</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">db-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></table></figure>

<h3 id="Secret-的安全最佳实践"><a href="#Secret-的安全最佳实践" class="headerlink" title="Secret 的安全最佳实践"></a>Secret 的安全最佳实践</h3><p>✅ 开启 Kubernetes API Server 的加密存储（EncryptionConfiguration）<br>✅ 使用 RBAC 限制访问 Secret 的权限<br>✅ 定期轮换密钥与 Secret<br>✅ 使用 External Secrets 工具（如 External Secrets Operator）接入云上密钥管理系统（AWS Secrets Manager、Vault 等）</p>
<p><strong>总结：ConfigMap 与 Secret 不是选一个，而是一起用！</strong><br>✅ 配置文件统一管理？用 ConfigMap<br>✅ 数据库密码传入？用 Secret<br>✅ 不想改代码就能换配置？挂载 + 环境变量是关键<br>✅ 想安全地管理密钥？配合 RBAC + 加密 + 密钥轮换</p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerfile指令详解案例一【条件表达式】</title>
    <url>/cnblogs.github.io/p/36645.html</url>
    <content><![CDATA[<h4 id="类似if-else"><a href="#类似if-else" class="headerlink" title="类似if-else"></a>类似if-else</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Use an Ubuntu base image</span><br><span class="line">FROM ubuntu:20.04</span><br><span class="line"></span><br><span class="line"># Avoid prompts with apt</span><br><span class="line">ENV DEBIAN_FRONTEND=noninteractive</span><br><span class="line"></span><br><span class="line"># Declare an argument for the web server</span><br><span class="line">ARG WEBSERVER</span><br><span class="line"></span><br><span class="line"># Use shell logic to determine which server to install</span><br><span class="line">RUN if [ &quot;$WEBSERVER&quot; = &quot;nginx&quot; ]; then \</span><br><span class="line">        apt-get update &amp;&amp; apt-get install -y nginx; \</span><br><span class="line">    elif [ &quot;$WEBSERVER&quot; = &quot;apache&quot; ]; then \</span><br><span class="line">        apt-get update &amp;&amp; apt-get install -y apache2; \</span><br><span class="line">    else \</span><br><span class="line">        echo &quot;No valid webserver specified&quot;; \</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line"># Rest of the Dockerfile... </span><br></pre></td></tr></table></figure>
<p>构建镜像并指定 web 服务器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build --build-arg WEBSERVER=nginx -t myimage:latest .</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker总结一【常用命令】</title>
    <url>/cnblogs.github.io/p/22669.html</url>
    <content><![CDATA[<h4 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h4><h5 id="镜像（Image）相关命令"><a href="#镜像（Image）相关命令" class="headerlink" title="镜像（Image）相关命令"></a>镜像（Image）相关命令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images                                                    # 查看本地所有镜像</span><br><span class="line">docker search &lt;镜像名&gt;                                            # 从 Docker Hub 搜索镜像（如 docker search nginx）</span><br><span class="line">docker pull &lt;镜像名:标签&gt;                                         #  拉取镜像（如 docker pull nginx:latest）</span><br><span class="line">docker rmi &lt;镜像ID或名称&gt;                                         # 删除本地镜像（-f 强制删除）</span><br><span class="line">docker build -t &lt;镜像名&gt; .                                        # 根据当前目录的 Dockerfile 构建镜像</span><br><span class="line">docker save -o &lt;文件名&gt;.tar &lt;镜像名&gt;                               # 将镜像保存为 .tar 文件（备份）</span><br><span class="line">docker load -i &lt;文件名&gt;.tar                                       # 从 .tar 文件加载镜像</span><br></pre></td></tr></table></figure>
<h5 id="容器（Container）相关命令"><a href="#容器（Container）相关命令" class="headerlink" title="容器（Container）相关命令"></a>容器（Container）相关命令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps                                                       # 查看运行中的容器</span><br><span class="line">docker ps -a                                                    # 查看所有容器（包括已停止的）</span><br><span class="line">docker run -d -p &lt;主机端口&gt;:&lt;容器端口&gt; --name &lt;容器名&gt; &lt;镜像名&gt;    # 启动容器（-d 后台运行，-p 端口映射）</span><br><span class="line">docker start/stop/restart &lt;容器名或ID&gt;                          # 启动/停止/重启容器</span><br><span class="line">docker rm &lt;容器名或ID&gt;                                          # 删除已停止的容器（-f 强制删除运行中的容器）</span><br><span class="line">docker exec -it &lt;容器名或ID&gt; /bin/bash                          # 进入运行中的容器（交互式终端）</span><br><span class="line">docker logs &lt;容器名或ID&gt;                                        # 查看容器日志（-f 实时跟踪）</span><br></pre></td></tr></table></figure>
<h5 id="网络（Network）相关命令"><a href="#网络（Network）相关命令" class="headerlink" title="网络（Network）相关命令"></a>网络（Network）相关命令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker network ls                                               # 查看所有网络</span><br><span class="line">docker network create &lt;网络名&gt;                                  # 创建自定义网络</span><br><span class="line">docker network inspect &lt;网络名&gt;                                 # 查看网络详情</span><br><span class="line">docker network connect &lt;网络名&gt; &lt;容器名&gt;                         # 将容器连接到指定网络</span><br></pre></td></tr></table></figure>
<h5 id="数据卷（Volume）相关命令"><a href="#数据卷（Volume）相关命令" class="headerlink" title="数据卷（Volume）相关命令"></a>数据卷（Volume）相关命令</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker volume ls                                                # 查看所有数据卷</span><br><span class="line">docker volume create &lt;卷名&gt;                                      # 创建数据卷</span><br><span class="line">docker volume inspect &lt;卷名&gt;                                     # 查看数据卷详情</span><br><span class="line">docker run -v &lt;主机路径&gt;:&lt;容器路径&gt; &lt;镜像名&gt;                       # 挂载主机目录到容器</span><br><span class="line">docker run -v &lt;卷名&gt;:&lt;容器路径&gt; &lt;镜像名&gt;                           # 使用数据卷挂载</span><br></pre></td></tr></table></figure>
<h5 id="清理与维护"><a href="#清理与维护" class="headerlink" title="清理与维护"></a>清理与维护</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker system df                                                # 查看 Docker 磁盘使用情况</span><br><span class="line">docker system prune                                             # 清理无用镜像、容器、网络（-a 包含未使用的镜像）</span><br><span class="line">docker container prune                                          # 删除所有已停止的容器</span><br><span class="line">docker image prune                                              # 删除未被使用的镜像</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker总结三【单机版安装】</title>
    <url>/cnblogs.github.io/p/30703.html</url>
    <content><![CDATA[<h2 id="单机版安装"><a href="#单机版安装" class="headerlink" title="单机版安装"></a>单机版安装</h2><h3 id="it-tools"><a href="#it-tools" class="headerlink" title="it-tools"></a>it-tools</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># it-tools</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># https://github.com/CorentinTh/it-tools</span></span></span><br><span class="line">sudo docker run -d --name it-tools --restart unless-stopped -p 8080:80 corentinth/it-tools:latest</span><br></pre></td></tr></table></figure>
<h3 id="sqlserver"><a href="#sqlserver" class="headerlink" title="sqlserver"></a>sqlserver</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># sqlserver镜像拉取</span></span></span><br><span class="line">sudo docker pull mcr.microsoft.com/mssql/server:2022-latest</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;MSSQL_SA_PASSWORD=&lt;Q1w2e3r4&gt;&quot; -p 1433:1433 --name sql_server -d mcr.microsoft.com/mssql/server:2022-latest</span><br></pre></td></tr></table></figure>
<h3 id="webgoat"><a href="#webgoat" class="headerlink" title="webgoat"></a>webgoat</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># webgoat镜像拉取</span></span></span><br><span class="line">sudo docker pull webgoat/webgoat-8.0</span><br><span class="line">sudo docker pull webgoat/webwolf</span><br><span class="line">sudo docker pull webgoat/goatandwolf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name webgoat -p 30007:8888 -p 30001:8080 -p 30008:9090 webgoat/goatandwolf</span><br></pre></td></tr></table></figure>
<h3 id="upload-lab"><a href="#upload-lab" class="headerlink" title="upload-lab"></a>upload-lab</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># upload-labs镜像拉取</span></span></span><br><span class="line">docker pull cuer/upload-labs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name upload-labs -p 30002:80 cuer/upload-labs</span><br></pre></td></tr></table></figure>
<h3 id="sqli-labs"><a href="#sqli-labs" class="headerlink" title="sqli-labs"></a>sqli-labs</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># sqli-labs镜像拉取</span></span></span><br><span class="line">docker pull acgpiano/sqli-labs</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name sqli-labs -p 30003:80 -p 13306:3306 acgpiano/sqli-labs</span><br></pre></td></tr></table></figure>
<h3 id="pikachu"><a href="#pikachu" class="headerlink" title="pikachu"></a>pikachu</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># pikachu镜像拉取</span></span></span><br><span class="line">docker pull area39/pikachu</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name pikachu -p 30004:80 area39/pikachu</span><br></pre></td></tr></table></figure>
<h3 id="dwa"><a href="#dwa" class="headerlink" title="dwa"></a>dwa</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># dvwa镜像拉取</span></span></span><br><span class="line">docker pull sagikazarmark/dvwa</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name dvwa -p 30005:80 sagikazarmark/dvwa</span><br></pre></td></tr></table></figure>
<h3 id="xss-challenge-tour"><a href="#xss-challenge-tour" class="headerlink" title="xss-challenge-tour"></a>xss-challenge-tour</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># xss-challenge-tour镜像拉取</span></span></span><br><span class="line">docker pull c0ny1/xss-challenge-tour </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动</span></span></span><br><span class="line">sudo docker run -dt --name xss -p 30006:80 c0ny1/xss-challenge-tour</span><br></pre></td></tr></table></figure>
<h3 id="Leanote"><a href="#Leanote" class="headerlink" title="Leanote"></a>Leanote</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo docker pull axboy/leanote</span><br><span class="line"></span><br><span class="line">sudo docker run -d -p 9800:9000 \</span><br><span class="line">    -e &quot;TZ=Asia/Shanghai&quot;\</span><br><span class="line">    -v /data/leanote/db:/data/db \</span><br><span class="line">    -v /data/leanote/conf/:/data/leanote/conf \</span><br><span class="line">    -v /data/leanote/files:/data/leanote/files \</span><br><span class="line">    -v /data/leanote/upload:/data/leanote/public/upload \</span><br><span class="line">    --name leanote \</span><br><span class="line">    axboy/leanote</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker总结二【部署与配置】</title>
    <url>/cnblogs.github.io/p/31878.html</url>
    <content><![CDATA[<h4 id="环境部署"><a href="#环境部署" class="headerlink" title="环境部署"></a>环境部署</h4><p>1、卸载旧版本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engin</span><br></pre></td></tr></table></figure>
<p>2、安装Docker依赖的安装包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum install -y libseccomp</span><br></pre></td></tr></table></figure>
<p>3、设置镜像仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum-config-manager --add-repo http://mirrors.tencent.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<p>4、更新yum索引</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum makecache fast 或者 yum makecache 或者 yum makecache --refresh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意事项</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># yum makecache 完整重建缓存，会下载并解析所有可用软件源的元数据。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># yum makecache fast  仅更新自上次缓存以来发生变化的元数据（增量更新），速度更快。在 CentOS 8/RHEL 8+ 中已被弃用，改用 yum makecache</span></span> </span><br></pre></td></tr></table></figure>
<p>5、安装docker相关容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io --allowe</span><br></pre></td></tr></table></figure>
<p>6、启动docker与开机启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># docker版本，查看是否安装上正常运行</span></span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>
<p>7、安装compose</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除失败的docker-compose</span></span></span><br><span class="line">sudo rm -f /usr/local/bin/docker-compose</span><br><span class="line">curl -L https://github.com/docker/compose/releases/download/2.21.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>8、授权</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证安装</span></span><br><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure>
<p>9、卸载docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum remove docker-ce docker-ce-cli containerd.io --allow</span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line">rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h4 id="修改镜像源"><a href="#修改镜像源" class="headerlink" title="修改镜像源"></a>修改镜像源</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	&quot;registry-mirrors&quot;: [</span><br><span class="line">		&quot;https://docker.13140521.xyz&quot;,</span><br><span class="line">		&quot;https://docker.1panel.live&quot;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 重启docker 服务</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux笔记</title>
    <url>/cnblogs.github.io/p/24884.html</url>
    <content><![CDATA[<h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2><h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发送邮件</span></span><br><span class="line">curl --url &#x27;smtp://smtp.example.com:587&#x27; --ssl-reqd --mail-from &#x27;sender@example.com&#x27; --mail-rcpt &#x27;recipient@example.com&#x27; --upload-file mail.txt --user &#x27;username:password&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h3><h4 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩单个文件,不保留 document.txt</span></span><br><span class="line">gzip document.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩文件</span></span><br><span class="line">gunzip document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看压缩文件内容</span></span><br><span class="line">zcat document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-1 至 -9：设置压缩级别</span></span><br><span class="line">gzip -9 document.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩或解压缩时保留输入文件。</span></span><br><span class="line">gzip -k document.txt</span><br><span class="line">gunzip -k document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">递归压缩目录中的文件</span></span><br><span class="line">gzip -r my_folder/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩 .gz 文件</span></span><br><span class="line">gzip -d document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将输出写入标准输出</span></span><br><span class="line">gzip -c document.txt &gt; document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示详细信息</span></span><br><span class="line">gzip -v document.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试压缩文件完整性</span></span><br><span class="line">gzip -t document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出压缩文件信息</span></span><br><span class="line">gzip -l document.txt.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">强制压缩或解压缩</span></span><br><span class="line">gzip -f document.txt</span><br></pre></td></tr></table></figure>
<h3 id="journalctl"><a href="#journalctl" class="headerlink" title="journalctl"></a>journalctl</h3><h4 id="基本用法-2"><a href="#基本用法-2" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示全部日志（按时间顺序）</span></span><br><span class="line">journalctl</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">反向显示（最新日志在前）</span></span><br><span class="line">journalctl -r </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按时间范围过滤日志（精确时间范围）</span></span><br><span class="line">journalctl --since=&quot;2024-01-01&quot; --until=&quot;2024-01-02&quot; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按时间范围过滤日志（显示近1小时日志）</span></span><br><span class="line">journalctl --since=&quot;1 hour ago&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时显示新日志（默认全部日志）</span></span><br><span class="line">journalctl -f </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时监控SSH服务日志</span></span><br><span class="line">journalctl -u sshd -f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">仅显示httpd服务的错误信息</span></span><br><span class="line">journalctl -u httpd --priority=err</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计SSH登录失败次数</span></span><br><span class="line">journalctl -u sshd | grep &quot;Failed password&quot; | wc -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分析可疑网络连接，查看成功SSH登录源IP和时间</span></span><br><span class="line">journalctl _COMM=sshd | grep &quot;Accepted&quot; | awk &#x27;&#123;print $1, $2, $11, $NF&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理指定日期之前的日志</span></span><br><span class="line">journalctl --vacuum-time=2024-01-01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 2024-01-01 的时间戳（示例时间戳为 1704076800，实际需根据系统获取）</span></span><br><span class="line">start_timestamp=1704076800</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取 2024-01-10 的时间戳（示例时间戳为 1704940800，实际需根据系统获取）</span></span><br><span class="line">end_timestamp=1704940800</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理指定时间段的日志 --vacuum-size=1 表示将删除符合时间范围的日志，最后的 1 是一个占位符，因为 --vacuum-size 需要一个参数来指定清理后的日志大小限制，但这里我们主要关注时间范围清理，所以设置为 1 表示不考虑大小限制进行清理</span></span><br><span class="line">journalctl --since=&quot;@$start_timestamp&quot; --until=&quot;@$end_timestamp&quot; --vacuum-size=1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按日志大小清理日志</span></span><br><span class="line">journalctl --vacuum-size=1G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理 httpd 服务的日志</span></span><br><span class="line">journalctl --unit=httpd --vacuum-size=1G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行的清理操作的详细信息，但不会真正删除任何日志</span></span><br><span class="line">journalctl --vacuum-size=1G --dry-run</span><br></pre></td></tr></table></figure>
<h4 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h4><h5 id="基本用法-3"><a href="#基本用法-3" class="headerlink" title="基本用法"></a>基本用法</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将文件中的某个字符串替换为另一个字符串。</span></span><br><span class="line">sed &#x27;s/old_text/new_text/&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认情况下，sed 只替换每行中第一个匹配的字符串。如果要替换所有匹配的字符串，可以使用 g 选项</span></span><br><span class="line">sed &#x27;s/old_text/new_text/g&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除文件中包含特定字符串的行。</span></span><br><span class="line">sed &#x27;/pattern/d&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除文件中的所有空白行。</span></span><br><span class="line">sed &#x27;/^$/d&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第2行前插入 new_line_text。</span></span><br><span class="line">sed &#x27;2i\new_line_text&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在第2行后插入 new_line_text。</span></span><br><span class="line">sed &#x27;2a\new_line_text&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将第2行替换为 new_line_text。</span></span><br><span class="line">sed &#x27;2c\new_line_text&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打印第2行。</span></span><br><span class="line">sed -n &#x27;2p&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除 file.txt 中的所有数字.</span></span><br><span class="line">sed &#x27;s/[0-9]*//g&#x27; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认情况下，sed 不会修改原文件，而是将结果输出到标准输出。如果要直接修改原文件，可以使用 -i 选项</span></span><br><span class="line">sed -i &#x27;s/old_text/new_text/g&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 -i 选项时，可以指定备份文件的扩展名，以便在修改前备份原文件。</span></span><br><span class="line">sed -i.bak &#x27;s/old_text/new_text/g&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以一次性处理多个文件。</span></span><br><span class="line">sed &#x27;s/old_text/new_text/g&#x27; file1.txt file2.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以将 sed 命令写入脚本文件，然后通过 -f 选项执行。</span></span><br><span class="line">sed -f script.sed filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换第2行到第5行中的 old_text 为 new_text。</span></span><br><span class="line">sed &#x27;2,5s/old_text/new_text/g&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在匹配 pattern 的行的下一行中，将 old_text 替换为 new_text。</span></span><br><span class="line">sed &#x27;/pattern/&#123;n;s/old_text/new_text/&#125;&#x27; filename</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在脚本中使用变量时，可以使用双引号而不是单引号。</span></span><br><span class="line">var=&quot;new_text&quot;</span><br><span class="line">sed &quot;s/old_text/$var/g&quot; filename</span><br></pre></td></tr></table></figure>
<h3 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h3><h4 id="基本用法-4"><a href="#基本用法-4" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 <span class="string">&quot;hello&quot;</span>，忽略大小写</span></span><br><span class="line">grep &quot;hello&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 <span class="string">&quot;hello&quot;</span>，忽略大小写</span></span><br><span class="line">grep -i &quot;hello&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出不包含 <span class="string">&quot;error&quot;</span> 的行</span></span><br><span class="line">grep -v &quot;error&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 <span class="string">&quot;error&quot;</span> 并显示行号</span></span><br><span class="line">grep -n &quot;error&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计包含 <span class="string">&quot;warning&quot;</span> 的行数</span></span><br><span class="line">grep -c &quot;warning&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">递归搜索目录中所有文件，查找 <span class="string">&quot;main&quot;</span></span></span><br><span class="line">grep -r &quot;main&quot; /path/to/directory</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索单词 <span class="string">&quot;test&quot;</span>（不会匹配 <span class="string">&quot;testing&quot;</span> 或 <span class="string">&quot;mytest&quot;</span>）</span></span><br><span class="line">grep -w &quot;test&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 <span class="string">&quot;error&quot;</span> 或 <span class="string">&quot;warning&quot;</span></span></span><br><span class="line">grep -E &quot;error|warning&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">高亮显示匹配的 <span class="string">&quot;error&quot;</span></span></span><br><span class="line">grep --color &quot;error&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示匹配行及其前后 2 行</span></span><br><span class="line">grep -C 2 &quot;error&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只显示包含 <span class="string">&quot;error&quot;</span> 的文件名</span></span><br><span class="line">grep -l &quot;error&quot; *.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从管道中读取数据并搜索</span></span><br><span class="line">cat file.txt | grep &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索以 <span class="string">&quot;start&quot;</span> 开头的行</span></span><br><span class="line">grep &quot;^start&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索以 <span class="string">&quot;end&quot;</span> 结尾的行</span></span><br><span class="line">grep &quot;end$&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索包含 <span class="string">&quot;error&quot;</span> 或 <span class="string">&quot;warning&quot;</span> 的行</span></span><br><span class="line">grep -E &quot;error|warning&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索包含数字的行</span></span><br><span class="line">grep &quot;[0-9]&quot; file.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找所有 .<span class="built_in">log</span> 文件并搜索 <span class="string">&quot;error&quot;</span></span></span><br><span class="line">find /path/to/directory -name &quot;*.log&quot; -exec grep &quot;error&quot; &#123;&#125; \;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找所有 .txt 文件并搜索 <span class="string">&quot;hello&quot;</span></span></span><br><span class="line">find /path/to/directory -name &quot;*.txt&quot; | xargs grep &quot;hello&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索 <span class="string">&quot;error&quot;</span>，但排除 .bak 文件</span></span><br><span class="line">grep -r &quot;error&quot; --exclude=&quot;*.bak&quot; /path/to/directory</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在二进制文件中搜索字符串</span></span><br><span class="line">grep -a &quot;string&quot; binaryfile</span><br></pre></td></tr></table></figure>
<h3 id="通道符（-）"><a href="#通道符（-）" class="headerlink" title="通道符（|）"></a>通道符（|）</h3><h4 id="基本用法-5"><a href="#基本用法-5" class="headerlink" title="基本用法"></a>基本用法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计文件行数</span></span><br><span class="line">cat file.txt | wc -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找特定进程</span></span><br><span class="line">ps aux | grep nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">排序并去重</span></span><br><span class="line">sort file.txt | uniq</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分页查看长输出</span></span><br><span class="line">ls -l /usr/bin | less</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">统计单词频率</span></span><br><span class="line">cat file.txt | tr &#x27; &#x27; &#x27;\n&#x27; | sort | uniq -c | sort -nr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查找大文件</span></span><br><span class="line">find /var/log -type f -size +100M | xargs ls -lh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">压缩日志文件</span></span><br><span class="line">cat access.log | gzip &gt; access.log.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">实时监控日志</span></span><br><span class="line">tail -f /var/log/syslog | grep error</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">计算目录大小</span></span><br><span class="line">du -sh /home | cut -f1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">批量重命名文件</span></span><br><span class="line">ls *.txt | sed &#x27;s/\(.*\)\.txt/mv &amp; \1.doc/&#x27; | sh</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx总结一【常规配置】</title>
    <url>/cnblogs.github.io/p/21237.html</url>
    <content><![CDATA[<h4 id="基础-HTTP-服务配置"><a href="#基础-HTTP-服务配置" class="headerlink" title="基础 HTTP 服务配置"></a>基础 HTTP 服务配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;                  # 监听 80 端口（HTTP）</span><br><span class="line">    server_name example.com;    # 域名或 IP</span><br><span class="line">    root /var/www/html;         # 静态文件根目录</span><br><span class="line">    index index.html index.htm; # 默认索引文件</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404; # 优先匹配文件，再匹配目录，否则返回 404</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="反向代理配置"><a href="#反向代理配置" class="headerlink" title="反向代理配置"></a>反向代理配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:3000;  # 将请求转发到本地的 3000 端口（如 Node.js 应用）</span><br><span class="line">        proxy_set_header Host $host;       # 传递原始请求头</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;          # 定义后端服务器组</span><br><span class="line">        server 10.0.0.1:80 weight=3;  # 权重 3（更高优先级）</span><br><span class="line">        server 10.0.0.2:80;</span><br><span class="line">        server 10.0.0.3:80 backup;    # 备用服务器（当其他服务器宕机时启用）</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name example.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;  # 请求转发到后端组</span><br><span class="line">            # 可选负载均衡算法：轮询（默认）、weight、ip_hash（会话保持）、least_conn（最少连接）等</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SSL-配置（HTTPS）"><a href="#SSL-配置（HTTPS）" class="headerlink" title="SSL 配置（HTTPS）"></a>SSL 配置（HTTPS）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name example.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/example.com.crt;    # SSL 证书路径</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/example.com.key; # 私钥路径</span><br><span class="line"></span><br><span class="line">    # 推荐 SSL 协议和加密套件</span><br><span class="line">    ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class="line">    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /var/www/html;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 强制 HTTP 跳转到 HTTPS</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    return 301 https://$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="静态文件缓存优化"><a href="#静态文件缓存优化" class="headerlink" title="静态文件缓存优化"></a>静态文件缓存优化</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ &#123;</span><br><span class="line">        expires 7d;          # 客户端缓存 7 天</span><br><span class="line">        add_header Cache-Control &quot;public&quot;;</span><br><span class="line">        access_log off;      # 可选：关闭此类请求的日志</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="重定向与重写规则"><a href="#重定向与重写规则" class="headerlink" title="重定向与重写规则"></a>重定向与重写规则</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 301 永久重定向</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name old-domain.com;</span><br><span class="line">    return 301 https://new-domain.com$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># URL 重写（如隐藏 .php 扩展）</span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        rewrite ^/user/(\d+) /user.php?id=$1 last; # 将 /user/123 重写为 /user.php?id=123</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 限制 IP 访问</span><br><span class="line">location /admin &#123;</span><br><span class="line">    allow 192.168.1.0/24;  # 允许特定 IP 段</span><br><span class="line">    deny all;               # 拒绝其他所有 IP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 基础认证（用户名/密码）</span><br><span class="line">location /private &#123;</span><br><span class="line">    auth_basic &quot;Restricted Area&quot;;</span><br><span class="line">    auth_basic_user_file /etc/nginx/.htpasswd;  # 使用 htpasswd 生成的文件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/access.log main;  # 访问日志路径及格式</span><br><span class="line">    error_log /var/log/nginx/error.log warn;    # 错误日志级别（warn、error、crit 等）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Gzip-压缩"><a href="#Gzip-压缩" class="headerlink" title="Gzip 压缩"></a>Gzip 压缩</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    gzip on;                 # 开启 Gzip</span><br><span class="line">    gzip_types text/plain text/css application/json application/javascript text/xml application/xml image/svg+xml;</span><br><span class="line">    gzip_min_length 1024;    # 最小压缩文件大小</span><br><span class="line">    gzip_comp_level 6;       # 压缩级别（1-9）</span><br><span class="line">    gzip_vary on;            # 根据请求头 Vary: Accept-Encoding 启用</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="跨域配置（CORS）"><a href="#跨域配置（CORS）" class="headerlink" title="跨域配置（CORS）"></a>跨域配置（CORS）</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /api &#123;</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;              # 允许所有域名（生产环境建议指定域名）</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST, OPTIONS&#x27;;</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="转发websocket协议"><a href="#转发websocket协议" class="headerlink" title="转发websocket协议"></a>转发websocket协议</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 客户端请求的url中端口后面需携带/websocket（也可以自定义匹配规则），这样才会被nginx匹配成功，匹配成功后通过proxy_pass 转发到后端的ip 为192.168.100.33，端口为6000的机器，协议需为http。</span><br><span class="line"># websocket协议是基于http协议与服务端建立长连接的，在协议要求上需要使用1.1的版本，另外需要设置 proxy_set_header Upgrade $http_upgrade ，proxy_set_header Connection &quot;upgrade&quot;，这几点尤为重要。</span><br><span class="line"></span><br><span class="line">location ~ /websocket &#123;</span><br><span class="line">    proxy_pass 网页链接;</span><br><span class="line">    proxy_set_header  Host $host;</span><br><span class="line">    proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header  X-Forwarded-Proto   $scheme;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">    proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx总结三【健康检查机制】</title>
    <url>/cnblogs.github.io/p/c60c.html</url>
    <content><![CDATA[<h3 id="一、被动健康检查（Passive-Health-Checks）"><a href="#一、被动健康检查（Passive-Health-Checks）" class="headerlink" title="一、被动健康检查（Passive Health Checks）"></a>一、被动健康检查（Passive Health Checks）</h3><p><strong>原理</strong><br>通过监控客户端请求的 实际响应结果 自动屏蔽故障节点。当请求失败达到阈值时，Nginx 暂时将故障服务器移出负载均衡池，避免后续请求继续发送到该节点。</p>
<p><strong>核心参数</strong></p>
<ul>
<li>max_fails: 在 fail_timeout 时间窗口内允许的最大失败次数（默认 1）。</li>
<li>fail_timeout: 包含两个含义： 统计失败次数的窗口时间（如 30s 内）。 服务器被屏蔽的持续时间（默认 10s）。</li>
</ul>
<p><strong>配置示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com max_fails=3 fail_timeout=30s;</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>行为：若 backend1 在 30 秒内连续失败 3 次，Nginx 将其标记为不可用并暂停转发请求 30 秒。</li>
<li>注意：单服务器组中参数无效（无备用节点可切换）。</li>
</ul>
<h3 id="二、主动健康检查（Active-Health-Checks）（NGINX-Plus-专属）"><a href="#二、主动健康检查（Active-Health-Checks）（NGINX-Plus-专属）" class="headerlink" title="二、主动健康检查（Active Health Checks）（NGINX Plus 专属）"></a>二、主动健康检查（Active Health Checks）（NGINX Plus 专属）</h3><p><strong>原理</strong><br>定期向服务器发送 独立探活请求，主动检测节点健康状态。支持自定义检测条件（如状态码、响应头、响应体）。</p>
<p><strong>基础配置</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        zone backend 64k;  # 共享内存区，用于多进程同步状态</span><br><span class="line">        server backend1.example.com;</span><br><span class="line">        server backend2.example.com;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            health_check;  # 默认每5秒检测一次根路径&quot;/&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>默认规则：每 5 秒发送 GET &#x2F; 请求，响应状态码为 200-399 则标记为健康。</li>
</ul>
<p><strong>高级参数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">health_check interval=10s fails=3 passes=2 port=8080 uri=/health;</span><br></pre></td></tr></table></figure>
<ul>
<li>interval: 检测间隔时间（默认 5s）。</li>
<li>fails: 标记节点故障需连续失败次数（默认 1）。</li>
<li>passes: 节点恢复需连续成功次数（默认 1）。</li>
<li>port: 指定检测端口（如 8080）。</li>
<li>uri: 自定义探活路径（如 &#x2F;health）。</li>
</ul>
<h3 id="三、慢启动（Slow-Start）（NGINX-Plus-专属）"><a href="#三、慢启动（Slow-Start）（NGINX-Plus-专属）" class="headerlink" title="三、慢启动（Slow Start）（NGINX Plus 专属）"></a>三、慢启动（Slow Start）（NGINX Plus 专属）</h3><p><strong>应用场景</strong><br>防止故障恢复的服务器被瞬间流量压垮。通过逐步增加权重，让服务器在恢复后缓慢承接流量。</p>
<p><strong>配置示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com slow_start=30s;  # 30秒内权重从0恢复至正常值</span><br><span class="line">    server backend2.example.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>行为：backend1 恢复后，30 秒内从零开始逐步增加流量负载。</li>
</ul>
<h3 id="四、自定义健康条件（Custom-Conditions）（NGINX-Plus-专属）"><a href="#四、自定义健康条件（Custom-Conditions）（NGINX-Plus-专属）" class="headerlink" title="四、自定义健康条件（Custom Conditions）（NGINX Plus 专属）"></a>四、自定义健康条件（Custom Conditions）（NGINX Plus 专属）</h3><p>通过 match 块定义复杂的健康判定规则，支持状态码、响应头、响应体匹配。</p>
<p><strong>示例：检测特定响应内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    match server_ok &#123;</span><br><span class="line">        status 200-399;              # 状态码在200-399范围内</span><br><span class="line">        header Content-Type =~ &quot;json&quot;;  # 响应头包含&quot;json&quot;</span><br><span class="line">        body !~ &quot;error&quot;;             # 响应体不包含&quot;error&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            health_check match=server_ok;  # 应用自定义规则</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="五、强制健康检查（Mandatory-Checks）（NGINX-Plus-专属）"><a href="#五、强制健康检查（Mandatory-Checks）（NGINX-Plus-专属）" class="headerlink" title="五、强制健康检查（Mandatory Checks）（NGINX Plus 专属）"></a>五、强制健康检查（Mandatory Checks）（NGINX Plus 专属）</h3><p><strong>应用场景</strong><br>新加入的服务器（如通过 API 或 DNS 动态添加）必须通过健康检查后才能接收流量。</p>
<p><strong>配置示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    zone backend 64k;</span><br><span class="line">    server backend1.example.com slow_start=30s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        health_check mandatory persistent;  # 强制检测 + 持久化状态</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>mandatory: 新服务器必须通过检测才能加入负载均衡。</li>
<li>persistent: 配置重载时保留服务器状态（如之前已健康则跳过检测）。</li>
</ul>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx总结二【高可用（Keepalived）配置】</title>
    <url>/cnblogs.github.io/p/38221.html</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>操作系统</th>
<th>IP</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>centos7</td>
<td>192.168.133.130</td>
<td>vip（虚拟ip）</td>
</tr>
<tr>
<td></td>
<td>192.168.133.131</td>
<td>keepalived+nginx1</td>
</tr>
<tr>
<td></td>
<td>192.168.133.132</td>
<td>keepalived+nginx2）</td>
</tr>
</tbody></table>
<h4 id="安装nginx-略"><a href="#安装nginx-略" class="headerlink" title="安装nginx (略)"></a>安装nginx (略)</h4><h4 id="安装keepalived"><a href="#安装keepalived" class="headerlink" title="安装keepalived"></a>安装keepalived</h4><p>yum方式直接安装即可，该方式会自动安装依赖</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install keepalived</span><br></pre></td></tr></table></figure>
<p>yum方式安装的会生产配置文件在&#x2F;etc&#x2F;keepalived下：keepalived.conf<br>两台服务器均需要安装keepalived</p>
<h4 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置"></a>服务配置</h4><p>1、先准备nginx的检测脚本 cat &#x2F;etc&#x2F;keepalived&#x2F;check_nginx.sh 内容如下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">bin/bash</span></span><br><span class="line">counter=$(ps -C nginx |grep -v PID |wc -l) #取命令结果赋值给变量</span><br><span class="line">if [ $counter==0 ];then   #判断变量里的值如果等于0</span><br><span class="line">    systemctl start nginx   #尝试启动nginx  </span><br><span class="line">    sleep 5</span><br><span class="line">    counter=$(ps -C nginx |grep -v PID |wc -l)</span><br><span class="line">    if [ $counter==0 ];then #在判断变量里的值如果还等于0</span><br><span class="line">        systemctl stop keepalived  </span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>脚本授权 chmod +x &#x2F;etc&#x2F;keepalived&#x2F;check_nginx.sh</p>
<p>2、准备keepalived的配置 192.168.133.131配置如下：配置前先备份原有配置，原有配置项较多，有些不需要。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /etc/keepalived/keepalived.conf   /etc/keepalived/keepalived.conf.bak</span><br></pre></td></tr></table></figure>
<p>vim &#x2F;etc&#x2F;keepalived&#x2F;keepalived.conf 输入如下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">#检测脚本定义</span><br><span class="line">vrrp_script check_nginx &#123;     #脚本模块</span><br><span class="line">    script  &quot;/etc/keepalived/check_nginx.sh&quot;    #脚本路径</span><br><span class="line">interval 2    #检测脚本时间2秒</span><br><span class="line">weight 10     #优先级</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id master-ip   </span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   script_user root</span><br><span class="line">   enable_script_security</span><br><span class="line"></span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER         # 指定keepalived的角色，MASTER为主，BACKUP为备</span><br><span class="line">    interface ens33      # 当前进行vrrp通讯的网络接口卡(当前centos的网卡) 用ifconfig查看你具体的网卡</span><br><span class="line">    virtual_router_id 51 # 虚拟路由编号，主从要一致</span><br><span class="line">    priority 100         # 优先级，数值越大，获取处理请求的优先级越高</span><br><span class="line">    advert_int 1         # 检查间隔，默认为1s(vrrp组播周期秒数)</span><br><span class="line">    authentication &#123;     #设置验证类型和密码，MASTER和BACKUP必须使用相同的密码才能正常通信</span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    track_script &#123; </span><br><span class="line">        check_nginx      #（调用检测脚本）</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.133.130  # 定义虚拟ip(VIP)，可多设，每行一个</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>192.168.133.132 配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">vrrp_script check_nginx &#123;     #脚本模块</span><br><span class="line">    script  &quot;/etc/keepalived/check_nginx.sh&quot;    #脚本路径</span><br><span class="line">interval 2    #检测脚本时间2秒</span><br><span class="line">weight 10    #优先级</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">  router_id slave-ip</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   script_user root</span><br><span class="line">   enable_script_security</span><br><span class="line"></span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface ens33</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_nginx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.133.130</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="启动keepalived"><a href="#启动keepalived" class="headerlink" title="启动keepalived"></a>启动keepalived</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start keepalived</span><br></pre></td></tr></table></figure>
<p>启动完成不报错即可,验证是否绑定虚拟ip,通过命令 ip as 查看</p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows总结一【CMD常用命令详解】</title>
    <url>/cnblogs.github.io/p/32386.html</url>
    <content><![CDATA[<h4 id="查看和切换目录"><a href="#查看和切换目录" class="headerlink" title="查看和切换目录"></a>查看和切换目录</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd               # 查看当前目录</span><br><span class="line">cd 目录名        # 进入指定目录</span><br><span class="line">cd ..            # 返回上一级</span><br><span class="line">cd /d D:\目录    # 切换盘符和目录</span><br><span class="line">dir              # 列出当前目录内容</span><br></pre></td></tr></table></figure>
<h4 id="文件-文件夹操作"><a href="#文件-文件夹操作" class="headerlink" title="文件&#x2F;文件夹操作"></a>文件&#x2F;文件夹操作</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">md 新建文件夹                   # 新建目录</span><br><span class="line">mkdir 新建文件夹                # 同上</span><br><span class="line">del 文件名                      # 删除文件</span><br><span class="line">del /f /q /s 文件名             # 强制/静默/递归删除</span><br><span class="line">rd /s /q 文件夹名               # 删除文件夹及内容</span><br><span class="line">copy 源文件 目标文件            # 复制文件</span><br><span class="line">xcopy 源 目标 /E /H /Y          # 复制文件夹（含子目录、隐藏文件、自动覆盖）</span><br><span class="line">move 源 目标                    # 移动（重命名）</span><br></pre></td></tr></table></figure>
<h4 id="查看-编辑文件"><a href="#查看-编辑文件" class="headerlink" title="查看&#x2F;编辑文件"></a>查看&#x2F;编辑文件</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">type 文件名.txt                # 显示文本内容</span><br><span class="line">notepad 文件名.txt             # 用记事本打开</span><br><span class="line">more 文件名.txt                # 分页显示</span><br></pre></td></tr></table></figure>
<h4 id="系统管理与信息查看"><a href="#系统管理与信息查看" class="headerlink" title="系统管理与信息查看"></a>系统管理与信息查看</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systeminfo                         # 系统信息</span><br><span class="line">hostname                           # 查看机器名</span><br><span class="line">ver                                # 操作系统版本</span><br><span class="line">tasklist                           # 当前进程列表</span><br><span class="line">taskkill /PID 进程号 /F            # 结束进程</span><br><span class="line">wmic cpu get Name                  # CPU信息</span><br><span class="line">wmic memorychip get capacity       # 内存信息</span><br><span class="line">schtasks /query /fo LIST           # 查看计划任务</span><br><span class="line">set                                # 环境变量</span><br></pre></td></tr></table></figure>
<h4 id="磁盘和文件系统工具"><a href="#磁盘和文件系统工具" class="headerlink" title="磁盘和文件系统工具"></a>磁盘和文件系统工具</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chkdsk C:               # 检查磁盘</span><br><span class="line">diskpart                # 硬盘分区工具</span><br><span class="line">format D:               # 格式化磁盘</span><br><span class="line">vol                     # 显示卷标与序列号</span><br><span class="line">fsutil                  # 文件系统高级操作</span><br></pre></td></tr></table></figure>
<h4 id="网络操作与排查"><a href="#网络操作与排查" class="headerlink" title="网络操作与排查"></a>网络操作与排查</h4><h5 id="IP配置和查看本地网络状态"><a href="#IP配置和查看本地网络状态" class="headerlink" title="IP配置和查看本地网络状态"></a>IP配置和查看本地网络状态</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ipconfig                       # 查看本地IP、子网掩码、网关</span><br><span class="line">ipconfig /all                  # 适配器详细、MAC、DNS等</span><br><span class="line">ipconfig /release              # 释放当前IP</span><br><span class="line">ipconfig /renew                # 重新请求IP</span><br></pre></td></tr></table></figure>
<h5 id="网络连通性测试"><a href="#网络连通性测试" class="headerlink" title="网络连通性测试"></a>网络连通性测试</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping www.baidu.com             # 测和百度的网络是否通畅</span><br><span class="line">ping 192.168.1.1               # 路由器/网关连通</span><br><span class="line">ping 域名/IP -n 10             # 连续发10个包</span><br></pre></td></tr></table></figure>
<h5 id="路由追踪-故障定位"><a href="#路由追踪-故障定位" class="headerlink" title="路由追踪&amp;故障定位"></a>路由追踪&amp;故障定位</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tracert www.baidu.com          # 路径追踪</span><br><span class="line">tracert -d www.baidu.com       # 跳过DNS解析</span><br><span class="line">pathping www.baidu.com         # 跳点延时及丢包率分析</span><br></pre></td></tr></table></figure>
<h5 id="网络端口与连接监控"><a href="#网络端口与连接监控" class="headerlink" title="网络端口与连接监控"></a>网络端口与连接监控</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netstat -an                    # 所有监听端口、连接</span><br><span class="line">netstat -ano                   # 再带上进程PID</span><br><span class="line">netstat -ab                    # 一个进程/应用占哪些端口</span><br><span class="line">netstat -ano | findstr ESTABLISHED  # 揪出电脑与陌生IP的隐蔽连接。</span><br></pre></td></tr></table></figure>
<h5 id="路由与-ARP"><a href="#路由与-ARP" class="headerlink" title="路由与 ARP"></a>路由与 ARP</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">route print                    # 显示路由表</span><br><span class="line">route add ...                  # 添加路由</span><br><span class="line">route delete ...               # 删除路由</span><br><span class="line">arp -a                         # 本机ARP缓存（IP-MAC地址映射）</span><br></pre></td></tr></table></figure>
<h5 id="DNS-解析工具"><a href="#DNS-解析工具" class="headerlink" title="DNS 解析工具"></a>DNS 解析工具</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nslookup 域名                  # 查询域名解析结果</span><br><span class="line">nslookup                       # 进入交互模式，能查A记录/MX等</span><br></pre></td></tr></table></figure>
<h5 id="Telnet-端口连通性测试"><a href="#Telnet-端口连通性测试" class="headerlink" title="Telnet 端口连通性测试"></a>Telnet 端口连通性测试</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">telnet 目标IP/域名 端口</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例：telnet smtp.163.com 25      (测企业邮箱端口)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例：telnet 192.168.1.100 3306   (测内网MySQL端口)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例：telnet 10.0.0.8 3389        (测远程桌面端口)</span></span><br></pre></td></tr></table></figure>
<h5 id="网络驱动器和共享盘"><a href="#网络驱动器和共享盘" class="headerlink" title="网络驱动器和共享盘"></a>网络驱动器和共享盘</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">net use                          # 查看网络映射驱动器</span><br></pre></td></tr></table></figure>
<h4 id="软件、-服务与进程管理"><a href="#软件、-服务与进程管理" class="headerlink" title="软件、 服务与进程管理"></a>软件、 服务与进程管理</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wmic product get name,version      # 已安装程序</span><br><span class="line">wmic service get name,displayname,pathname  # 识别伪装成系统服务的木马程序</span><br><span class="line">tasklist                           # 查看进程</span><br><span class="line">taskkill /im 进程名 /f             # 杀死进程</span><br><span class="line">sc query                           # 查看服务</span><br><span class="line">net start 服务名                   # 启动服务</span><br><span class="line">net stop 服务名                    # 停止服务</span><br><span class="line">start 程序名                       # 启动程序</span><br><span class="line">shutdown /s /f /t 0                # 立即关机</span><br><span class="line">shutdown /r /t 0                   # 立即重启</span><br></pre></td></tr></table></figure>
<h4 id="常用高级-PowerShell-命令"><a href="#常用高级-PowerShell-命令" class="headerlink" title="常用高级 PowerShell 命令"></a>常用高级 PowerShell 命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Get-ChildItem                   # 等价ls/dir</span><br><span class="line">Set-Location 路径               # 切换目录</span><br><span class="line">Copy-Item file1 file2           # 复制</span><br><span class="line">Move-Item file1 file2           # 移动/重命名</span><br><span class="line">Remove-Item filename            # 删除</span><br><span class="line">Get-Content filename            # 查看文件</span><br><span class="line">Start-Process 应用              # 启动程序</span><br><span class="line">Get-Process                     # 查看进程</span><br><span class="line">Stop-Process -Name xxxxx        # 结束进程</span><br><span class="line">Get-Service                     # 查看所有服务</span><br><span class="line">Restart-Service 服务名          # 重启服务</span><br></pre></td></tr></table></figure>
<h4 id="SCP从linux复制文件到本地桌面"><a href="#SCP从linux复制文件到本地桌面" class="headerlink" title="SCP从linux复制文件到本地桌面"></a>SCP从linux复制文件到本地桌面</h4><p>下载的文件输入scp root@服务器ip:文件绝对路径（如scp <a href="mailto:&#114;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#56;&#x2e;&#49;&#51;&#50;">&#114;&#x6f;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#x36;&#x38;&#x2e;&#56;&#x2e;&#49;&#51;&#50;</a>:&#x2F;root&#x2F;test002） .&#x2F;Desktop，然后回车输入服务器密码。上传本地桌面文件到服务器,输入scp Desk\文件路径 root@服务器ip:文件绝对路径（如scp Desktop\test003.txt <a href="mailto:&#x72;&#111;&#111;&#116;&#x40;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#x2e;&#56;&#x2e;&#x31;&#x33;&#50;">&#x72;&#111;&#111;&#116;&#x40;&#49;&#x39;&#x32;&#x2e;&#x31;&#54;&#x38;&#x2e;&#56;&#x2e;&#x31;&#x33;&#50;</a>:&#x2F;root&#x2F;） 然后回车输入服务器密码</p>
]]></content>
      <categories>
        <category>Window</category>
      </categories>
      <tags>
        <tag>Window</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows总结三【超实用快捷键】</title>
    <url>/cnblogs.github.io/p/580e.html</url>
    <content><![CDATA[<h3 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl + C</td>
<td>复制选中内容</td>
</tr>
<tr>
<td>Ctrl + X</td>
<td>剪切选中内容</td>
</tr>
<tr>
<td>Ctrl + V</td>
<td>粘贴</td>
</tr>
<tr>
<td>Ctrl + Z</td>
<td>撤销上一步操作</td>
</tr>
<tr>
<td>Ctrl + Y</td>
<td>恢复撤销的操作</td>
</tr>
<tr>
<td>Ctrl + A</td>
<td>全选当前内容</td>
</tr>
<tr>
<td>Delete</td>
<td>删除选中项（到回收站）</td>
</tr>
<tr>
<td>Shift + Delete</td>
<td>永久删除（不经过回收站）</td>
</tr>
</tbody></table>
<h3 id="窗口管理"><a href="#窗口管理" class="headerlink" title="窗口管理"></a>窗口管理</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Alt + Tab</td>
<td>切换打开的程序窗口</td>
</tr>
<tr>
<td>Win + Tab</td>
<td>打开任务视图（虚拟桌面管理）</td>
</tr>
<tr>
<td>Win + ←&#x2F;→</td>
<td>将窗口贴靠到屏幕左&#x2F;右侧（分屏）</td>
</tr>
<tr>
<td>Win + ↑&#x2F;↓</td>
<td>最大化&#x2F;最小化当前窗口</td>
</tr>
<tr>
<td>Win + D</td>
<td>显示桌面（最小化所有窗口）</td>
</tr>
<tr>
<td>Win + M</td>
<td>最小化所有窗口</td>
</tr>
<tr>
<td>Win + Shift + M</td>
<td>还原最小化的窗口</td>
</tr>
<tr>
<td>Alt + F4</td>
<td>关闭当前窗口或程序</td>
</tr>
</tbody></table>
<h3 id="文件资源管理器"><a href="#文件资源管理器" class="headerlink" title="文件资源管理器"></a>文件资源管理器</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Win + E</td>
<td>打开文件资源管理器</td>
</tr>
<tr>
<td>Ctrl + Shift + N</td>
<td>新建文件夹</td>
</tr>
<tr>
<td>F2</td>
<td>重命名选中文件&#x2F;文件夹</td>
</tr>
<tr>
<td>F3</td>
<td>在资源管理器中搜索</td>
</tr>
<tr>
<td>Alt + Enter</td>
<td>显示选中文件的属性</td>
</tr>
</tbody></table>
<h3 id="系统快捷操作"><a href="#系统快捷操作" class="headerlink" title="系统快捷操作"></a>系统快捷操作</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Win + L</td>
<td>重命名选中文件&#x2F;文件夹</td>
</tr>
<tr>
<td>Win + R</td>
<td>打开“运行”对话框</td>
</tr>
<tr>
<td>Win + I</td>
<td>打开系统设置</td>
</tr>
<tr>
<td>Win + S</td>
<td>打开搜索栏（全局搜索）</td>
</tr>
<tr>
<td>Win + P</td>
<td>切换投影模式（多显示器）</td>
</tr>
<tr>
<td>Ctrl + Shift + Esc</td>
<td>直接打开任务管理器</td>
</tr>
<tr>
<td>Win + X</td>
<td>打开高级用户菜单（快速访问工具）</td>
</tr>
</tbody></table>
<h3 id="浏览器-文本编辑"><a href="#浏览器-文本编辑" class="headerlink" title="浏览器 &amp; 文本编辑"></a>浏览器 &amp; 文本编辑</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Ctrl + T</td>
<td>新建浏览器标签页</td>
</tr>
<tr>
<td>Ctrl + W</td>
<td>关闭当前标签页</td>
</tr>
<tr>
<td>Ctrl + Shift + T</td>
<td>恢复刚关闭的标签页</td>
</tr>
<tr>
<td>Ctrl + F</td>
<td>页面内查找</td>
</tr>
<tr>
<td>F5 &#x2F; Ctrl + R</td>
<td>刷新页面</td>
</tr>
<tr>
<td>Ctrl + Home&#x2F;End</td>
<td>跳转到文档开头&#x2F;结尾</td>
</tr>
<tr>
<td>Ctrl + Shift + ←&#x2F;→</td>
<td>按单词选中文本</td>
</tr>
</tbody></table>
<h3 id="其他实用快捷键"><a href="#其他实用快捷键" class="headerlink" title="其他实用快捷键"></a>其他实用快捷键</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Print Screen</td>
<td>截取全屏（保存到剪贴板）</td>
</tr>
<tr>
<td>Win + Print Screen</td>
<td>截屏并自动保存到“图片”文件夹</td>
</tr>
<tr>
<td>Win + Shift + S</td>
<td>区域截图（支持矩形&#x2F;自由形状）</td>
</tr>
<tr>
<td>Win + V</td>
<td>打开剪贴板历史记录（需启用）</td>
</tr>
<tr>
<td>Win + .</td>
<td>打开表情符号面板</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Window</category>
      </categories>
      <tags>
        <tag>Window</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows总结二【PowerShell实用命令】</title>
    <url>/cnblogs.github.io/p/54270.html</url>
    <content><![CDATA[<h4 id="系统信息相关"><a href="#系统信息相关" class="headerlink" title="系统信息相关"></a>系统信息相关</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-ComputerInfo</td>
<td>查看主机详细信息</td>
</tr>
<tr>
<td>Get-Host</td>
<td>显示当前 PowerShell 主机版本</td>
</tr>
<tr>
<td>systeminfo</td>
<td>查看系统基本信息（CMD兼容）</td>
</tr>
<tr>
<td>Get-Uptime</td>
<td>查看系统运行时长</td>
</tr>
<tr>
<td>Get-WmiObject -Class Win32_OperatingSystem</td>
<td>查看系统版本和安装日期</td>
</tr>
</tbody></table>
<h4 id="文件与目录操作"><a href="#文件与目录操作" class="headerlink" title="文件与目录操作"></a>文件与目录操作</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-ChildItem 或 ls</td>
<td>列出当前目录内容</td>
</tr>
<tr>
<td>cd &lt;路径&gt;</td>
<td>进入目录</td>
</tr>
<tr>
<td>Copy-Item A.txt B.txt</td>
<td>复制文件</td>
</tr>
<tr>
<td>Move-Item A.txt D:\</td>
<td>移动文件</td>
</tr>
<tr>
<td>Remove-Item A.txt</td>
<td>删除文件</td>
</tr>
<tr>
<td>New-Item -ItemType File test.txt</td>
<td>新建文件</td>
</tr>
<tr>
<td>New-Item -ItemType Directory MyFolder</td>
<td>新建目录</td>
</tr>
<tr>
<td>Clear-Content A.txt</td>
<td>清空文件内容</td>
</tr>
<tr>
<td>Get-Content A.txt</td>
<td>读取文件内容</td>
</tr>
<tr>
<td>Set-Content A.txt “Hello”</td>
<td>写入文本到文件</td>
</tr>
</tbody></table>
<h4 id="搜索与过滤"><a href="#搜索与过滤" class="headerlink" title="搜索与过滤"></a>搜索与过滤</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Select-String -Path *.log -Pattern “error”</td>
<td>搜索日志中的关键词</td>
</tr>
<tr>
<td>&#96;Get-ChildItem -Recurse</td>
<td>Where-Object {$_.Name -like “2025”}&#96;</td>
</tr>
<tr>
<td>&#96;Get-Process</td>
<td>Sort-Object CPU -Descending</td>
</tr>
</tbody></table>
<h4 id="进程与服务管理"><a href="#进程与服务管理" class="headerlink" title="进程与服务管理"></a>进程与服务管理</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-Process</td>
<td>查看当前运行进程</td>
</tr>
<tr>
<td>Stop-Process -Name notepad</td>
<td>结束指定进程</td>
</tr>
<tr>
<td>Start-Process notepad.exe</td>
<td>启动进程</td>
</tr>
<tr>
<td>Get-Service</td>
<td>查看系统服务</td>
</tr>
<tr>
<td>Start-Service wuauserv</td>
<td>启动服务</td>
</tr>
<tr>
<td>Stop-Service Spooler</td>
<td>停止服务</td>
</tr>
<tr>
<td>Restart-Service Spooler</td>
<td>重启服务</td>
</tr>
<tr>
<td>Set-Service -Name Spooler -StartupType Automatic</td>
<td>设置服务启动类型</td>
</tr>
</tbody></table>
<h4 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Test-Connection <a href="http://www.baidu.com/">www.baidu.com</a></td>
<td>测试网络连通性</td>
</tr>
<tr>
<td>Resolve-DnsName <a href="http://www.baidu.com/">www.baidu.com</a></td>
<td>DNS解析查询</td>
</tr>
<tr>
<td>Get-NetIPAddress</td>
<td>查看本机IP信息</td>
</tr>
<tr>
<td>Get-NetRoute</td>
<td>查看路由表</td>
</tr>
<tr>
<td>Get-NetTCPConnection</td>
<td>查看当前TCP连接</td>
</tr>
<tr>
<td>Get-NetAdapter</td>
<td>查看网卡信息</td>
</tr>
<tr>
<td>Restart-NetAdapter -Name “Ethernet”</td>
<td>重启网卡</td>
</tr>
<tr>
<td>netstat -an</td>
<td>端口监听状态（CMD兼容）</td>
</tr>
</tbody></table>
<h4 id="用户与权限"><a href="#用户与权限" class="headerlink" title="用户与权限"></a>用户与权限</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-LocalUser</td>
<td>查看本地用户</td>
</tr>
<tr>
<td>New-LocalUser -Name user1 -Password (Read-Host -AsSecureString)</td>
<td>新建用户</td>
</tr>
<tr>
<td>Add-LocalGroupMember -Group Administrators -Member user1</td>
<td>添加用户到管理员组</td>
</tr>
<tr>
<td>Remove-LocalUser -Name user1</td>
<td>删除用户</td>
</tr>
</tbody></table>
<h4 id="安全与权限相关"><a href="#安全与权限相关" class="headerlink" title="安全与权限相关"></a>安全与权限相关</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-Acl .\file.txt</td>
<td>查看权限</td>
</tr>
<tr>
<td>Set-Acl</td>
<td>设置文件或文件夹权限</td>
</tr>
<tr>
<td>Enable-PSRemoting -Force</td>
<td>启用远程管理功能</td>
</tr>
<tr>
<td>Set-ExecutionPolicy RemoteSigned</td>
<td>设置脚本执行权限</td>
</tr>
</tbody></table>
<h4 id="模块与软件包管理"><a href="#模块与软件包管理" class="headerlink" title="模块与软件包管理"></a>模块与软件包管理</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-InstalledModule</td>
<td>查看已安装模块</td>
</tr>
<tr>
<td>Install-Module -Name Az</td>
<td>安装PowerShell模块</td>
</tr>
<tr>
<td>Import-Module Az</td>
<td>导入模块</td>
</tr>
<tr>
<td>Update-Module</td>
<td>更新模块</td>
</tr>
<tr>
<td>Uninstall-Module Az</td>
<td>卸载模块</td>
</tr>
</tbody></table>
<h4 id="计划任务与自动化"><a href="#计划任务与自动化" class="headerlink" title="计划任务与自动化"></a>计划任务与自动化</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-ScheduledTask</td>
<td>查看所有计划任务</td>
</tr>
<tr>
<td>Register-ScheduledTask</td>
<td>注册新任务（较复杂）</td>
</tr>
<tr>
<td>schtasks &#x2F;create</td>
<td>使用命令创建任务（兼容CMD）</td>
</tr>
<tr>
<td>Start-ScheduledTask -TaskName “MyTask”</td>
<td>运行计划任务</td>
</tr>
<tr>
<td>Unregister-ScheduledTask -TaskName “MyTask” -Confirm:$false</td>
<td>删除任务</td>
</tr>
</tbody></table>
<h4 id="实用技巧与快捷命令"><a href="#实用技巧与快捷命令" class="headerlink" title="实用技巧与快捷命令"></a>实用技巧与快捷命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Get-Command</td>
<td>查看所有命令</td>
</tr>
<tr>
<td>Get-Help Get-Process</td>
<td>查看命令帮助</td>
</tr>
<tr>
<td>Get-Help Get-Process -Examples</td>
<td>查看使用示例</td>
</tr>
<tr>
<td>Start-Sleep -Seconds 5</td>
<td>暂停脚本</td>
</tr>
<tr>
<td>Measure-Command {command}</td>
<td>统计命令执行时间</td>
</tr>
<tr>
<td>Out-File log.txt</td>
<td>将输出写入文件</td>
</tr>
</tbody></table>
<h4 id="DISM命令"><a href="#DISM命令" class="headerlink" title="DISM命令"></a>DISM命令</h4><h5 id="基础查询命令（系统状态）"><a href="#基础查询命令（系统状态）" class="headerlink" title="基础查询命令（系统状态）"></a>基础查询命令（系统状态）</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Cleanup-Image &#x2F;CheckHealth</td>
<td>查看当前系统映像健康状态</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Cleanup-Image &#x2F;ScanHealth</td>
<td>更深入检查映像是否可修复</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Cleanup-Image &#x2F;RestoreHealth</td>
<td>修复映像（联网状态建议使用）</td>
</tr>
</tbody></table>
<h5 id="驱动程序操作"><a href="#驱动程序操作" class="headerlink" title="驱动程序操作"></a>驱动程序操作</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Get-Drivers</td>
<td>列出驱动程序</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Export-Driver &#x2F;Destination:D:\Drivers</td>
<td>导出所有驱动</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Add-Driver &#x2F;Driver:”C:\MyDriver\driver.inf”</td>
<td>添加一个驱动</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Remove-Driver &#x2F;Driver:oem25.inf</td>
<td>删除驱动（根据 published name）</td>
</tr>
</tbody></table>
<h5 id="功能组件管理（Feature）"><a href="#功能组件管理（Feature）" class="headerlink" title="功能组件管理（Feature）"></a>功能组件管理（Feature）</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Get-Features</td>
<td>查看所有可用功能</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Enable-Feature &#x2F;FeatureName:NetFx3 &#x2F;All</td>
<td>启用 .NET Framework 3.5</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Disable-Feature &#x2F;FeatureName:MediaPlayback</td>
<td>禁用某功能</td>
</tr>
</tbody></table>
<h5 id="软件包管理（Package）"><a href="#软件包管理（Package）" class="headerlink" title="软件包管理（Package）"></a>软件包管理（Package）</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Get-Packages</td>
<td>查看已安装的补丁包</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Add-Package &#x2F;PackagePath:”C:\update\KB5005463.cab”</td>
<td>安装 .cab 补丁包</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Remove-Package &#x2F;PackageName:Package_for_KB5005463<del>31bf3856ad364e35</del>amd64~~10.0.1.0</td>
<td>卸载某个包（补丁）</td>
</tr>
</tbody></table>
<h5 id="映像文件操作（WIM）"><a href="#映像文件操作（WIM）" class="headerlink" title="映像文件操作（WIM）"></a>映像文件操作（WIM）</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Mount-Wim &#x2F;WimFile:D:\install.wim &#x2F;index:1 &#x2F;MountDir:D:\Mount</td>
<td>挂载WIM镜像</td>
</tr>
<tr>
<td>dism &#x2F;Unmount-Wim &#x2F;MountDir:D:\Mount &#x2F;Commit</td>
<td>卸载并保存改动</td>
</tr>
<tr>
<td>dism &#x2F;Unmount-Wim &#x2F;MountDir:D:\Mount &#x2F;Discard</td>
<td>卸载并放弃改动</td>
</tr>
</tbody></table>
<h5 id="系统语言与区域设置"><a href="#系统语言与区域设置" class="headerlink" title="系统语言与区域设置"></a>系统语言与区域设置</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Get-Intl</td>
<td>显示已安装语言</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Set-AllIntl:zh-CN</td>
<td>设置系统语言为中文简体</td>
</tr>
</tbody></table>
<h5 id="清理与优化命令"><a href="#清理与优化命令" class="headerlink" title="清理与优化命令"></a>清理与优化命令</h5><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dism &#x2F;Online &#x2F;Cleanup-Image &#x2F;StartComponentCleanup</td>
<td>清理 superseded files</td>
</tr>
<tr>
<td>dism &#x2F;Online &#x2F;Cleanup-Image &#x2F;StartComponentCleanup &#x2F;ResetBase</td>
<td>删除备份文件，无法卸载旧补丁</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Window</category>
      </categories>
      <tags>
        <tag>Window</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS安装软件一【ClickHouse集群搭建】</title>
    <url>/cnblogs.github.io/p/64832.html</url>
    <content><![CDATA[<p>ClickHouse数据库的特点：</p>
<ul>
<li>速度快ClickHouse性能超过了市面上大部分的列式存储数据库，相比传统的数据ClickHouse要快100-1000倍，ClickHouse还是有非常大的优势。1亿数据集:ClickHouse比Vertica约快5倍，比Hive快279倍，比MySQL快801倍。10亿数据集:ClickHouse比Vertica约快5倍，MySQL和Hive已经无法完成任务了。</li>
<li>功能多1.支持类SQL查询；2.支持繁多库函数（例如IP转化，URL分析等，预估计算&#x2F;HyperLoglog等）；3.支持数组(Array)和嵌套数据结构(Nested Data Structure)；4.支持数据库异地复制部署。</li>
</ul>
<p>要注意，由于ClickHouse的快速查询还是基于系统资源的，因此在使用的时候要注意每个节点上的存储量，以及节点机器的系统资源要充足。因为查询时是使用内存进行聚合，所以同时并发查询的数量不能太多，否则就会造成资源崩溃。</p>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><table>
<thead>
<tr>
<th>IP</th>
<th>hostname</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.143.20</td>
<td>node1</td>
</tr>
<tr>
<td>192.168.143.21</td>
<td>node2</td>
</tr>
<tr>
<td>192.168.143.22</td>
<td>node3</td>
</tr>
</tbody></table>
<h3 id="初始化环境（所有节点）"><a href="#初始化环境（所有节点）" class="headerlink" title="初始化环境（所有节点）"></a>初始化环境（所有节点）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改机器的hostname</span></span><br><span class="line">vi /etc/hostname</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置hosts</span></span><br><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line">192.168.143.20 node1</span><br><span class="line">192.168.143.21 node2</span><br><span class="line">192.168.143.22 node3</span><br></pre></td></tr></table></figure>
<p>修改完后，执行hostname node1…3，不用重启机器使其生效</p>
<h3 id="下载并安装ClickHouse（所有节点）"><a href="#下载并安装ClickHouse（所有节点）" class="headerlink" title="下载并安装ClickHouse（所有节点）"></a>下载并安装ClickHouse（所有节点）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://repo.yandex.ru/clickhouse/rpm/stable/clickhouse-client-24.3.11.7.x86_64.rpm</span><br><span class="line">wget https://repo.yandex.ru/clickhouse/rpm/stable/clickhouse-common-static-24.3.11.7.x86_64.rpm</span><br><span class="line">wget https://repo.yandex.ru/clickhouse/rpm/stable/clickhouse-server-24.3.11.7.x86_64.rpm</span><br><span class="line">wget https://repo.yandex.ru/clickhouse/rpm/stable/clickhouse-server-common-24.3.11.7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh *.rpm</span><br></pre></td></tr></table></figure>

<h3 id="安装-zookeeper（任意一个节点）"><a href="#安装-zookeeper（任意一个节点）" class="headerlink" title="安装 zookeeper（任意一个节点）"></a>安装 zookeeper（任意一个节点）</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我这里选择node1</span></span><br><span class="line">docker run -d --net host --name zookeeper zookeeper</span><br></pre></td></tr></table></figure>

<h3 id="配置集群（所有节点）"><a href="#配置集群（所有节点）" class="headerlink" title="配置集群（所有节点）"></a>配置集群（所有节点）</h3><ul>
<li>修改&#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将下面行注释去掉 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listen_host</span>&gt;</span>::<span class="tag">&lt;/<span class="name">listen_host</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 修改默认数据存储目录，比如在/home下创建目录clickhouse --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span>/var/lib/clickhouse/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 修改为如下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span>/home/clickhouse/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>修改&#x2F;etc&#x2F;clickhouse-server&#x2F;users.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置查询使用的内存，根据机器资源进行配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">max_memory_usage</span>&gt;</span>5000000000000<span class="tag">&lt;/<span class="name">max_memory_usage</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在&lt;/users&gt;前面增加用户配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 通过Linux命令计算出密码的sha256加密值 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password_sha256_hex</span>&gt;</span>xxxx...xxxx<span class="tag">&lt;/<span class="name">password_sha256_hex</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span>default<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">quota</span>&gt;</span>default<span class="tag">&lt;/<span class="name">quota</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>增加配置文件&#x2F;etc&#x2F;metrika.xml<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">yandex</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ck集群节点 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test_cluster</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">host</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">host</span>&gt;</span>node2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">host</span>&gt;</span>node3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">user</span>&gt;</span>root<span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">password</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">test_cluster</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- zookeeper相关配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">node</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">host</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper-servers</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">networks</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">ip</span>&gt;</span>::/0<span class="tag">&lt;/<span class="name">ip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">networks</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">replica</span>&gt;</span>node1<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 压缩相关配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">case</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">min_part_size</span>&gt;</span>10000000000<span class="tag">&lt;/<span class="name">min_part_size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">min_part_size_ratio</span>&gt;</span>0.01<span class="tag">&lt;/<span class="name">min_part_size_ratio</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">method</span>&gt;</span>lz4<span class="tag">&lt;/<span class="name">method</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">clickhouse_compression</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">clickhouse_remote_servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">yandex</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>重启clickhouse服务<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service clickhouse-server restart</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果不成功，则使用以下命令</span></span><br><span class="line">nohup /usr/bin/clickhouse-server --config=/etc/clickhouse-server/config.xml $</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="创建数据表（所有节点）"><a href="#创建数据表（所有节点）" class="headerlink" title="创建数据表（所有节点）"></a>创建数据表（所有节点）</h3><p>使用可视化工具连接每个节点，在上面创建MergeTree</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> test.data</span><br><span class="line">(</span><br><span class="line">  country String,</span><br><span class="line">  province String,</span><br><span class="line">  <span class="keyword">value</span> String</span><br><span class="line">)</span><br><span class="line">engine<span class="operator">=</span>MergeTree()</span><br><span class="line"><span class="keyword">partition</span> <span class="keyword">by</span> (country, province)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">value</span>;</span><br></pre></td></tr></table></figure>
<h3 id="创建分布式表（node1节点）"><a href="#创建分布式表（node1节点）" class="headerlink" title="创建分布式表（node1节点）"></a>创建分布式表（node1节点）</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create table</span> test.mo <span class="keyword">as</span> test.data ENGINE <span class="operator">=</span> Distributed(test_cluster, test, data, rand());</span><br></pre></td></tr></table></figure>
<h3 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h3><p><strong>使用Python连接clickhouse</strong></p>
<ul>
<li>安装clickhouse-driver</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pip install clickhouse-driver</span><br></pre></td></tr></table></figure>
<ul>
<li>执行命令</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> clickhouse_driver <span class="keyword">import</span> Client</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在哪个节点创建了分布式表，就连接哪个节点</span></span><br><span class="line">client = Client(<span class="string">&#x27;192.168.143.20&#x27;</span>, user=<span class="string">&#x27;root&#x27;</span>, password=<span class="string">&#x27;123456&#x27;</span>, database=<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(client.execute(<span class="string">&#x27;select count(*) from mo&#x27;</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS安装软件三【SVN搭建】</title>
    <url>/cnblogs.github.io/p/8f75.html</url>
    <content><![CDATA[<p><strong>svn安装</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">yum -y install subversion</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看svn安装位置</span></span><br><span class="line">rpm -ql subversion</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看svn版本</span></span><br><span class="line">/usr/bin/svnversion --version</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建svn版本库目录</span></span><br><span class="line">mkdir -p /var/svn/app   #指定目录</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建版本库</span></span><br><span class="line">svnadmin create /var/svn/app</span><br></pre></td></tr></table></figure>

<p>进入&#x2F;var&#x2F;svn&#x2F;app&#x2F;conf目录（该svn版本库配置文件）</p>
<ul>
<li>authz文件是权限控制文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[aliases]</span><br><span class="line">[groups]</span><br><span class="line">admin = cc,dd,ss</span><br><span class="line">[/]</span><br><span class="line">@admin = rw</span><br></pre></td></tr></table></figure>
<ul>
<li>passwd是帐号密码文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[users]</span><br><span class="line">cc = 123456</span><br><span class="line">dd = 123456</span><br><span class="line">ss = 123456</span><br></pre></td></tr></table></figure>
<ul>
<li>svnserve.conf SVN服务配置文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[general]</span><br><span class="line">anon-access = none</span><br><span class="line">auth-access = write</span><br><span class="line">password-db = passwd</span><br><span class="line">authz-db = authz</span><br><span class="line">realm = /var/svn/app</span><br><span class="line">[sasl]</span><br></pre></td></tr></table></figure>

<p>启动svn版本库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">svnserve -d -r /var/svn/app</span><br></pre></td></tr></table></figure>

<p>关闭svn</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -ef | grep svn   查看进程</span><br><span class="line">Kill -9 14977    杀掉进程</span><br></pre></td></tr></table></figure>

<p>配置防火墙</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=3690/tcp                    ##添加3690服务端口号</span><br><span class="line">svnserve -d -r /var/svn/app --listen-port 3690                        ##将另一个版本库指定别的端口</span><br><span class="line">firewall-cmd --reload                                                                         ##重载配置</span><br><span class="line">firewall-cmd --list-all                                                                          ##查看哪些的服务及端口号已经打开了</span><br><span class="line">systemctl status firewalld.service                                                 ##查看防火墙运行状态</span><br><span class="line">systemctl stop firewalld.service                                                    ##关闭防火墙</span><br><span class="line">systemctl status firewalld.service                                                ##再次查看防火墙运行状态</span><br><span class="line">systemctl disable firewalld.service                                             ##永久禁止防火墙，下次重启服务器也不会开启</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS安装软件二【Zabbix-Agent搭建】</title>
    <url>/cnblogs.github.io/p/ef07.html</url>
    <content><![CDATA[<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="1、防火墙配置"><a href="#1、防火墙配置" class="headerlink" title="1、防火墙配置"></a>1、防火墙配置</h3><p>方法一、关闭linux操作系统自带的防火墙：</p>
<ul>
<li>临时关闭：systemctl stop firewalld</li>
<li>永久关闭：systemctl disable firewalld</li>
</ul>
<p>方法二、linux操作系统自带防火墙放通10050端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd  --zone=public  --add-port=10050/tcp  --permanent</span><br><span class="line">firewall-cmd  --reload</span><br></pre></td></tr></table></figure>
<h3 id="2、永久关闭selinux"><a href="#2、永久关闭selinux" class="headerlink" title="2、永久关闭selinux"></a>2、永久关闭selinux</h3><ul>
<li>临时关闭：setenforce 0</li>
<li>永久关闭：编辑&#x2F;etc&#x2F;selinux.config ,将enforcing取值改为disabled ，保存退出</li>
</ul>
<p><strong>yum方式安装</strong><br>1、配置zabbix仓库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rpm -Uvh https://repo.zabbix.com/zabbix/6.0/rhel/7/x86_64/zabbix-release-6.0-3.el7.noarch.rpm</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<p>2、安装agent</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y zabbix-agent</span><br></pre></td></tr></table></figure>
<p>3、配置 Zabbix-Agent 指向 Zabbix-Server</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/zabbix/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server=192.168.244.128   #指向serverIP</span><br><span class="line">ServerActive=192.168.244.128   #指向serverIP</span><br><span class="line">Hostname=k8s-master   #server上该服务器取名必须与该值相同</span><br><span class="line">ListenIP=0.0.0.0   #填写本地IP或者监听所有</span><br></pre></td></tr></table></figure>
<p>4、启动agent服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start zabbix-agent</span><br><span class="line">systemctl enable zabbix-agent</span><br><span class="line">systemctl status zabbix-agent</span><br></pre></td></tr></table></figure>

<h2 id="二进制包安装"><a href="#二进制包安装" class="headerlink" title="二进制包安装"></a>二进制包安装</h2><p>1、下载二进制包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget https://cdn.zabbix.com/zabbix/binaries/stable/6.0/6.0.3/zabbix_agent-6.0.3-linux-3.0-amd64-static.tar.gz</span><br></pre></td></tr></table></figure>
<p>2、创建用户和目录及更改属主（组）</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd zabbix</span><br><span class="line">mkdir /usr/local/zabbix</span><br><span class="line">mkdir -p /data/zabbix/logs/   #日志路径</span><br><span class="line">mkdir -p /data/scripts/init.d/   #启动脚本路径</span><br><span class="line">chown -R zabbix:zabbix /usr/local/zabbix</span><br><span class="line">chown -R zabbix:zabbix /data/zabbix/</span><br></pre></td></tr></table></figure>
<p>3、解压二进制包到zabbix目录下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar xvf zabbix_agent-6.0.3-linux-3.0-amd64-static.tar.gz -C /usr/local/zabbix</span><br></pre></td></tr></table></figure>
<p>4、修改agent配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &gt; /usr/local/zabbix/conf/zabbix_agentd.conf &lt;&lt; EOF</span><br><span class="line">PidFile=/data/zabbix/logs/zabbix_agentd.pid</span><br><span class="line">LogFile=/data/zabbix/logs/zabbix_agentd.log</span><br><span class="line">Server=192.168.244.1154</span><br><span class="line">ListenPort=10050</span><br><span class="line">ListenIP=0.0.0.0</span><br><span class="line">ServerActive=192.168.244.154</span><br><span class="line">Hostname=mysql</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>5、配置agent启动脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /data/scripts/init.d/agent_start.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">·················································</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/bin/bash</span></span><br><span class="line">usage() &#123;</span><br><span class="line"> echo &quot;Usage: sh 脚本名.sh [start|stop|restart|status]&quot;</span><br><span class="line"> exit 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检查程序是否在运行</span></span><br><span class="line">is_exist()&#123;</span><br><span class="line"> pid=`ps -ef |grep zabbix_agent|grep -v &quot;grep&quot; |awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">如果不存在返回1，存在返回0</span></span><br><span class="line"> if [ -z &quot;$&#123;pid&#125;&quot; ]; then</span><br><span class="line"> return 1</span><br><span class="line"> else</span><br><span class="line"> return 0</span><br><span class="line"> fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动方法</span></span><br><span class="line">start()&#123;</span><br><span class="line"> is_exist</span><br><span class="line"> if [ $? -eq &quot;0&quot; ]; then</span><br><span class="line"> echo &quot;agent2 is already running. pid=$&#123;pid&#125; .&quot;</span><br><span class="line"> else</span><br><span class="line"> /usr/local/zabbix/sbin/zabbix_agentd -c /usr/local/zabbix/conf/zabbix_agentd.conf &gt;/dev/null 2&gt;&amp;1 &amp; </span><br><span class="line"> echo &quot;agent2 start success&quot;</span><br><span class="line"> fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止方法</span></span><br><span class="line">stop()&#123;</span><br><span class="line"> is_exist</span><br><span class="line"> if [ $? -eq &quot;0&quot; ]; then</span><br><span class="line"> kill -9 $pid</span><br><span class="line"> else</span><br><span class="line"> echo &quot;agent2 is not running&quot;</span><br><span class="line"> fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启</span></span><br><span class="line">restart()&#123;</span><br><span class="line"> stop</span><br><span class="line"> start</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据输入参数，选择执行对应方法，不输入则执行使用说明</span></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line"> &quot;start&quot;)</span><br><span class="line"> start</span><br><span class="line"> ;;</span><br><span class="line"> &quot;stop&quot;)</span><br><span class="line"> stop</span><br><span class="line"> ;;</span><br><span class="line"> &quot;restart&quot;)</span><br><span class="line"> restart</span><br><span class="line"> ;;</span><br><span class="line"> *)</span><br><span class="line"> usage</span><br><span class="line"> ;;</span><br><span class="line">esac</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">·················································</span></span><br></pre></td></tr></table></figure>
<p>6、自启动agent</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;/data/scripts/init.d/agent_start.sh start &amp;&#x27; &gt;&gt; /etc/rc.local</span><br><span class="line">chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>
<p>7、启动agent</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/local/zabbix/sbin/zabbix_agentd -c /usr/local/zabbix/conf/zabbix_agentd.conf &amp;</span><br><span class="line">ps -ef |grep agent</span><br></pre></td></tr></table></figure>
<p>8、在server上添加Agent主机<br>点击配置 -&gt;主机 -&gt;添加主机 -&gt;填写主机内容 -&gt;添加，主机就添加成功了。</p>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS安装软件四【Redis搭建】</title>
    <url>/cnblogs.github.io/p/2553.html</url>
    <content><![CDATA[<h3 id="Redis5-0安装"><a href="#Redis5-0安装" class="headerlink" title="Redis5.0安装"></a>Redis5.0安装</h3><p><strong>方式一</strong></p>
<h4 id="使用包管理器"><a href="#使用包管理器" class="headerlink" title="使用包管理器"></a>使用包管理器</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装 CentOS/RHEL</span></span><br><span class="line">sudo yum install epel-release -y</span><br><span class="line">sudo yum install redis -y</span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong></p>
<h4 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载</span></span><br><span class="line">wget https://rpmfind.net/linux/remi/enterprise/9/modular/x86_64/redis-5.0.14-1.el9.remi.x86_64.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">sudo yum localinstall redis-5.0.14-1.el7.remi.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>方式三</strong></p>
<h4 id="源码编译安装"><a href="#源码编译安装" class="headerlink" title="源码编译安装"></a>源码编译安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖 CentOS/RHEL</span></span><br><span class="line">sudo yum groupinstall &quot;Development Tools&quot; -y  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载最新稳定版（以 7.2.4 为例，替换为官网最新版本号）</span></span><br><span class="line">wget https://download.redis.io/releases/redis-7.2.4.tar.gz</span><br><span class="line">tar xzf redis-7.2.4.tar.gz</span><br><span class="line">cd redis-7.2.4</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译并安装到 /usr/local/redis</span></span><br><span class="line">make</span><br><span class="line">sudo make install PREFIX=/usr/local/redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建配置文件目录</span></span><br><span class="line">sudo mkdir /etc/redis</span><br><span class="line">sudo cp redis.conf /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo  nano /etc/redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">daemonized no 改为 daemonized <span class="built_in">yes</span> 以后台静默进程启动</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把 <span class="built_in">bind</span> 127.0.0.1 注释掉</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">protected-mode <span class="built_in">yes</span> 把<span class="built_in">yes</span>改为no</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果想要设置密码: requirepass 密码（可选）</span></span><br></pre></td></tr></table></figure>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启redis服务</span></span><br><span class="line">sudo systemctl restart redis.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置redis服务为开机自启</span></span><br><span class="line">sudo systemctl enable redis.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 查看redis是否启动成功</span></span><br><span class="line">ps aux | grep redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查 Redis 服务状态</span></span><br><span class="line">sudo systemctl status redis</span><br></pre></td></tr></table></figure>
<h4 id="防护墙打开端口6379"><a href="#防护墙打开端口6379" class="headerlink" title="防护墙打开端口6379"></a>防护墙打开端口6379</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加端口到 firewalld</span></span><br><span class="line">sudo firewall-cmd --zone=public --add-port=6379/tcp --permanent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载防火墙配置</span></span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS总结一【常规配置】</title>
    <url>/cnblogs.github.io/p/12509.html</url>
    <content><![CDATA[<h3 id="更新YUM源"><a href="#更新YUM源" class="headerlink" title="更新YUM源"></a>更新YUM源</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -al /etc/yum.repos.d</span><br><span class="line">cp CentOS-Base.repo CentOS-Base.repo.backup</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum -y update</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS总结三【YUM命令安装软件】</title>
    <url>/cnblogs.github.io/p/8358.html</url>
    <content><![CDATA[<h3 id="Nginx1-22-1安装"><a href="#Nginx1-22-1安装" class="headerlink" title="Nginx1.22.1安装"></a>Nginx1.22.1安装</h3><h4 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.22.1-1.el7.ngx.x86_64.rpm</span><br></pre></td></tr></table></figure>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum localinstall nginx-1.22.1-1.el7.ngx.x86_64.rpm</span><br></pre></td></tr></table></figure>
<h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nginx -V</span><br><span class="line"></span><br><span class="line">/etc/nginx        #主目录</span><br><span class="line">/etc/nginx/nginx.conf   #配置文件</span><br><span class="line">/var/log/nginx    #日志</span><br><span class="line">/var/cache/nginx  #缓存</span><br><span class="line">/usr/sbin/nginx   #主程序</span><br><span class="line">/usr/lib64/nginx/modules  #组件模块</span><br></pre></td></tr></table></figure>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl start nginx          # 启动服务</span><br><span class="line">sudo systemctl enable nginx         # 设置为开机自启</span><br><span class="line">sudo systemctl status nginx         # 检查 服务状态</span><br></pre></td></tr></table></figure>


<h3 id="SQL-Server安装"><a href="#SQL-Server安装" class="headerlink" title="SQL Server安装"></a>SQL Server安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 添加 Microsoft 的官方存储库：</span></span></span><br><span class="line">sudo curl -o /etc/yum.repos.d/mssql-server. repo https://packages.microsoft.com/config/rhel/7/mssql-server-2019.repo</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 安装 SQL Server：</span></span></span><br><span class="line">sudo yum install -y mssql-server</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 配置 SQL Server：</span></span></span><br><span class="line">sudo /opt/mssql/bin/mssql-conf setup</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 在配置过程中，你需要接受许可协议并设置 SA 用户的密码。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动 SQL Server 服务：</span></span></span><br><span class="line">sudo systemctl start mssql-server</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 验证 SQL Server 服务是否正在运行：</span></span></span><br><span class="line">systemctl status mssql-server</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS总结二【设置Java开机自动运行】</title>
    <url>/cnblogs.github.io/p/23847.html</url>
    <content><![CDATA[<h3 id="方法一：使用systemd服务"><a href="#方法一：使用systemd服务" class="headerlink" title="方法一：使用systemd服务"></a>方法一：使用systemd服务</h3><p>systemd是Linux系统中广泛使用的初始化系统和系统管理守护进程，可以用来管理开机启动项</p>
<h4 id="创建一个服务文件"><a href="#创建一个服务文件" class="headerlink" title="创建一个服务文件"></a>创建一个服务文件</h4><p>创建一个新的service文件，例如ruoyi-admin.service，路径为&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/systemd/system/ruoyi-admin.service</span><br></pre></td></tr></table></figure>
<h4 id="编辑服务文件"><a href="#编辑服务文件" class="headerlink" title="编辑服务文件"></a>编辑服务文件</h4><p>在文件中添加以下内容，根据实际情况修改：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=ruoyi-admin</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">WorkingDirectory=/home/zhao/programs/ruoyi</span><br><span class="line">ExecStart=/usr/bin/java -jar /home/zhao/programs/ruoyi/ruoyi-admin.jar</span><br><span class="line">SuccessExitStatus=143</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<ul>
<li>Description：服务的描述。</li>
<li>After：指定该服务在</li>
<li>network.target之后启动。</li>
<li>User和Group：运行该服务的用户和组。</li>
<li>WorkingDirectory：工作目录。</li>
<li>ExecStart：启动Java程序的命令。</li>
<li>SuccessExitStatus：程序正常退出的状态码。</li>
<li>Restart：设置服务在失败后自动重启。</li>
<li>RestartSec：重启前的等待时间。</li>
</ul>
<h4 id="重新加载systemd配置并启动服务"><a href="#重新加载systemd配置并启动服务" class="headerlink" title="重新加载systemd配置并启动服务"></a>重新加载systemd配置并启动服务</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start ruoyi-admin</span><br></pre></td></tr></table></figure>
<h4 id="设置开机自启"><a href="#设置开机自启" class="headerlink" title="设置开机自启"></a>设置开机自启</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable ruoyi-admin</span><br></pre></td></tr></table></figure>
<h4 id="检查服务状态"><a href="#检查服务状态" class="headerlink" title="检查服务状态"></a>检查服务状态</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl status ruoyi-admin</span><br></pre></td></tr></table></figure>

<h3 id="方法二：使用crontab"><a href="#方法二：使用crontab" class="headerlink" title="方法二：使用crontab"></a>方法二：使用crontab</h3><h4 id="编辑crontab文件"><a href="#编辑crontab文件" class="headerlink" title="编辑crontab文件"></a>编辑crontab文件</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>
<h4 id="添加开机启动项"><a href="#添加开机启动项" class="headerlink" title="添加开机启动项"></a>添加开机启动项</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">@reboot /usr/bin/java -jar /home/zhao/programs/ruoyi/ruoyi-admin.jar</span><br></pre></td></tr></table></figure>
<ul>
<li>这里的@reboot表示在系统启动时执行该命令。</li>
<li>保存文件并退出编辑器，crontab会自动重新加载配置</li>
</ul>
<h3 id="方法三：使用rc-local"><a href="#方法三：使用rc-local" class="headerlink" title="方法三：使用rc.local"></a>方法三：使用rc.local</h3><h4 id="编辑rc-local文件"><a href="#编辑rc-local文件" class="headerlink" title="编辑rc.local文件"></a>编辑rc.local文件</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>
<h4 id="添加启动命令"><a href="#添加启动命令" class="headerlink" title="添加启动命令"></a>添加启动命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/bin/java -jar /home/zhao/programs/ruoyi/ruoyi-admin.jar</span><br></pre></td></tr></table></figure>
<h4 id="赋予rc-local执行权限"><a href="#赋予rc-local执行权限" class="headerlink" title="赋予rc.local执行权限"></a>赋予rc.local执行权限</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chmod +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>
<h4 id="启动rc-local服务"><a href="#启动rc-local服务" class="headerlink" title="启动rc.local服务"></a>启动rc.local服务</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl start rc.local</span><br></pre></td></tr></table></figure>
<h4 id="设置开机自启-1"><a href="#设置开机自启-1" class="headerlink" title="设置开机自启"></a>设置开机自启</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable rc.local</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu总结一【基本命令】</title>
    <url>/cnblogs.github.io/p/30267.html</url>
    <content><![CDATA[<h3 id="文件查看与内容处理"><a href="#文件查看与内容处理" class="headerlink" title="文件查看与内容处理"></a>文件查看与内容处理</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat file.txt                 # 显示全部内容</span><br><span class="line">tac file.txt                 # 反向输出</span><br><span class="line">less file.txt                # 分页浏览，q退出</span><br><span class="line">more file.txt                # 类似less</span><br><span class="line">head -n 20 file.txt          # 看前20行</span><br><span class="line">tail -n 20 file.txt          # 看末20行</span><br><span class="line">tail -f log.txt              # 实时查看日志动态（Ctrl+C终止）</span><br><span class="line">grep &quot;关键词&quot; file.txt       # 搜索文件中内容</span><br><span class="line">grep -r &quot;关键词&quot; ./目录      # 递归搜索</span><br><span class="line">wc -l file.txt               # 统计行数</span><br><span class="line">cut -d &#x27;:&#x27; -f 1 etc/passwd   # 分隔符方式提取字段</span><br><span class="line">sort file.txt | uniq         # 排序去重</span><br><span class="line">diff a.txt b.txt             # 对比文件内容差异</span><br></pre></td></tr></table></figure>

<h3 id="权限与所有者管理"><a href="#权限与所有者管理" class="headerlink" title="权限与所有者管理"></a>权限与所有者管理</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls -l file                  # 查看权限</span><br><span class="line">chmod 755 file              # 修改权限为rwxr-xr-x</span><br><span class="line">chmod u+x script.sh         # 增加可执行权限</span><br><span class="line">chown user file             # 修改属主</span><br><span class="line">chown user:group file       # 修改属主和属组</span><br><span class="line">sudo command                # 以root权限执行命令</span><br></pre></td></tr></table></figure>

<h3 id="系统管理和监控"><a href="#系统管理和监控" class="headerlink" title="系统管理和监控"></a>系统管理和监控</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">free -m                        # 查看内存占用 (单位MB)</span><br><span class="line">df -h                          # 查看分区使用 (人类可读)</span><br><span class="line">du -sh /文件夹                 # 查看文件夹大小</span><br><span class="line">top/htop                       # 查看进程和资源占用</span><br><span class="line">ps aux                         # 查看全部进程</span><br><span class="line">ps aux | grep nginx            # 查找进程</span><br><span class="line">kill PID                       # 终止指定进程</span><br><span class="line">kill -9 PID                    # 强制终止进程</span><br><span class="line">history                        # 查看命令历史</span><br><span class="line">uptime                         # 查看开机时长和负载</span><br><span class="line">who                            # 当前在线用户</span><br><span class="line">uname -a                       # 系统/内核信息</span><br><span class="line">lscpu                          # 查看CPU信息</span><br><span class="line">lsblk                          # 存储设备和挂载信息</span><br></pre></td></tr></table></figure>

<h3 id="网络管理和测试"><a href="#网络管理和测试" class="headerlink" title="网络管理和测试"></a>网络管理和测试</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip a / ifconfig                      # 查看和配置网络</span><br><span class="line">ping baidu.com                       # 测试网络连通性</span><br><span class="line">traceroute www.baidu.com             # 跟踪路由</span><br><span class="line">netstat -tulnp                       # 监听端口(旧系统)</span><br><span class="line">ss -tulnp                            # 新系统端口</span><br><span class="line">curl -I https://www.baidu.com        # 获取网页响应头</span><br><span class="line">wget http://...                      # 下载文件</span><br><span class="line">scp 本地文件 user@host:/目标路径     # 远程复制</span><br><span class="line">rsync -avz 源 目标                   # 高效同步</span><br><span class="line">ssh user@host                        # 远程登录</span><br></pre></td></tr></table></figure>

<h3 id="软件包管理-APT"><a href="#软件包管理-APT" class="headerlink" title="软件包管理 APT"></a>软件包管理 APT</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update                         # 更新软件源</span><br><span class="line">sudo apt upgrade                        # 升级已安装包</span><br><span class="line">sudo apt install 软件包                  # 安装软件</span><br><span class="line">sudo apt remove 软件包                   # 卸载软件</span><br><span class="line">sudo apt purge 软件包                    # 卸载并清理配置</span><br><span class="line">sudo apt autoremove                     # 清理不再使用的依赖</span><br><span class="line">sudo apt search 关键词                   # 搜索软件包</span><br><span class="line">sudo apt list --installed               # 已安装包</span><br><span class="line">sudo dpkg -i 包名.deb                   # 手动安装deb包</span><br><span class="line">sudo apt --fix-broken install           # 解决依赖问题</span><br></pre></td></tr></table></figure>

<h3 id="压缩与解压"><a href="#压缩与解压" class="headerlink" title="压缩与解压"></a>压缩与解压</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar -czf archive.tar.gz dir     # 压缩目录</span><br><span class="line">tar -xzf archive.tar.gz         # 解压</span><br><span class="line">zip -r file.zip dir             # 打包为 zip</span><br><span class="line">unzip file.zip                  # 解压 zip</span><br><span class="line">gzip file.txt                   # 压缩文件</span><br><span class="line">gunzip file.txt.gz              # 解压文件</span><br><span class="line">xz -z file                      # xz 压缩</span><br><span class="line">xz -d file.xz                   # xz 解压</span><br><span class="line">7z a file.7z dir                # 高压缩（需安装）</span><br><span class="line">7z x file.7z                    # 解压（需安装）</span><br></pre></td></tr></table></figure>

<h3 id="排查问题命令"><a href="#排查问题命令" class="headerlink" title="排查问题命令"></a>排查问题命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo netstat -tlnp | grep 30001  # 排查端口占用情况</span><br><span class="line">du-ah / |sort-rh |head-n 10      # du查找大文件</span><br><span class="line">journalctl -xe                   # 查看系统日志（systemd）</span><br><span class="line">dmesg                            # 查看启动和内核日志</span><br><span class="line">tail -f /var/log/syslog          # 实时查看系统日志</span><br><span class="line">tail -f /var/log/auth.log        # 查看安全认证日志</span><br></pre></td></tr></table></figure>

<h3 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 编辑工具</span></span></span><br><span class="line">sudo apt install vim</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 网络工具</span></span></span><br><span class="line">sudo apt install iputils-ping</span><br><span class="line">sudo apt install telnet telnetd openbsd-inetd</span><br><span class="line">sudo apt-get install dnsutils</span><br><span class="line">sudo apt-get install net-tools</span><br><span class="line">sudo apt-get install lrzsz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 常用工具</span></span></span><br><span class="line">sudo apt-get install zip</span><br></pre></td></tr></table></figure>

<h3 id="防火墙命令"><a href="#防火墙命令" class="headerlink" title="防火墙命令"></a>防火墙命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装ufw</span></span><br><span class="line">sudo apt install ufw -y</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启防火墙</span></span></span><br><span class="line">sudo ufw enable</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 关闭防火墙</span></span></span><br><span class="line">sudo ufw disable </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启设置的默认策略</span></span></span><br><span class="line">sudo ufw default allow</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看防火墙状态</span></span></span><br><span class="line">sudo ufw status</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启端口</span></span></span><br><span class="line">sudo ufw allow 22</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除规则</span></span></span><br><span class="line">sudo ufw delete allow 22</span><br></pre></td></tr></table></figure>

<h3 id="清理命令"><a href="#清理命令" class="headerlink" title="清理命令"></a>清理命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 列出已安装的内核</span></span></span><br><span class="line">dpkg --list | grep linux-image</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除一个特定的内核版本</span></span></span><br><span class="line">sudo apt-get remove --purge linux-image-&lt;version&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 清理其他缓存文件</span></span></span><br><span class="line">rm-rf ~/.cache/*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 清理未使用的包文件</span></span></span><br><span class="line">sudo apt-get clean</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 清理已安装包的无用依赖项</span></span></span><br><span class="line">sudo apt-get autoremove</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除过期的包</span></span></span><br><span class="line">sudo apt-get autoclean</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 清理日志文件 （删除超过 7 天的日志文件）</span></span></span><br><span class="line">sudo journalctl --vacuum-time=7d</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS总结五【NFS共享目录配置】</title>
    <url>/cnblogs.github.io/p/55378.html</url>
    <content><![CDATA[<table>
<thead>
<tr>
<th>角色</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>服务端</td>
<td>192.168.59.101</td>
</tr>
<tr>
<td>客户端</td>
<td>192.168.59.102</td>
</tr>
</tbody></table>
<h3 id="服务端配置-192-168-59-101"><a href="#服务端配置-192-168-59-101" class="headerlink" title="服务端配置(192.168.59.101)"></a>服务端配置(192.168.59.101)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查nfs服务安装情况，一般都是系统安装好的</span></span><br><span class="line">systemctl status rpcbind</span><br><span class="line">systemctl status nfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若没有启动则启动</span></span><br><span class="line">systemctl start rpcbind</span><br><span class="line">systemctl start nfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置共享目录，并设置内容</span></span><br><span class="line">vim /etc/exports</span><br><span class="line">/data/wwwroot 192.168.59.0/24(rw,sync,no_subtree_check,no_root_squash)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：这里的/data/wwwroot 为贡献目录，该目录可以根据自身情况自定义</span></span><br><span class="line">/data/wwwroot # 共享目录</span><br><span class="line">192.168.59.0/24 # 允许该ip段进行连接</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rw 可读可写权限</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改共享目录权限</span></span><br><span class="line">chmod -R 0777 /data/wwwroot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启nfs服务</span></span><br><span class="line">systemctl restart nfs</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">记录exportfs命令</span></span><br><span class="line">exportfs -a # 全部挂载或者全部卸载</span><br><span class="line">exportfs -r # 重新挂载</span><br><span class="line">exportfs -u # 卸载某一个目录</span><br><span class="line">exportfs -v # 显示共享目录</span><br></pre></td></tr></table></figure>
<h3 id="客户端配置-192-168-59-102"><a href="#客户端配置-192-168-59-102" class="headerlink" title="客户端配置(192.168.59.102)"></a>客户端配置(192.168.59.102)</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查nfs服务安装情况，一般都是系统安装好的</span></span><br><span class="line">systemctl status rpcbind</span><br><span class="line">systemctl status nfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(若没有启动则重新启动)</span></span><br><span class="line">systemctl start rpcbind</span><br><span class="line">systemctl start nfs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建挂载目录(可以与服务器端挂载目录不一致）</span></span><br><span class="line">mkdir /data/wwwroot</span><br><span class="line">chmod -R 0777 /data/wwwroot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">挂载服务器端共享目录</span></span><br><span class="line">mount.nfs 192.168.59.101:/data/wwwroot /data/wwwroot </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">mount 192.168.59.101:/data/wwwroot /data/wwwroot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看挂载情况</span></span><br><span class="line">cat /proc/mounts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载挂载目录（注意：不要在挂载目录里卸载）</span></span><br><span class="line">umount /data/wwwroot</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu服务器配置一【配置固定IP】</title>
    <url>/cnblogs.github.io/p/3b38.html</url>
    <content><![CDATA[<p>在 Ubuntu 服务器上配置固定 IP（静态 IP）可以通过 netplan（Ubuntu 17.10 及更高版本默认使用）或直接修改 &#x2F;etc&#x2F;network&#x2F;interfaces（旧版 Ubuntu）。以下是两种方法的详细步骤：</p>
<h2 id="方法-1：使用-Netplan（推荐，适用于-Ubuntu-17-10-）"><a href="#方法-1：使用-Netplan（推荐，适用于-Ubuntu-17-10-）" class="headerlink" title="方法 1：使用 Netplan（推荐，适用于 Ubuntu 17.10+）"></a>方法 1：使用 Netplan（推荐，适用于 Ubuntu 17.10+）</h2><p>Netplan 是 Ubuntu 的现代网络配置工具，使用 YAML 文件定义网络接口。</p>
<h3 id="1-查看当前网络接口"><a href="#1-查看当前网络接口" class="headerlink" title="1. 查看当前网络接口"></a>1. 查看当前网络接口</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p>找到要配置的网卡名称（如 ens33、eth0 或 enp0s3）。</p>
<h3 id="2-编辑-Netplan-配置文件"><a href="#2-编辑-Netplan-配置文件" class="headerlink" title="2. 编辑 Netplan 配置文件"></a>2. 编辑 Netplan 配置文件</h3><p>Ubuntu 的 Netplan 配置文件通常位于 &#x2F;etc&#x2F;netplan&#x2F; 目录下，文件名可能是：</p>
<ul>
<li>01-netcfg.yaml</li>
<li>50-cloud-init.yaml</li>
<li>00-installer-config.yaml</li>
</ul>
<p>使用 nano 或 vim 编辑：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/netplan/01-netcfg.yaml</span><br></pre></td></tr></table></figure>
<h3 id="3-配置静态-IP"><a href="#3-配置静态-IP" class="headerlink" title="3. 配置静态 IP"></a>3. 配置静态 IP</h3><p>修改文件内容如下（示例，请根据你的网络调整）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: networkd</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:  # 你的网卡名称</span><br><span class="line">      dhcp4: no  # 禁用 DHCP</span><br><span class="line">      addresses: [192.168.0.100/24]  # 静态 IP 和子网掩码</span><br><span class="line">      gateway4: 192.168.0.1  # 默认网关</span><br><span class="line">      nameservers:</span><br><span class="line">        addresses: [8.8.8.8, 8.8.4.4]  # DNS 服务器</span><br></pre></td></tr></table></figure>
<h3 id="4-应用配置"><a href="#4-应用配置" class="headerlink" title="4. 应用配置"></a>4. 应用配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo netplan apply</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果报错，可以调试：</span></span><br><span class="line">sudo netplan --debug apply</span><br></pre></td></tr></table></figure>
<h3 id="5-验证"><a href="#5-验证" class="headerlink" title="5. 验证"></a>5. 验证</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip addr</span><br><span class="line">ping google.com</span><br></pre></td></tr></table></figure>

<h2 id="方法-2：修改-etc-network-interfaces（旧版-Ubuntu）"><a href="#方法-2：修改-etc-network-interfaces（旧版-Ubuntu）" class="headerlink" title="方法 2：修改 &#x2F;etc&#x2F;network&#x2F;interfaces（旧版 Ubuntu）"></a>方法 2：修改 &#x2F;etc&#x2F;network&#x2F;interfaces（旧版 Ubuntu）</h2><p>如果 Ubuntu 使用传统的 ifupdown 网络管理工具（如 Ubuntu 16.04 或更早），可以手动修改网络接口文件。</p>
<h3 id="1-编辑网络接口配置"><a href="#1-编辑网络接口配置" class="headerlink" title="1. 编辑网络接口配置"></a>1. 编辑网络接口配置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/network/interfaces</span><br></pre></td></tr></table></figure>
<h3 id="2-配置静态-IP"><a href="#2-配置静态-IP" class="headerlink" title="2. 配置静态 IP"></a>2. 配置静态 IP</h3><p>找到你的网卡（如 eth0 或 ens33），修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auto ens33</span><br><span class="line">iface ens33 inet static</span><br><span class="line">    address 192.168.0.100</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 192.168.0.1</span><br><span class="line">    dns-nameservers 8.8.8.8 8.8.4.4</span><br></pre></td></tr></table></figure>
<h3 id="3-重启网络服务"><a href="#3-重启网络服务" class="headerlink" title="3. 重启网络服务"></a>3. 重启网络服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart networking</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">sudo ifdown ens33 &amp;&amp; sudo ifup ens33</span><br></pre></td></tr></table></figure>
<h3 id="4-验证"><a href="#4-验证" class="headerlink" title="4. 验证"></a>4. 验证</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ifconfig</span><br><span class="line">ping google.com</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table>
<thead>
<tr>
<th>方法</th>
<th>适用版本</th>
<th>配置文件</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>Netplan</td>
<td>Ubuntu 18.04+</td>
<td>&#x2F;etc&#x2F;netplan&#x2F;*.yaml</td>
<td>sudo netplan apply</td>
</tr>
<tr>
<td>&#x2F;etc&#x2F;network&#x2F;interfaces</td>
<td>Ubuntu 16.04 或更早</td>
<td>&#x2F;etc&#x2F;network&#x2F;interfaces</td>
<td>sudo systemctl restart networking</td>
</tr>
<tr>
<td>推荐使用 Netplan（Ubuntu 18.04+），因为它更现代且易于管理。如果遇到问题，检查日志：</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">journalctl -xe</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Ubuntu</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS总结四【常用命令】</title>
    <url>/cnblogs.github.io/p/16807.html</url>
    <content><![CDATA[<h3 id="防火墙命令"><a href="#防火墙命令" class="headerlink" title="防火墙命令"></a>防火墙命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">管理防火墙启动、重启、状态、关闭</span></span><br><span class="line">systemctl start|restart|status|stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开机启动防火墙</span></span><br><span class="line">systemctl enable firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁用防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载防火墙规则</span></span><br><span class="line">systemctl reload firewalld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前安装版本</span></span><br><span class="line">firewall-cmd --version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看防火墙状态</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出防火墙所有规则列表</span></span><br><span class="line">firewall-cmd --zone=public --list-all</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出允许通过防火墙端口列表</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加临时放行端口，重启防火墙后时效</span></span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加永久放行端口，重启防火墙依旧有效</span></span><br><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加永久放行端口段，此例代表8080-8900之间的端口都会放行</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8080-8900/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询端口放行状态，如果存在则返回端口信息，否则不显示</span></span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">永久删除放行端口</span></span><br><span class="line">firewall-cmd --zone=public --remove-port=80/tcp --permanent</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载防火墙规则</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>CentOS</category>
      </categories>
      <tags>
        <tag>CentOS</tag>
      </tags>
  </entry>
</search>
